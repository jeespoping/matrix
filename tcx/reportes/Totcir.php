<html><head><title>MATRIX</title></head><body BGCOLOR=""><BODY TEXT="#000066"><center><table border=0 align=center><tr><td align=center bgcolor="#cccccc"><A NAME="Arriba"><font size=5>PROCEDIMIENTOS QUIRURGICOS TOTALES</font></a></tr></td><tr><td align=center bgcolor="#cccccc"><font size=2> <b> Totcir.php Ver 2011-01-05</b></font></tr></td></table></center><?php
include_once("conex.php");function comparacion($vec1,$vec2){	if($vec1[2] > $vec2[2])		return -1;	elseif ($vec1[2] < $vec2[2])				return 1;			else				return 0;} session_start(); if(!isset($_SESSION['user'])) echo "error"; else { 	$key = substr($user,2,strlen($user));	
	
	echo "<form action='Totcir.php' method=post>";	if(!isset($v0) or !isset($v1))	{		echo "<center><table border=0>";		echo "<tr><td align=center colspan=2><b>PROMOTORA MEDICA LAS AMERICAS S.A.<b></td></tr>";		echo "<tr><td colspan=2 align=center><b>PROCEDIMIENTOS QUIRURGICOS TOTALES</b></td></tr>";		echo "<tr><td bgcolor=#cccccc align=center>Fecha Inicial Inicial</td>";		echo "<td bgcolor=#cccccc align=center><input type='TEXT' name='v0' size=10 maxlength=10></td></tr>";		echo "<tr><td bgcolor=#cccccc align=center>Fecha Inicial Final</td>";		echo "<td bgcolor=#cccccc align=center><input type='TEXT' name='v1' size=10 maxlength=10></td></tr>";		echo "<tr><td bgcolor=#cccccc colspan=2 align=center><input type='RADIO' name=x value=0> Primer Nivel <input type='RADIO' name=x value=1> Segundo Nivel <input type='RADIO' name=x value=2> Todos </td></tr>";		echo "<tr><td bgcolor=#cccccc  colspan=2 align=center><input type='submit' value='ENTER'></td></tr></table>";	}	else	{		$CIR = array();		$ca="";		$nc=0;		//                 0       1       2           3                 4              5                  6		$query = "select Mcitur, Circpr, Cirdes, mid(Mcihfi,1,2), mid(Mcihfi,4,1), mid(Mcihin,1,2), mid(Mcihin,4,1) from tcx_000008,tcx_000002 ";		$query .= " where mcifec between  '".$v0."' and  '".$v1."' ";		if ($x == 0)			$query .= " and CONV(Mciqui,10,10) between  1 and  10 ";		elseif ($x == 1)				$query .= " and CONV(Mciqui,10,10)  > 10 ";		$query .= "  and  mcicod = circod   ";		$query .= " order by Circpr";		$err = mysql_query($query,$conex);		$num = mysql_num_rows($err);		for ($i=0;$i<$num;$i++)		{			$row = mysql_fetch_array($err);			if($row[1] != $ca)			{				if($i > 0)				{					$CIR[$nc][3] = $CIR[$nc][3] / $CIR[$nc][2];					$CIR[$nc][4] = $CIR[$nc][2] / $num * 100;					$nc++;				}				$ca=$row[1];				$CIR[$nc][0]=$row[1];				$CIR[$nc][1]=$row[2];				$CIR[$nc][2]=0;				$CIR[$nc][3]=0;				$CIR[$nc][4]=0;			}			$CIR[$nc][2] += 1;			$CIR[$nc][3] += (((integer)$row[3] + (integer)$row[4] / 6) - ((integer)$row[5] + (integer)$row[6] / 6));		}		$CIR[$nc][3] = $CIR[$nc][3] / $CIR[$nc][2];		$CIR[$nc][4] = $CIR[$nc][2] / $num * 100;		usort($CIR,'comparacion');		echo "<center><table border=1>";		echo "<tr><td colspan=6 align=center><b>PROMOTORA MEDICA LAS AMERICAS S.A.</b></td></tr>";		echo "<tr><td colspan=6 align=center><b>DIRECCION DE INFORMATICA</b></td></tr>";		echo "<tr><td colspan=6 align=center><b>PROCEDIMIENTOS QUIRURGICOS TOTALES</b></td></tr>";		switch ($x)		{			case 0:				echo "<tr><td colspan=6 align=center><b>QUIROFANOS PRIMER NIVEL</b></td></tr>";			break;			case 1:				echo "<tr><td colspan=6 align=center><b>QUIROFANOS SEGUNDO NIVEL</b></td></tr>";			break;			case 2:				echo "<tr><td colspan=6 align=center><b>TODOS LOS QUIROFANOS</b></td></tr>";			break;		}			echo "<tr><td colspan=6 align=center><b>Desde : ".$v0." Hasta ".$v1."</b></td></tr>";		echo "<tr>";		echo "<td bgcolor=#cccccc><b>POSICION</b></td>";		echo "<td bgcolor=#cccccc><b>CODIGO</b></td>";		echo "<td bgcolor=#cccccc><b>DESCRIPCION</b></td>";		echo "<td align=right bgcolor=#cccccc><b>CANTIDAD</b></td>";		echo "<td align=right bgcolor=#cccccc><b>TIEMP. PROM.</b></td>";		echo "<td align=right bgcolor=#cccccc><b>PORCENTAJE</b></td>";		echo "</tr>"; 		$t=array();		$t[0] = 0;		$t[1] = 0;		$t[2] = 0;		for ($i=0;$i<=$nc;$i++)		{			echo "<tr>";			$j = $i + 1;			echo "<td align=center>".$j."</td>";			echo "<td>".$CIR[$i][0]."</td>";			echo "<td>".$CIR[$i][1]."</td>";			$t[2]+=$CIR[$i][2];			echo "<td align=right>".number_format($CIR[$i][2],0,'.',',')."</td>";			echo "<td align=right>".number_format($CIR[$i][3],2,'.',',')."</td>";			echo "<td align=right>".number_format($CIR[$i][4],2,'.',',')."%</td>";			echo "</tr>"; 		}		echo "<tr><td  bgcolor=#999999 colspan=3 align=center><b>TOTAL CIRUGIAS</b></td>";		echo "<td bgcolor=#999999 align=right><b>".number_format($t[2],0,'.',',')."</b></td>";		echo "<td bgcolor=#999999 colspan=2><b>&nbsp</b></td>";		echo "</tr>"; 		echo "</table></enter>"; 	}}?></body></html>