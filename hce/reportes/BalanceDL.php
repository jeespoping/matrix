<html>
<head>
  	<title>MATRIX Reporte de Balance de Liquidos</title>
  	<!-- UTF-8 is the recommended encoding for your pages -->
 
    <title>Zapatec DHTML Calendar</title>

<!-- Loading Theme file(s) -->
    <link rel="stylesheet" href="../../zpcal/themes/winter.css" />

<!-- Loading Calendar JavaScript files -->
    <script type="text/javascript" src="../../zpcal/src/utils.js"></script>
    <script type="text/javascript" src="../../zpcal/src/calendar.js"></script>
    <script type="text/javascript" src="../../zpcal/src/calendar-setup.js"></script>
    <!-- Loading language definition file -->
    <script type="text/javascript" src="../../zpcal/lang/calendar-sp.js"></script>
    <style type="text/css">
    	//body{background:white url(portal.gif) transparent center no-repeat scroll;}
    	.saltopagina{page-break-after: always}
    	#tipo1{color:#000066;background:#FFFFFF;font-size:7pt;font-family:Tahoma;font-weight:bold;}
    	#tipo2{color:#000066;background:#FFFFFF;font-size:7pt;font-family:Tahoma;font-weight:bold;}
    	.tipo3{color:#000066;background:#FFFFFF;font-size:7pt;font-family:Tahoma;font-weight:bold;text-align:left;}
    	.tipo3A{color:#000066;background:#FFFFFF;font-size:8pt;font-family:Tahoma;font-weight:bold;text-align:left;}
    	.tipo4{color:#000066;background:#dddddd;font-size:6pt;font-family:Tahoma;font-weight:bold;text-align:center;}
    	#tipo5{color:#000066;background:#FFFFFF;font-size:10pt;font-family:Tahoma;font-weight:bold;}
    	.tipo6{color:#000066;background:#FFFFFF;font-size:10pt;font-family:Tahoma;font-weight:bold;text-align:center;}
    	#tipo7{color:#FFFFFF;background:#000066;font-size:12pt;font-family:Tahoma;font-weight:bold;width:30em;}
    	#tipo8{color:#99CCFF;background:#000066;font-size:6pt;font-family:Tahoma;font-weight:bold;}
    	#tipo9{color:#660000;background:#dddddd;font-size:8pt;font-family:Tahoma;font-weight:bold;text-align:center;}
    	#tipo10{color:#FFFFFF;background:#000066;font-size:10pt;font-family:Tahoma;font-weight:bold;text-align:center;}
    	#tipo11{color:#000066;background:#999999;font-size:7pt;font-family:Tahoma;font-weight:bold;text-align:center;}
    	#tipo12{color:#000066;background:#FFFFFF;font-size:7pt;font-family:Tahoma;font-weight:bold;text-align:left;}
    	#tipo13{color:#000066;background:#99CCFF;font-size:7pt;font-family:Tahoma;font-weight:bold;text-align:left;}
    	#tipo13A{color:#000066;background:#FFFFFF;font-size:8pt;font-family:Tahoma;font-weight:normal;text-align:justify;border-style:solid;border-width:1px;}
    	#tipo13B{color:#000066;background:#DDDDDD;font-size:6pt;font-family:Tahoma;font-weight:normal;text-align:justify;border-style:solid;border-width:1px;}
    	#tipo14{color:#FFFFFF;background:#000066;font-size:14pt;font-family:Tahoma;font-weight:bold;text-align:center;}
    	#tipo15{color:#000066;background:#FFFFFF;font-size:7pt;font-family:Tahoma;font-weight:bold;text-align:center;}
    	#tipo16{color:#000066;background:#99CCFF;font-size:7pt;font-family:Tahoma;font-weight:bold;text-align:center;}
    	#tipo17{color:#000066;background:#CC99FF;font-size:10pt;font-family:Tahoma;font-weight:bold;text-align:center;}
    	#tipo18{color:#000066;background:#DDDDDD;font-size:7pt;font-family:Tahoma;font-weight:bold;text-align:center;}
    	#tipo19{color:#000066;background:#FFFFFF;font-size:7pt;font-family:Tahoma;font-weight:bold;text-align:right;}
    	
    	#tipoT00{color:#000000;background:#FFFFFF;font-size:7pt;font-family:Tahoma;font-weight:bold;table-layout:fixed;text-align:left;border-width:4px;}
    	#tipoT01{color:#000000;background:#FFFFFF;font-size:7pt;font-family:Tahoma;font-weight:bold;width:15em;text-align:center;height:5em;border-style:double;border-width:4px;}
    	#tipoT02{color:#000066;background:#DDDDDD;font-size:12pt;font-family:Arial;font-weight:normal;text-align:center;height:3em;border-style:double;border-width:4px;}
    	#tipoT02A{color:#000066;background:#E8EEF7;font-size:10pt;font-family:Arial;font-weight:bold;text-align:center;height:3em;border-style:double;border-width:4px;}
    	#tipoT02B{color:#000066;background:#C3D9FF;font-size:10pt;font-family:Arial;font-weight:bold;text-align:center;height:3em;border-style:double;border-width:4px;}
    	#tipoT02C{color:#000066;background:#999999;font-size:12pt;font-family:Arial;font-weight:normal;text-align:center;height:3em;border-style:double;border-width:4px;}
    	#tipoT03{color:#000000;background:#FFFFFF;font-size:7pt;font-family:Arial;font-weight:normal;text-align:right;height:2em;border-style:double;border-width:4px;}
    	
    	#tipoG00{color:#000066;background:#999999;font-size:7pt;font-family:Arial;font-weight:bold;text-align:center;border-style:double;border-width:4px;}
    	#tipoG01{color:#000066;background:#CCCCCC;font-size:7pt;font-family:Arial;font-weight:bold;text-align:center;border-style:double;border-width:4px;}
    	#tipoG02{color:#000066;background:#FFFFFF;font-size:7pt;font-family:Arial;font-weight:bold;text-align:left;border-style:double;border-width:4px;}
    	#tipoG02A{color:#000066;background:#FFFFFF;font-size:7pt;font-family:Arial;font-weight:bold;text-align:left;border-style:double;border-width:4px;}
    	#tipoG03{color:#000066;background:#FFFFFF;font-size:12pt;font-family:Arial;font-weight:normal;text-align:left;border-style:double;border-width:4px;}
    	#tipoG03D{color:#000066;background:#FFFFFF;font-size:12pt;font-family:Arial;font-weight:normal;text-align:right;border-style:double;border-width:4px;}
    	#tipoG03W{color:#000066;background:#E8EEF7;font-size:12pt;font-family:Arial;font-weight:normal;text-align:left;border-style:double;border-width:4px;}
    	#tipoG03WD{color:#000066;background:#E8EEF7;font-size:12pt;font-family:Arial;font-weight:normal;text-align:right;border-style:double;border-width:4px;}
    	#tipoG03B{color:#000066;background:#CCCCCC;font-size:12pt;font-family:Arial;font-weight:bold;text-align:left;border-style:double;border-width:4px;}
    	#tipoG03BD{color:#000066;background:#CCCCCC;font-size:12pt;font-family:Arial;font-weight:bold;text-align:right;border-style:double;border-width:4px;}
    	#tipoG03BH{color:#000066;background:#999999;font-size:12pt;font-family:Arial;font-weight:bold;text-align:left;border-style:double;border-width:4px;}
    	#tipoG03BX{color:#000066;background:#FFDDDD;font-size:12pt;font-family:Arial;font-weight:bold;text-align:center;border-style:double;border-width:4px;height:2em;}
    	#tipoG03BHD{color:#000066;background:#999999;font-size:12pt;font-family:Arial;font-weight:bold;text-align:right;border-style:double;border-width:4px;}
    	
    	#tipoG03DN{color:#FF0000;background:#FFFFFF;font-size:12pt;font-family:Arial;font-weight:normal;text-align:right;border-style:double;border-width:4px;}
    	#tipoG03WDN{color:#FF0000;background:#E8EEF7;font-size:12pt;font-family:Arial;font-weight:normal;text-align:right;border-style:double;border-width:4px;}
    	#tipoG03BDN{color:#FF0000;background:#CCCCCC;font-size:12pt;font-family:Arial;font-weight:bold;text-align:right;border-style:double;border-width:4px;}
    	#tipoG03BHDN{color:#FF0000;background:#999999;font-size:12pt;font-family:Arial;font-weight:bold;text-align:right;border-style:double;border-width:4px;}
    	
    	#tipoG04W{color:#000066;background:#C3D9FF;font-size:12pt;font-family:Arial;font-weight:normal;text-align:left;border-style:double;border-width:4px;}
    	#tipoG04WD{color:#000066;background:#C3D9FF;font-size:12pt;font-family:Arial;font-weight:normal;text-align:right;border-style:double;border-width:4px;}
    	
    	
    	.tipoTABLE{font-family:Arial;border-style:none;border-collapse:collapse;}
    	.tipoTABLE1{font-family:Arial;border-style:solid;border-collapse:collapse;}
    	
    	.tipoL02M{color:#000066;background:#E8EEF7;font-size:8.5pt;font-family:Arial;font-weight:bold;text-align:left;height:2em;}
    	.tipoL02MO{color:#000066;background:#E0E0E0;font-size:8.5pt;font-family:Arial;font-weight:bold;text-align:left;height:2em;}
    	.tipoL02MW{color:#000066;background:#CCCCCC;font-size:8.5pt;font-family:Arial;font-weight:bold;text-align:left;height:2em;}
    	#tipoL01{color:#000000;background:#C3D9FF;font-size:9pt;font-family:Arial;font-weight:bold;width:15em;text-align:center;height:2em;}
    	#tipoL01C{color:#000000;background:#C3D9FF;font-size:9pt;font-family:Arial;font-weight:bold;width:15em;text-align:center;height:2em;}
    	#tipoL02C{color:#000066;background:#E8EEF7;font-size:9pt;font-family:Arial;font-weight:bold;width:50em;text-align:center;height:2em;}
    	#tipoL03C{color:#000000;background:#C3D9FF;font-size:11pt;font-family:Arial;font-weight:bold;width:250em;text-align:center;height:2em;}
    	#tipoL04C{color:#000000;background:#C3D9FF;font-size:12pt;font-family:Arial;font-weight:bold;width:250em;text-align:center;height:2em;}
    	#tipoL01A{color:#000000;background:#C3D9FF;font-size:9pt;font-family:Arial;font-weight:bold;width:15em;align:center;text-align:center;height:5em;}
    	#tipoL02A{color:#000000;background:#E8EEF7;font-size:9pt;font-family:Arial;font-weight:normal;width:15em;align:center;text-align:center;height:5em;}
    	#tipoL01B{color:#000000;background:#C3D9FF;font-size:9pt;font-family:Arial;font-weight:bold;width:15em;align:center;text-align:center;}
    	#tipoL02B{color:#000000;background:#E8EEF7;font-size:9pt;font-family:Arial;font-weight:normal;width:15em;align:center;text-align:center;}
    	#tipoL03{color:#000066;background:#FFFFFF;font-size:12pt;font-family:Arial;font-weight:bold;width:90em;text-align:center;height:2em;}
    	#tipoL03M{color:#FF0000;background:#FFFFFF;font-size:12pt;font-family:Arial;font-weight:bold;width:90em;text-align:center;height:2em;}
    	#tipoL03X{color:#FFFFFF;background:#FF0000;font-size:12pt;font-family:Arial;font-weight:bold;width:90em;text-align:center;height:2em;}
    	#tipoL04{color:#000000;background:#E8EEF7;font-size:12pt;font-family:Arial;font-weight:bold;width:75em;text-align:center;height:2em;}
    	#tipoL04A{color:#000066;background:#E8EEF7;font-size:9pt;font-family:Arial;font-weight:bold;width:75em;text-align:center;height:2em;}
    	#tipoL05{color:#000000;background:#C3D9FF;font-size:8pt;font-family:Arial;font-weight:bold;width:25em;text-align:center;height:2em;}
    	#tipoL06{color:#000066;background:#999999;font-size:12pt;font-family:Arial;font-weight:bold;text-align:left;height:1em;cursor: hand;cursor: pointer;}
    	#tipoL07{color:#000066;background:#CCCCCC;font-size:10pt;font-family:Arial;font-weight:bold;width:90em;text-align:left;height:1em;}
    	#tipoL07A{color:#000066;background:#E8EEF7;font-size:8pt;font-family:Arial;font-weight:bold;width:90em;text-align:left;height:1em;}
    	#tipoL07B{color:#000066;background:#CCCCCC;font-size:8pt;font-family:Arial;font-weight:bold;width:90em;text-align:left;height:1em;}
    	#tipoL08{color:#000066;background:#CCCCCC;font-size:10pt;font-family:Arial;font-weight:bold;text-align:center;height:1em;}
    	#tipoL09{color:#CC0000;background:#DDDDDD;font-size:10pt;font-family:Arial;font-weight:bold;text-align:center;height:1em;}
    	#tipoL09A{color:#000066;background:#DDDDDD;font-size:10pt;font-family:Arial;font-weight:bold;text-align:center;height:1em;vertical-align:middle;}
    	#tipoFILA{color:#FFFFFF;background:#FFFFFF;width:390em;}
    	#tipoLGOK{color:#000000;background:#C3D9FF;font-size:12pt;font-family:Arial;font-weight:bold;text-align:center;height:2em;}
    	#tipoLGOL{color:#000000;background:#CC99FF;font-size:12pt;font-family:Arial;font-weight:bold;text-align:center;height:2em;}
    	
    	
    	
    </style>
</head>
<body BGCOLOR="FFFFFF" oncontextmenu = "return true" onselectstart = "return true" ondragstart = "return true">
<BODY TEXT="#000066">
<script type="text/javascript">
<!--
	function enter()
	{
		document.forms.BalanceDL.submit();
	}
	function salto1()
	{
		window.print();
	}
	
//-->
</script>
<?php
include_once("conex.php");

/*
*********************************************************************************************************************  
[DOC]
	   PROGRAMA : BalanceDL.php
	   Fecha de Liberacion : 2011-11-01
	   Autor : Ing. Pedro Ortiz Tamayo
	   Version Actual : 2012-01-26
	   
	   OBJETIVO GENERAL :Este programa ofrece al usuario la impresion del Balance de Liquidos a partir de los registros
	   realizados en la HCE, en los formularios destinados para este proposito.
	   
	   REGISTRO DE MODIFICACIONES :
	   .2012-01-26
			Se cambia el reporte, tomado la hora digitada por las enfermeras en lugar de la hora del registro en el sistema.
	   .2012-01-06
	   		Se agrega un icono de impresion para facilitar la generacion en papel de este informe.
	   .2011-12-26
	   		Se cambia la evaluacion en le calculo de la horas para mostar el subtotal.
	   .2011-11-09
	   		Release de Version Beta.
	   
[*DOC]   		
**********************************************************************************************************************
*/
function comparacion($vec1,$vec2)
{
	if($vec1[0] > $vec2[0])
		return 1;
	elseif ($vec1[0] < $vec2[0])
				return -1;
			else
				return 0;
}
function ver($chain)
{
	if(strpos($chain,"-") === false)
		return $chain;
	else
		return substr($chain,strpos($chain,"-")+1);
}

function diferencia($fechaf,$fechai)
{
	$a1=(integer)substr($fechaf,0,4)*360 +(integer)substr($fechaf,5,2)*30 + (integer)substr($fechaf,8,2);
	$a2=(integer)substr($fechai,0,4)*360 +(integer)substr($fechai,5,2)*30 + (integer)substr($fechai,8,2);
	$diff=$a1 - $a2;
	return $diff;
}

@session_start();
if(!isset($_SESSION['user']))
	echo "error";
else
{
	$key = substr($user,2,strlen($user));
	echo "<form name='BalanceDL' action='BalanceDL.php' method=post>";
	

	

	echo "<center><input type='HIDDEN' name= 'empresa' value='".$empresa."'>";
	echo "<center><input type='HIDDEN' name= 'wtipo' value='".$wtipo."'>";
	
	if(!isset($wfechai) or !isset($wfechaf) or !isset($wtipodoc) or !isset($wcedula) or !isset($whis) or !isset($wing) or $wtipodoc == "" or $wcedula == "" or $whis == "" or $wing == "")
	{
		if(!isset($wfechai))
		{
			$wfechai=date("Y-m-d");
			$wfechaf=date("Y-m-d");
		}
		echo "<center><table border=0>";
		echo "<tr><td align=center colspan=2><b>PROMOTORA MEDICA LAS AMERICAS S.A.<b></td></tr>";
		echo "<tr><td align=center colspan=2><b>CLINICA LAS AMERICAS<b></td></tr>";
		echo "<tr><td align=center colspan=2>INFORME DE BALANCE DE LIQUIDOS</td></tr>";
		if(isset($wcedula) and isset($wtipodoc) and $wtipodoc != "" and $wcedula != "")
		{
			$query = "select Orihis,Oriing from root_000037 ";
			$query .= " where oriced = '".$wcedula."'";
			$query .= "   and oritid = '".$wtipodoc."'";
			$query .= "   and oriori = '01' ";
			$err = mysql_query($query,$conex) or die(mysql_errno().":".mysql_error());
			$num = mysql_num_rows($err);
			if($num > 0)
			{
				$row = mysql_fetch_array($err);
				$whis = $row[0];
				$wing = $row[1];
				echo "<tr><td bgcolor=#cccccc align=center>Tipo de Documento</td>";
				echo "<td bgcolor=#cccccc align=center><input type='TEXT' name='wtipodoc' size=2  value='".$wtipodoc."' readonly='readonly' maxlength=2></td></tr>";
				echo "<tr><td bgcolor=#cccccc align=center>Documento</td>";
				echo "<td bgcolor=#cccccc align=center><input type='TEXT' name='wcedula' size=12 value='".$wcedula."' readonly='readonly' maxlength=12></td></tr>";
				echo "<tr><td bgcolor=#cccccc align=center>Nro. de Historia</td>";
				echo "<td bgcolor=#cccccc align=center><input type='TEXT' name='whis' ' size=2  value='".$whis."' readonly='readonly' maxlength=2></td></tr>";
				echo "<tr><td bgcolor=#cccccc align=center>Nro. de Ingreso</td>";
				echo "<td bgcolor=#cccccc align=center><input type='TEXT' name='wing' size=12 value='".$wing."' readonly='readonly' maxlength=12></td></tr>";
			}
			else
			{
				echo "<tr><td bgcolor=#cccccc align=center>Tipo de Documento</td>";
				echo "<td bgcolor=#cccccc align=center><input type='TEXT' name='wtipodoc' size=2 maxlength=2></td></tr>";
				echo "<tr><td bgcolor=#cccccc align=center>Documento</td>";
				echo "<td bgcolor=#cccccc align=center><input type='TEXT' name='wcedula' size=12 maxlength=12></td></tr>";
				echo "<tr><td bgcolor=#cccccc align=center>Nro. de Historia</td>";
				echo "<td bgcolor=#cccccc align=center><input type='TEXT' name='whis' size=10 maxlength=10></td></tr>";
				echo "<tr><td bgcolor=#cccccc align=center>Nro. de Ingreso</td>";
				echo "<td bgcolor=#cccccc align=center><input type='TEXT' name='wing' size=10 maxlength=10></td></tr>";
			}
		}
		elseif(isset($wing) and isset($whis) and $whis != "" and $wing != "")
			{
				$query = "select oriced,oritid from root_000037 ";
				$query .= " where Orihis = '".$whis."'";
				$query .= "   and Oriing = '".$wing."'";
				$query .= "   and oriori = '01' ";
				$err = mysql_query($query,$conex) or die(mysql_errno().":".mysql_error());
				$num = mysql_num_rows($err);
				if($num > 0)
				{
					$row = mysql_fetch_array($err);
					$wcedula = $row[0];
					$wtipodoc = $row[1];
					echo "<tr><td bgcolor=#cccccc align=center>Tipo de Documento</td>";
					echo "<td bgcolor=#cccccc align=center><input type='TEXT' name='wtipodoc' size=2  value='".$wtipodoc."' readonly='readonly' maxlength=2></td></tr>";
					echo "<tr><td bgcolor=#cccccc align=center>Documento</td>";
					echo "<td bgcolor=#cccccc align=center><input type='TEXT' name='wcedula' size=12 value='".$wcedula."' readonly='readonly' maxlength=12></td></tr>";
					echo "<tr><td bgcolor=#cccccc align=center>Nro. de Historia</td>";
					echo "<td bgcolor=#cccccc align=center><input type='TEXT' name='whis' size=2  value='".$whis."' readonly='readonly' maxlength=2></td></tr>";
					echo "<tr><td bgcolor=#cccccc align=center>Nro. de Ingreso</td>";
					echo "<td bgcolor=#cccccc align=center><input type='TEXT' name='wing' size=12 value='".$wing."' readonly='readonly' maxlength=12></td></tr>";
				}
				else
				{
					echo "<tr><td bgcolor=#cccccc align=center>Tipo de Documento</td>";
					echo "<td bgcolor=#cccccc align=center><input type='TEXT' name='wtipodoc' size=2 maxlength=2></td></tr>";
					echo "<tr><td bgcolor=#cccccc align=center>Documento</td>";
					echo "<td bgcolor=#cccccc align=center><input type='TEXT' name='wcedula' size=12 maxlength=12></td></tr>";
					echo "<tr><td bgcolor=#cccccc align=center>Nro. de Historia</td>";
					echo "<td bgcolor=#cccccc align=center><input type='TEXT' name='whis' size=10 maxlength=10></td></tr>";
					echo "<tr><td bgcolor=#cccccc align=center>Nro. de Ingreso</td>";
					echo "<td bgcolor=#cccccc align=center><input type='TEXT' name='wing' size=10 maxlength=10></td></tr>";
				}
			}
			else
			{
				echo "<tr><td bgcolor=#cccccc align=center>Tipo de Documento</td>";
				echo "<td bgcolor=#cccccc align=center><input type='TEXT' name='wtipodoc' size=2 maxlength=2></td></tr>";
				echo "<tr><td bgcolor=#cccccc align=center>Documento</td>";
				echo "<td bgcolor=#cccccc align=center><input type='TEXT' name='wcedula' size=12 maxlength=12></td></tr>";
				echo "<tr><td bgcolor=#cccccc align=center>Nro. de Historia</td>";
				echo "<td bgcolor=#cccccc align=center><input type='TEXT' name='whis' size=10 maxlength=10></td></tr>";
				echo "<tr><td bgcolor=#cccccc align=center>Nro. de Ingreso</td>";
				echo "<td bgcolor=#cccccc align=center><input type='TEXT' name='wing' size=10 maxlength=10></td></tr>";
			}
		echo "<tr><td bgcolor='#cccccc' align=center valign=center>Fecha Inicial</td><td bgcolor='#cccccc' align=center valign=center><input type='TEXT' name='wfechai' size=10 maxlength=10 id='wfechai' readonly='readonly' value=".$wfechai." class=tipo6><IMG SRC='/matrix/images/medical/TCX/calendario.jpg' id='trigger1'></td></tr>";
		?>
		<script type="text/javascript">//<![CDATA[
			Zapatec.Calendar.setup({weekNumbers:false,showsTime:true,timeFormat:'12',electric:false,inputField:'wfechai',button:'trigger1',ifFormat:'%Y-%m-%d',daFormat:'%Y/%m/%d'});	
		//]]></script>
		<?php
		echo "<tr><td bgcolor='#cccccc' align=center valign=center>Fecha Final</td><td bgcolor='#cccccc' align=center valign=center><input type='TEXT' name='wfechaf' size=10 maxlength=10 id='wfechaf' readonly='readonly' value=".$wfechaf." class=tipo6><IMG SRC='/matrix/images/medical/TCX/calendario.jpg' id='trigger2'></td></tr>";
		?>
		<script type="text/javascript">//<![CDATA[
			Zapatec.Calendar.setup({weekNumbers:false,showsTime:true,timeFormat:'12',electric:false,inputField:'wfechaf',button:'trigger2',ifFormat:'%Y-%m-%d',daFormat:'%Y/%m/%d'});	
		//]]></script>
		<?php
		echo "<tr><td bgcolor=#cccccc  colspan=2 align=center><input type='submit' value='ENTER'></td></tr></table>";
	}
	else
	{	
		$query = "select Pacno1,Pacno2,Pacap1,Pacap2,Pacnac,Pacsex,Orihis,Oriing,Ingnre,Ubisac,Ubihac,Cconom from root_000036,root_000037,movhos_000016,movhos_000018,movhos_000011 ";
		$query .= " where pacced = '".$wcedula."'";
		$query .= "   and pactid = '".$wtipodoc."'";
		$query .= "   and  pacced = oriced ";
		$query .= "   and  pactid = oritid ";
		$query .= "   and oriori = '01' ";
		$query .= "   and inghis = orihis ";
		$query .= "   and  inging = oriing ";
		$query .= "   and ubihis = inghis "; 
		$query .= "   and ubiing = inging ";
		$query .= "   and ccocod = ubisac ";
		$err = mysql_query($query,$conex) or die(mysql_errno().":".mysql_error());
		$row = mysql_fetch_array($err);
		$wsex="M";
		$sexo="MASCULINO";
		if($row[5] == "F")
		{
			$sexo="FEMENINO";
			$wsex="F";
		}
		$ann=(integer)substr($row[4],0,4)*360 +(integer)substr($row[4],5,2)*30 + (integer)substr($row[4],8,2);
		$aa=(integer)date("Y")*360 +(integer)date("m")*30 + (integer)date("d");
		$ann1=($aa - $ann)/360;
		$meses=(($aa - $ann) % 360)/30;
		if ($ann1<1)
		{
			$dias1=(($aa - $ann) % 360) % 30;
			$wedad=(string)(integer)$meses." Meses ".(string)$dias1." Dias";	
		}
		else
		{
			$dias1=(($aa - $ann) % 360) % 30;
			$wedad=(string)(integer)$ann1." A&ntilde;os ".(string)(integer)$meses." Meses ".(string)$dias1." Dias";
		}
		$wpac = $wtipodoc." ".$wcedula."<br>".$row[0]." ".$row[1]." ".$row[2]." ".$row[3];
		$whis=$row[6];
		if(!isset($wing))
			$wing=$row[7];
		$dia=array();
		$dia["Mon"]="Lun";
		$dia["Tue"]="Mar";
		$dia["Wed"]="Mie";
		$dia["Thu"]="Jue";
		$dia["Fri"]="Vie";
		$dia["Sat"]="Sab";
		$dia["Sun"]="Dom";
		$mes["Jan"]="Ene";
		$mes["Feb"]="Feb";
		$mes["Mar"]="Mar";
		$mes["Apr"]="Abr";
		$mes["May"]="May";
		$mes["Jun"]="Jun";
		$mes["Jul"]="Jul";
		$mes["Aug"]="Ago";
		$mes["Sep"]="Sep";
		$mes["Oct"]="Oct";
		$mes["Nov"]="Nov";
		$mes["Dec"]="Dic";
		$fechal=strftime("%a %d de %b del %Y");
		$fechal=$dia[substr($fechal,0,3)].substr($fechal,3);
		$fechal=substr($fechal,0,10).$mes[substr($fechal,10,3)].substr($fechal,13);
		$color="#dddddd";
		$color1="#C3D9FF";
		$color2="#E8EEF7";
		$color3="#CC99FF";
		$color4="#99CCFF";
		$wintitulo="Historia:".$row[6]." Ingreso:".$row[7]." Paciente:".$wpac;
		$Hgraficas=" |";
		if(isset($wtipo) and $wtipo == 0)
		{
			echo "<table border=1 width='712' class=tipoTABLE1>";
			echo "<tr><td rowspan=3 align=center><IMG SRC='/matrix/images/medical/root/lmatrix.jpg' id='logo'></td>";	
			echo "<td id=tipoL01C>Paciente</td><td colspan=4 id=tipoL04>".$wpac."</td><td id=tipoL04A>P&aacute;gina 1</td></tr>";
			echo "<tr><td id=tipoL01C>Historia Clinica</td><td id=tipoL02C>".$whis."-".$wing."</td><td id=tipoL01>Edad</td><td id=tipoL02C>".$wedad."</td><td id=tipoL01C>Sexo</td><td id=tipoL02C>".$sexo."</td></tr>";
			echo "<tr><td id=tipoL01C>Servicio</td><td id=tipoL02C>".$row[11]."</td><td id=tipoL01C>Habitacion</td><td id=tipoL02C>".$row[10]."</td><td id=tipoL01C>Entidad</td><td id=tipoL02C>".$row[8]."</td></tr>";
			echo "</table>";
			echo "<br><br><center><IMG SRC='/matrix/images/medical/HCE/button.gif' onclick='javascript:top.close();'></IMG></center><br>";
		}
		$DATA1=array();
		$k1=-1;
		$klave="";
		$wformulario="000089";
		//                                                    0                                       1                                     2                                    3  
		$query  = " select ".$empresa."_".$wformulario.".fecha_data,".$empresa."_".$wformulario.".Hora_data,".$empresa."_".$wformulario.".movcon,".$empresa."_".$wformulario.".movdat from ".$empresa."_".$wformulario." ";
		$query .= " where ".$empresa."_".$wformulario.".movpro='".$wformulario."' ";
		$query .= "   and ".$empresa."_".$wformulario.".movhis='".$whis."' ";
		$query .= "   and ".$empresa."_".$wformulario.".moving='".$wing."' ";
		$query .= "   and ".$empresa."_".$wformulario.".movcon in (2,3,6,7,8,11) ";
		$query .= "   and ".$empresa."_".$wformulario.".fecha_data BETWEEN '".$wfechai."' and '".$wfechaf."'";
		$query .= " order by 1,2,3  ";
		$err = mysql_query($query,$conex) or die(mysql_errno().":".mysql_error());
		$num = mysql_num_rows($err);
		if($num > 0)
		{
			for ($i=0;$i<$num;$i++)
			{
				$row = mysql_fetch_array($err);
				if($klave != $row[0].$row[1])
				{
					if(($k1 > -1 and $DATA1[$k1]['7'] != "" and $DATA1[$k1]['HORA'] != "") or $k1 == -1)
						$k1++;
					$DATA1[$k1]['CLAVE']="";
					$DATA1[$k1]['FECHA']="";
					$DATA1[$k1]['HORA']="";
					$DATA1[$k1]['6']="";
					$DATA1[$k1]['7']="";
					$DATA1[$k1]['8']="";
					$klave = $row[0].$row[1];
				}
				if($row[2] == "2")
				{
					$DATA1[$k1]['FECHA']=$row[3];
					$DATA1[$k1]['CLAVE']=$row[3];
				}
				else
					if($row[2] == "3")
						$DATA1[$k1]['CLAVE'] .= $row[3];
					else
						if($row[2] == "11")
						{
							$DATA1[$k1]['HORA']=(integer)$row[3];
							if((integer)$row[3] < 10)
								$DATA1[$k1]['CLAVE'] = substr($DATA1[$k1]['CLAVE'],0,10)."0".$row[3].substr($DATA1[$k1]['CLAVE'],11);
							else
								$DATA1[$k1]['CLAVE'] = substr($DATA1[$k1]['CLAVE'],0,10).$row[3].substr($DATA1[$k1]['CLAVE'],11);
						}
						else
							$DATA1[$k1][(string)$row[2]]=$row[3];
			}
			if($k1 > -1 and ($DATA1[$k1]['7'] == "" or $DATA1[$k1]['HORA'] == ""))
				$k1--;
		}
		$DATA2=array();
		$k2=-1;
		$klave="";
		//                                                    0                                       1                                     2                                    3  
		$query  = " select ".$empresa."_".$wformulario.".fecha_data,".$empresa."_".$wformulario.".Hora_data,".$empresa."_".$wformulario.".movcon,".$empresa."_".$wformulario.".movdat from ".$empresa."_".$wformulario." ";
		$query .= " where ".$empresa."_".$wformulario.".movpro='".$wformulario."' ";
		$query .= "   and ".$empresa."_".$wformulario.".movhis='".$whis."' ";
		$query .= "   and ".$empresa."_".$wformulario.".moving='".$wing."' ";
		$query .= "   and ".$empresa."_".$wformulario.".movcon in (2,3,30,25,26) ";
		$query .= "   and ".$empresa."_".$wformulario.".fecha_data BETWEEN '".$wfechai."' and '".$wfechaf."'";
		$query .= " order by 1,2,3  ";
		$err = mysql_query($query,$conex) or die(mysql_errno().":".mysql_error());
		$num = mysql_num_rows($err);
		if($num > 0)
		{
			for ($i=0;$i<$num;$i++)
			{
				$row = mysql_fetch_array($err);
				if($klave != $row[0].$row[1])
				{
					if(($k2 > -1 and $DATA2[$k2]['26'] != "" and $DATA2[$k2]['HORA'] != "") or $k2 == -1)
						$k2++;
					$DATA2[$k2]['CLAVE']="";
					$DATA2[$k2]['FECHA']="";
					$DATA2[$k2]['HORA']="";
					$DATA2[$k2]['25']="";
					$DATA2[$k2]['26']="";
					$klave = $row[0].$row[1];
				}
				if($row[2] == "2")
				{
					$DATA2[$k2]['FECHA']=$row[3];
					$DATA2[$k2]['CLAVE']=$row[3];		
				}
				else
					if($row[2] == "3")
						$DATA2[$k2]['CLAVE'] .= $row[3];
					else
						if($row[2] == "30")
						{
							$DATA2[$k2]['HORA']=(integer)$row[3];
							if((integer)$row[3] < 10)
								$DATA2[$k2]['CLAVE'] = substr($DATA2[$k2]['CLAVE'],0,10)."0".$row[3].substr($DATA2[$k2]['CLAVE'],11);
							else
								$DATA2[$k2]['CLAVE'] = substr($DATA2[$k2]['CLAVE'],0,10).$row[3].substr($DATA2[$k2]['CLAVE'],11);
						}
						else
							$DATA2[$k2][(string)$row[2]]=$row[3];
			}
			if($k2 > -1 and ($DATA2[$k2]['26'] == "" or $DATA2[$k2]['HORA'] == ""))
				$k2--;
		}
		$DATA0=array();
		for ($i=0;$i<=$k1;$i++)
		{
			$DATA0[$DATA1[$i]['CLAVE']][0]=$DATA1[$i]['CLAVE'];
			$DATA0[$DATA1[$i]['CLAVE']]['FECHA']=$DATA1[$i]['FECHA'];
			$DATA0[$DATA1[$i]['CLAVE']]['HORA']=$DATA1[$i]['HORA'];
			$DATA0[$DATA1[$i]['CLAVE']]['6']=$DATA1[$i]['6'];
			$DATA0[$DATA1[$i]['CLAVE']]['7']=$DATA1[$i]['7'];
			$DATA0[$DATA1[$i]['CLAVE']]['8']=$DATA1[$i]['8'];
			$DATA0[$DATA1[$i]['CLAVE']]['25']="";
			$DATA0[$DATA1[$i]['CLAVE']]['26']="";
		}
		for ($i=0;$i<=$k2;$i++)
		{
			if(isset($DATA0[$DATA2[$i]['CLAVE']][0]))
			{
				$DATA0[$DATA2[$i]['CLAVE']]['25']=$DATA2[$i]['25'];
				$DATA0[$DATA2[$i]['CLAVE']]['26']=$DATA2[$i]['26'];
			}
			else
			{
				$DATA0[$DATA2[$i]['CLAVE']][0]=$DATA2[$i]['CLAVE'];
				$DATA0[$DATA2[$i]['CLAVE']]['FECHA']=$DATA2[$i]['FECHA'];
				$DATA0[$DATA2[$i]['CLAVE']]['HORA']=$DATA2[$i]['HORA'];
				$DATA0[$DATA2[$i]['CLAVE']]['6']="";
				$DATA0[$DATA2[$i]['CLAVE']]['7']="";
				$DATA0[$DATA2[$i]['CLAVE']]['8']="";
				$DATA0[$DATA2[$i]['CLAVE']]['25']=$DATA2[$i]['25'];
				$DATA0[$DATA2[$i]['CLAVE']]['26']=$DATA2[$i]['26'];
			}
		}
		usort($DATA0,'comparacion');
		//********************************************************************************************************
		//*                                         DATOS DEL ESTUDIO                                           *                                
		//********************************************************************************************************
		
		$DATA=array();
		$k=-1;
		while($DATA3 = each($DATA0))
		{
			$k++;
			//echo $DATA3[0]."<br>";
			//echo $DATA3[1][0]." FECHA: ".$DATA3[1]['FECHA']." HORA: ".$DATA3[1]['HORA']." : ".$DATA3[1]['6']." : ".$DATA3[1]['7']." : ".$DATA3[1]['8']." : ".$DATA3[1]['25']." : ".$DATA3[1]['26']."<br>";
			$DATA[$k]['FECHA']=$DATA3[1]['FECHA'];
			$DATA[$k]['HORA']=$DATA3[1]['HORA'];
			$DATA[$k]['6']=$DATA3[1]['6'];
			$DATA[$k]['7']=$DATA3[1]['7'];
			$DATA[$k]['8']=$DATA3[1]['8'];
			$DATA[$k]['25']=$DATA3[1]['25'];
			$DATA[$k]['26']=$DATA3[1]['26'];
		}
		
		
		if($k > -1)
			$Fenat=$DATA[0]['FECHA'];
		$wtotA=0;
		$wtotE=0;
		$Hant=" ";
		$DIA=0;
		echo "<br><br><center><table align=center class=tipoTABLE>";
		echo "<tr><td id=tipoT02 colspan=9>CLINICA LAS AMERICAS<BR>BALANCE DE LIQUIDOS</td></tr>";
		echo "<tr><td id=tipoT02 colspan=9>DESDE ".$wfechai." HASTA ".$wfechaf."</td></tr>";
		echo "<tr><td id=tipoT03 colspan=9><A HREF='/MATRIX/root/Reportes/DOC.php?files=../../HCE/reportes/BalanceDL.php' target='_blank'>Version 2011-01-26</A></td></tr>";
		echo "<tr><td id=tipoT02A colspan=5>ADMINISTRADOS</td><td id=tipoT02B colspan=4>ELIMINADOS</td></tr>";
		echo "<tr><td id=tipoT02C>Fecha</td><td id=tipoT02C>Hora</td><td id=tipoT02C>Via</td><td id=tipoT02C>Descripci&oacute;n</td><td id=tipoT02C>Volumen</td><td id=tipoT02C>Fecha</td><td id=tipoT02C>Hora</td><td id=tipoT02C>Via</td><td id=tipoT02C>Volumen</td></tr>";
		$color="tipoG03BX";
		$DIA++;
		echo "<tr><td id=".$color." colspan=9>DIA ".$DIA."</td></tr>";
		for ($i=0;$i<=$k;$i++)
		{			
			$diff=diferencia($DATA[$i]['FECHA'],$Fenat);
			$Fenat=$DATA[$i]['FECHA'];
			if($diff > 1)
			{
				$color="tipoG03B";
				echo "<tr><td id=".$color." colspan=4>TOTAL ADMINISTRADOS</td><td id=".$color."D>".number_format((double)$wtotA,0,'.',',')."</td><td id=".$color." colspan=3>TOTAL ELIMINADOS</td><td id=".$color."D>".number_format((double)$wtotE,0,'.',',')."</td></tr>";
				$balance=$wtotA-$wtotE;
				$color="tipoG03BH";
				if($balance > 0)
					echo "<tr><td id=".$color." colspan=8>BALANCE</td><td id=".$color."D>".number_format((double)$balance,0,'.',',')."</td></tr>";
				else
					echo "<tr><td id=".$color." colspan=8>BALANCE</td><td id=".$color."DN>".number_format((double)$balance,0,'.',',')."</td></tr>";
				$color="tipoG03BX";
				$DIA++;
				echo "<tr><td id=".$color." colspan=9>DIA ".$DIA."</td></tr>";
				$wtotA=0;
				$wtotE=0;
			}
			else
			{
				if(($DATA[$i]['HORA'] > 6 and $Hant <= 6 and $Hant != " ") or ($DATA[$i]['HORA'] > 6 and $Hant > $DATA[$i]['HORA'] and $Hant != " " and $diff == 1))
				{
					$color="tipoG03B";
					echo "<tr><td id=".$color." colspan=4>TOTAL ADMINISTRADOS</td><td id=".$color."D>".number_format((double)$wtotA,0,'.',',')."</td><td id=".$color." colspan=3>TOTAL ELIMINADOS</td><td id=".$color."D>".number_format((double)$wtotE,0,'.',',')."</td></tr>";
					$balance=$wtotA-$wtotE;
					$color="tipoG03BH";
					if($balance > 0)
						echo "<tr><td id=".$color." colspan=8>BALANCE</td><td id=".$color."D>".number_format((double)$balance,0,'.',',')."</td></tr>";
					else
						echo "<tr><td id=".$color." colspan=8>BALANCE</td><td id=".$color."DN>".number_format((double)$balance,0,'.',',')."</td></tr>";
					$color="tipoG03BX";
					$DIA++;
					echo "<tr><td id=".$color." colspan=9>DIA ".$DIA."</td></tr>";
					$wtotA=0;
					$wtotE=0;
				}
				elseif(($DATA[$i]['HORA'] > 18 and $Hant <= 18 and $Hant != " ") or ($DATA[$i]['HORA'] < 7 and $Hant <= 18  and $Hant != " " and $diff == 1))
					{
						$X19=1;
						$X7=0;
						$color="tipoG03B";
						echo "<tr><td id=".$color." colspan=4>SUBTOTAL ADMINISTRADOS</td><td id=".$color."D>".number_format((double)$wtotA,0,'.',',')."</td><td id=".$color." colspan=3>SUBTOTAL ELIMINADOS</td><td id=".$color."D>".number_format((double)$wtotE,0,'.',',')."</td></tr>";
/*
						$balance=$wtotA-$wtotE;
						$color="tipoG03BH";
						if($balance > 0)
							echo "<tr><td id=".$color." colspan=7>BALANCE</td><td id=".$color."D>".number_format((double)$balance,0,'.',',')."</td></tr>";
						else
							echo "<tr><td id=".$color." colspan=7>BALANCE</td><td id=".$color."DN>".number_format((double)$balance,0,'.',',')."</td></tr>";
*/
					}
				
			}
			$Hant=$DATA[$i]['HORA'];
			if($i % 2 == 0)
			{
				$color="TipoG03W";
				$color1="TipoG04W";
			}
			else
			{
				$color="TipoG03";
				$color1="TipoG03";
			}
			
			if($DATA[$i]['7'] != "" and $DATA[$i]['7'] != 0 and $DATA[$i]['26'] != "" and $DATA[$i]['26'] != 0)
			{
				$wtotA += $DATA[$i]['7'];
				$wtotE += $DATA[$i]['26'];
				echo "<tr><td id=".$color.">".$DATA[$i]['FECHA']."</td><td id=".$color.">".$DATA[$i]['HORA']."</td><td id=".$color.">".ver($DATA[$i]['6'])."</td><td id=".$color.">".ver($DATA[$i]['8'])."</td><td id=".$color."D>".number_format((double)$DATA[$i]['7'],0,'.',',')."</td><td id=".$color1.">".$DATA[$i]['FECHA']."</td><td id=".$color1.">".$DATA[$i]['HORA']."</td><td id=".$color1.">".ver($DATA[$i]['25'])."</td><td id=".$color1."D>".number_format((double)$DATA[$i]['26'],0,'.',',')."</td></tr>";
			}
			elseif($DATA[$i]['7'] != "" and $DATA[$i]['7'] != 0)
				{
					$wtotA += $DATA[$i]['7'];
					echo "<tr><td id=".$color.">".$DATA[$i]['FECHA']."</td><td id=".$color.">".$DATA[$i]['HORA']."</td><td id=".$color.">".ver($DATA[$i]['6'])."</td><td id=".$color.">".ver($DATA[$i]['8'])."</td><td id=".$color."D>".number_format((double)$DATA[$i]['7'],0,'.',',')."</td><td id=".$color1."></td><td id=".$color1."></td></td><td id=".$color1."></td><td id=".$color1."></td></tr>";
				}
				elseif($DATA[$i]['26'] != "" and $DATA[$i]['26'] != 0)
					{
						$wtotE += $DATA[$i]['26'];
						echo "<tr><td id=".$color."></td><td id=".$color."></td><td id=".$color."></td><td id=".$color."></td><td id=".$color."D></td><td id=".$color1.">".$DATA[$i]['FECHA']."</td><td id=".$color1.">".$DATA[$i]['HORA']."</td><td id=".$color1.">".ver($DATA[$i]['25'])."</td><td id=".$color1."D>".number_format((double)$DATA[$i]['26'],0,'.',',')."</td></tr>";
					}
		}
		$color="tipoG03B";
		echo "<tr><td id=".$color." colspan=4>TOTAL ADMINISTRADOS</td><td id=".$color."D>".number_format((double)$wtotA,0,'.',',')."</td><td id=".$color." colspan=3>TOTAL ELIMINADOS</td><td id=".$color."D>".number_format((double)$wtotE,0,'.',',')."</td></tr>";
		$balance=$wtotA-$wtotE;
		$color="tipoG03BH";
		if($balance > 0)
			echo "<tr><td id=".$color." colspan=8>BALANCE</td><td id=".$color."D>".number_format((double)$balance,0,'.',',')."</td></tr>";
		else
			echo "<tr><td id=".$color." colspan=8>BALANCE</td><td id=".$color."DN>".number_format((double)$balance,0,'.',',')."</td></tr>";
		$color="tipoG03BX";
/*
		$DIA++;
		echo "<tr><td id=".$color." colspan=9>DIA ".$DIA."</td></tr>";
*/
		echo "<tr><td align=center colspan=9><IMG SRC='/matrix/images/medical/HCE/impresora.jpg' alt='IMPRESION' OnClick='salto1()'></td></tr>";
		echo "</table>";
		echo"</form>";
	}
}
?>
</body>
</html>
