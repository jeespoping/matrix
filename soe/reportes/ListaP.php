<html>
<head>
  	<title>MATRIX Lista de Abonos a Cuentas Unidad Odontologica ListaG.php</title>
  	<!-- UTF-8 is the recommended encoding for your pages -->
 
    <title>Zapatec DHTML Calendar</title>

<!-- Loading Theme file(s) -->
    <link rel="stylesheet" href="../../zpcal/themes/winter.css" />

<!-- Loading Calendar JavaScript files -->
    <script type="text/javascript" src="../../zpcal/src/utils.js"></script>
    <script type="text/javascript" src="../../zpcal/src/calendar.js"></script>
    <script type="text/javascript" src="../../zpcal/src/calendar-setup.js"></script>
    <!-- Loading language definition file -->
    <script type="text/javascript" src="../../zpcal/lang/calendar-sp.js"></script>
    <style type="text/css">
    	//body{background:white url(portal.gif) transparent center no-repeat scroll;}
    	#tipo1{color:#000066;background:#FFFFFF;font-size:7pt;font-family:Tahoma;font-weight:bold;}
    	#tipo2{color:#000066;background:#FFFFFF;font-size:7pt;font-family:Tahoma;font-weight:bold;}
    	.tipo3{color:#000066;background:#FFFFFF;font-size:7pt;font-family:Tahoma;font-weight:bold;text-align:left;}
    	.tipo3A{color:#000066;background:#FFFFFF;font-size:7pt;font-family:Tahoma;font-weight:bold;text-align:left;}
    	.tipo4{color:#000066;background:#dddddd;font-size:6pt;font-family:Tahoma;font-weight:bold;text-align:center;}
    	.tipo4A(color:#000066;background:#99CCFF;font-size:6pt;font-family:Tahoma;font-weight:bold;text-align:center;}
    	.tipo4B(color:#000066;background:#CC99FF;font-size:6pt;font-family:Tahoma;font-weight:bold;text-align:center;}
    	#tipo5{color:#000066;background:#FFFFFF;font-size:10pt;font-family:Tahoma;font-weight:bold;}
    	.tipo6{color:#000066;background:#FFFFFF;font-size:10pt;font-family:Tahoma;font-weight:bold;text-align:center;}
    	#tipo7{color:#FFFFFF;background:#000066;font-size:12pt;font-family:Tahoma;font-weight:bold;width:30em;}
    	#tipo8{color:#99CCFF;background:#000066;font-size:6pt;font-family:Tahoma;font-weight:bold;}
    	#tipo9{color:#660000;background:#dddddd;font-size:8pt;font-family:Tahoma;font-weight:bold;text-align:center;}
    	#tipo10{color:#FFFFFF;background:#000066;font-size:10pt;font-family:Tahoma;font-weight:bold;text-align:center;}
    	#tipo11{color:#000066;background:#999999;font-size:7pt;font-family:Tahoma;font-weight:bold;text-align:center;}
    	#tipo12{color:#000066;background:#FFFFFF;font-size:7pt;font-family:Tahoma;font-weight:bold;text-align:left;}
    	#tipo13{color:#000066;background:#99CCFF;font-size:7pt;font-family:Tahoma;font-weight:bold;text-align:left;}
    	#tipo14{color:#FFFFFF;background:#000066;font-size:14pt;font-family:Tahoma;font-weight:bold;text-align:center;}
    	#tipo15{color:#000066;background:#FFFFFF;font-size:7pt;font-family:Tahoma;font-weight:bold;text-align:center;}
    	#tipo16{color:#000066;background:#99CCFF;font-size:7pt;font-family:Tahoma;font-weight:bold;text-align:center;}
    	#tipo17{color:#000066;background:#CC99FF;font-size:10pt;font-family:Tahoma;font-weight:bold;text-align:center;}
    	#tipo18{color:#000066;background:#DDDDDD;font-size:7pt;font-family:Tahoma;font-weight:bold;text-align:center;}
    	#tipo19{color:#000066;background:#FFFFFF;font-size:7pt;font-family:Tahoma;font-weight:bold;text-align:right;}
    	#tipo20{color:#000066;background:#FFFFFF;font-size:7pt;font-family:Tahoma;font-weight:bold;text-align:center;}
    	#tipo21{color:#000066;background:#DDDDDD;font-size:9pt;font-family:Tahoma;font-weight:bold;text-align:center;}

    	#tipo00{color:#000066;background:#FFFFFF;font-size:7pt;font-family:Tahoma;font-weight:bold;table-layout:fixed;text-align:center;}
    	#tipoTCK{color:#000066;background:#999999;font-size:7.2pt;font-family:Tahoma;font-weight:bold;width:8em;text-align:center;height:4.5em;}
    	#tipoT00{color:#000066;background:#999999;font-size:7.2pt;font-family:Tahoma;font-weight:bold;width:8em;text-align:center;height:4.5em;}
    	#tipoT01{color:#000066;background:#999999;font-size:7.2pt;font-family:Tahoma;font-weight:bold;width:8em;text-align:center;height:4.5em;}
    	#tipoT02{color:#000066;background:#999999;font-size:7pt;font-family:Tahoma;font-weight:bold;width:8em;text-align:center;height:4.5em;}
    	#tipoT03{color:#000066;background:#999999;font-size:7pt;font-family:Tahoma;font-weight:bold;width:25em;text-align:center;height:4.5em;}
    	#tipoT04{color:#000066;background:#999999;font-size:7pt;font-family:Tahoma;font-weight:bold;width:25em;text-align:center;height:4.5em;}
    	#tipoT05{color:#000066;background:#999999;font-size:7pt;font-family:Tahoma;font-weight:bold;width:50em;text-align:center;height:4.5em;}
    	#tipoT06{color:#000066;background:#999999;font-size:7pt;font-family:Tahoma;font-weight:bold;width:2.5em;text-align:center;height:4.5em;}
    	#tipoT07{color:#000066;background:#999999;font-size:7pt;font-family:Tahoma;font-weight:bold;width:3.0em;text-align:center;height:4.5em;}
    	#tipoT08{color:#000066;background:#999999;font-size:7pt;font-family:Tahoma;font-weight:bold;width:15em;text-align:center;height:4.5em;}
    	#tipoT09{color:#000066;background:#999999;font-size:7pt;font-family:Tahoma;font-weight:bold;width:20em;text-align:center;height:4.5em;}
    	#tipoT10{color:#000066;background:#999999;font-size:7pt;font-family:Tahoma;font-weight:bold;width:15em;text-align:center;height:4.5em;}
    	#tipoT11{color:#000066;background:#999999;font-size:7pt;font-family:Tahoma;font-weight:bold;width:1.5em;text-align:center;height:4.5em;}
    	#tipoT12{color:#000066;background:#999999;font-size:7pt;font-family:Tahoma;font-weight:bold;width:1.5em;text-align:center;height:4.5em;}
    	#tipoT13{color:#000066;background:#999999;font-size:7pt;font-family:Tahoma;font-weight:bold;width:1.5em;text-align:center;height:4.5em;}
    	#tipoT14{color:#000066;background:#999999;font-size:7pt;font-family:Tahoma;font-weight:bold;width:1.5em;text-align:center;height:4.5em;}
    	#tipoT15{color:#000066;background:#999999;font-size:7pt;font-family:Tahoma;font-weight:bold;width:15em;text-align:center;height:4.5em;}
    	#tipoT16{color:#000066;background:#999999;font-size:7pt;font-family:Tahoma;font-weight:bold;width:20em;text-align:center;height:4.5em;}
    	#tipoT17{color:#000066;background:#999999;font-size:7pt;font-family:Tahoma;font-weight:bold;width:50em;text-align:center;height:4.5em;}
    	
    	#tipoD00{color:#000066;background:#99CCFF;font-size:6pt;font-family:Tahoma;font-weight:bold;width:8em;text-align:center;height:4.5em;}
    	#tipoDCK{color:#000066;background:#99CCFF;font-size:7pt;font-family:Tahoma;font-weight:bold;width:10em;text-align:center;height:4.5em;}
    	#tipoD01{color:#000066;background:#99CCFF;font-size:7pt;font-family:Tahoma;font-weight:bold;width:10em;text-align:center;height:4.5em;}
    	#tipoDE01{color:#000066;background:#CC99FF;font-size:7.2pt;font-family:Tahoma;font-weight:bold;width:20em;text-align:center;height:3em;}
    	#tipoD02{color:#000066;background:#99CCFF;font-size:7pt;font-family:Tahoma;font-weight:bold;width:8em;text-align:center;height:4.5em;}
    	#tipoD03{color:#000066;background:#99CCFF;font-size:7pt;font-family:Tahoma;font-weight:bold;width:25em;text-align:center;height:4.5em;}
    	#tipoD04{color:#000066;background:#99CCFF;font-size:7pt;font-family:Tahoma;font-weight:bold;width:25em;text-align:left;height:4.5em;}
    	#tipoD05{color:#000066;background:#99CCFF;font-size:7pt;font-family:Tahoma;font-weight:bold;width:50em;text-align:left;height:4.5em;}
    	#tipoD06{color:#000066;background:#99CCFF;font-size:7pt;font-family:Tahoma;font-weight:bold;width:2.5em;text-align:center;height:4.5em;}
    	#tipoD07{color:#000066;background:#99CCFF;font-size:7pt;font-family:Tahoma;font-weight:bold;width:3em;text-align:center;height:4.5em;}
    	#tipoD08{color:#000066;background:#99CCFF;font-size:7pt;font-family:Tahoma;font-weight:bold;width:20em;text-align:left;height:4.5em;}
    	#tipoD09{color:#000066;background:#99CCFF;font-size:7pt;font-family:Tahoma;font-weight:bold;width:20em;text-align:left;height:4.5em;}
    	#tipoD10{color:#000066;background:#99CCFF;font-size:7pt;font-family:Tahoma;font-weight:bold;width:20em;text-align:left;height:4.5em;}
    	#tipoD11{color:#000066;background:#99CCFF;font-size:7pt;font-family:Tahoma;font-weight:bold;width:3em;text-align:center;height:4.5em;}
    	#tipoD12{color:#000066;background:#99CCFF;font-size:7pt;font-family:Tahoma;font-weight:bold;width:3em;text-align:center;height:4.5em;}
    	#tipoD13{color:#000066;background:#99CCFF;font-size:7pt;font-family:Tahoma;font-weight:bold;width:3em;text-align:center;height:4.5em;}
    	#tipoD14{color:#000066;background:#99CCFF;font-size:7pt;font-family:Tahoma;font-weight:bold;width:3em;text-align:center;height:4.5em;}
    	#tipoD15{color:#000066;background:#99CCFF;font-size:7pt;font-family:Tahoma;font-weight:bold;width:20em;text-align:left;height:4.5em;}
    	#tipoD16{color:#000066;background:#99CCFF;font-size:7pt;font-family:Tahoma;font-weight:bold;width:30em;text-align:left;height:4.5em;}
    	#tipoD17{color:#000066;background:#99CCFF;font-size:7pt;font-family:Tahoma;font-weight:bold;width:40em;text-align:left;height:3em;}
    	
    	#tipoL00{color:#000066;background:#DDDDDD;font-size:6pt;font-family:Tahoma;font-weight:bold;width:8em;text-align:center;height:4.5em;}
    	#tipoLCK{color:#000066;background:#DDDDDD;font-size:7pt;font-family:Tahoma;font-weight:bold;width:10em;text-align:center;height:4.5em;}
    	
    	#tipoL01{color:#000066;background:#DDDDDD;font-size:7pt;font-family:Tahoma;font-weight:bold;width:10em;text-align:center;height:4.5em;}
    	#tipoL001{color:#000066;background:#999999;font-size:7pt;font-family:Tahoma;font-weight:bold;width:10em;text-align:center;height:1em;}
    	#tipoLE01{color:#000066;background:#CC99FF;font-size:7.2pt;font-family:Tahoma;font-weight:bold;width:20em;text-align:center;height:3em;}
    	#tipoL02{color:#000066;background:#DDDDDD;font-size:7pt;font-family:Tahoma;font-weight:bold;width:8em;text-align:center;height:4.5em;}
    	#tipoL03{color:#000066;background:#DDDDDD;font-size:7pt;font-family:Tahoma;font-weight:bold;width:25em;text-align:center;height:4.5em;}
    	#tipoL04{color:#000066;background:#DDDDDD;font-size:7pt;font-family:Tahoma;font-weight:bold;width:25em;text-align:left;height:4.5em;}
    	#tipoL05{color:#000066;background:#DDDDDD;font-size:7pt;font-family:Tahoma;font-weight:bold;width:50em;text-align:left;height:4.5em;}
    	#tipoL06{color:#000066;background:#DDDDDD;font-size:7pt;font-family:Tahoma;font-weight:bold;width:2.5em;text-align:center;height:4.5em;}
    	#tipoL07{color:#000066;background:#DDDDDD;font-size:7pt;font-family:Tahoma;font-weight:bold;width:3em;text-align:center;height:4.5em;}
    	#tipoL08{color:#000066;background:#DDDDDD;font-size:7pt;font-family:Tahoma;font-weight:bold;width:20em;text-align:left;height:4.5em;}
    	#tipoL09{color:#000066;background:#DDDDDD;font-size:7pt;font-family:Tahoma;font-weight:bold;width:20em;text-align:left;height:4.5em;}
    	#tipoL10{color:#000066;background:#DDDDDD;font-size:7pt;font-family:Tahoma;font-weight:bold;width:20em;text-align:left;height:4.5em;}
    	#tipoL11{color:#000066;background:#DDDDDD;font-size:7pt;font-family:Tahoma;font-weight:bold;width:3em;text-align:center;height:4.5em;}
    	#tipoL12{color:#000066;background:#DDDDDD;font-size:7pt;font-family:Tahoma;font-weight:bold;width:3em;text-align:center;height:4.5em;}
    	#tipoL13{color:#000066;background:#DDDDDD;font-size:7pt;font-family:Tahoma;font-weight:bold;width:3em;text-align:center;height:4.5em;}
    	#tipoL14{color:#000066;background:#DDDDDD;font-size:7pt;font-family:Tahoma;font-weight:bold;width:3em;text-align:center;height:4.5em;}
    	#tipoL15{color:#000066;background:#DDDDDD;font-size:7pt;font-family:Tahoma;font-weight:bold;width:20em;text-align:left;height:4.5em;}
    	#tipoL16{color:#000066;background:#DDDDDD;font-size:7pt;font-family:Tahoma;font-weight:bold;width:30em;text-align:left;height:4.5em;}
    	#tipoL17{color:#000066;background:#DDDDDD;font-size:7pt;font-family:Tahoma;font-weight:bold;width:40em;text-align:left;height:3em;}
    	
    	#tipoRCK{color:#000066;background:#CC99FF;font-size:7pt;font-family:Tahoma;font-weight:bold;width:10em;text-align:center;height:4.5em;}
    	
    </style>
</head>
<body onload=ira() BGCOLOR="FFFFFF" oncontextmenu = "return true" onselectstart = "return true" ondragstart = "return true">
<BODY TEXT="#000066">
<script type="text/javascript">
<!--
	function enter()
	{
		document.forms.ListaP.submit();
	}

//-->
</script>
<?php
include_once("conex.php");
/**********************************************************************************************************************  
	   PROGRAMA : ListaP.php
	   Fecha de Liberación : 2008-06-10
	   Autor : Ing. Pedro Ortiz Tamayo
	   Version Actual : 2008-06-10
	   
	   OBJETIVO GENERAL :Este programa ofrece al usuario una interface gráfica que permite visualizar de forma matricial
	   los abonos a cuentas de los pacientes de la Unidad Odontologica.
	   
	   
	   REGISTRO DE MODIFICACIONES :
	   
	   .2008-06-10
	   		Release de Versión Beta.
	   		
***********************************************************************************************************************/

session_start();
if(!isset($_SESSION['user']))
	echo "error";
else
{
	$key = substr($user,2,strlen($user));
	echo "<form name='ListaP' action='ListaP.php' method=post>";
	

	

	echo "<center><input type='HIDDEN' name= 'empresa' value='".$empresa."'>";
	echo "<meta http-equiv='refresh' content='60;url=/matrix/soe/reportes/listaP.php?empresa=".$empresa."'>";
	if(isset($num) and $num > 0)
	{
		for ($i=0;$i<$num;$i++)
		{
			if(isset($CHECK[$i]))
			{
				$query =  " update ".$empresa."_000134 set Activo = 'on' ";
				$query .=  "  where Fecha      = '".$wimpre[$i][0]."'";
				$query .=  "    and Hora       = '".$wimpre[$i][1]."'";
				$query .=  "    and Historia   = '".$wimpre[$i][2]."'";
				$query .=  "    and Ingreso    = '".$wimpre[$i][3]."'";
				$query .=  "    and Odontologo = '".$wimpre[$i][4]."'";
				$err1 = mysql_query($query,$conex) or die("ERROR ACTUALIZANDO ABONOS : ".mysql_errno().":".mysql_error());
			}
			else
			{
				$query =  " update ".$empresa."_000134 set Activo = 'off' ";
				$query .=  "  where Fecha      = '".$wimpre[$i][0]."'";
				$query .=  "    and Hora       = '".$wimpre[$i][1]."'";
				$query .=  "    and Historia   = '".$wimpre[$i][2]."'";
				$query .=  "    and Ingreso    = '".$wimpre[$i][3]."'";
				$query .=  "    and Odontologo = '".$wimpre[$i][4]."'";
				$err1 = mysql_query($query,$conex) or die("ERROR ACTUALIZANDO ABONOS : ".mysql_errno().":".mysql_error());
			}
				
		}
	}
	$wimpre=array();
	echo "<table border=0 align=center>";
	echo "<tr><td align=center><IMG SRC='/matrix/images/medical/SOE/logo_".$empresa.".png' width=40%></td></tr>";
	echo "<tr><td align=center id=tipo20>CLINICA LAS AMERICAS</td></tr>";
	echo "<tr><td align=center id=tipo20>LISTA DE ABONOS A CUENTAS UNIDAD ODONTOLOGICA A : ".date("Y-m-d")."</td></tr>";
	echo "<tr><td align=center id=tipo21>INFORMACION GENERAL</td></tr>";
	echo "<tr><td align=left id=tipo20>Ver. 2008-09-08</td></tr></table>";
	echo "<table border=0 align=center id=tipo00>";
	echo "<tr><td id=tipoTCK>CHECK</td><td id=tipoT01>FECHA</td><td id=tipoT02>HORA</td><td id=tipoT03>PACIENTE</td><td id=tipoT06>ING</td><td id=tipoT04>ODONTOLOGO</td><td id=tipoT05>DESCRIPCION</td></tr>";
	//                  0       1     2       3          4            5          6 
	$query  = "SELECT Fecha, Hora, Historia, Ingreso, Descripcion, Odontologo, Activo  FROM ".$empresa."_000134 ";
    $query .= " where Activo = 'off' ";
    $query .= " UNION ";
    $query .= " SELECT Fecha, Hora, Historia, Ingreso, Descripcion, Odontologo, Activo  FROM ".$empresa."_000134 ";
    $query .= " where Activo = 'on' ";
    $query .= "   and Fecha = '".date("Y-m-d")."' ";
	$query .= "   Order by Fecha desc, Hora desc ";
	$err = mysql_query($query,$conex) or die(mysql_errno().":".mysql_error());
	$num = mysql_num_rows($err);
	echo "<input type='HIDDEN' name= 'num' value='".$num."'>";
	for ($i=0;$i<$num;$i++)
	{
		$row = mysql_fetch_array($err);
		$wimpre[$i][0] = $row[0]; 
		$wimpre[$i][1] = $row[1];  
		$wimpre[$i][2] = $row[2]; //HISTORIA 
		$wimpre[$i][3] = $row[3]; 
		$wimpre[$i][4] = $row[5]; //ODONTOLOGO
		$wimpre[$i][5] = $row[4]; 
		$wimpre[$i][8] = $row[6]; 
		$query = "SELECT Pacap1, Pacap2, Pacno1, Pacno2 FROM ".$empresa."_000100 ";
	    $query .= " where Pachis = '".$row[2]."' ";
		$err1 = mysql_query($query,$conex) or die(mysql_errno().":".mysql_error());
		$row1 = mysql_fetch_array($err1);
		$wimpre[$i][6] = $row1[2]." ".$row1[3]." ".$row1[0]." ".$row1[1];  //PACIENTE
		$query = "SELECT Mednom FROM ".$empresa."_000051 ";
	    $query .= " where Medusu = '".$wimpre[$i][4]."' ";
		$err1 = mysql_query($query,$conex) or die(mysql_errno().":".mysql_error());
		$row1 = mysql_fetch_array($err1);
		$wimpre[$i][7] = $row1[0]; //ODONTOLOGO
		echo "<input type='HIDDEN' name= 'wimpre[".$i."][0]' value='".$wimpre[$i][0]."'>";
		echo "<input type='HIDDEN' name= 'wimpre[".$i."][1]' value='".$wimpre[$i][1]."'>";
		echo "<input type='HIDDEN' name= 'wimpre[".$i."][2]' value='".$wimpre[$i][2]."'>";
		echo "<input type='HIDDEN' name= 'wimpre[".$i."][3]' value='".$wimpre[$i][3]."'>";
		echo "<input type='HIDDEN' name= 'wimpre[".$i."][4]' value='".$wimpre[$i][4]."'>";
	}
	for ($i=0;$i<$num;$i++)
	{
		if($i % 2 == 0)
		{
			$tipo="tipoD";
			$tipo1="tipoD";
			$class="tipo4A";
		}
		else
		{
			$tipo="tipoL";
			$tipo1="tipoL";
			$class="tipo4";
		}
		if($wimpre[$i][8] == "on")
		{
			$class="tipo4B";
			$tipo1="tipoR";
			echo "<tr><td id=".$tipo1."CK><input type='checkbox' checked name='CHECK[".$i."]' onclick='enter()' class=".$class."></td>";
		}
		else
			echo "<tr><td id=".$tipo1."CK><input type='checkbox' name='CHECK[".$i."]' onclick='enter()' class=".$class."></td>";
		echo "<td id=".$tipo."01>".$wimpre[$i][0]."</td><td id=".$tipo."02>".$wimpre[$i][1]."</td><td id=".$tipo."03>".$wimpre[$i][2]."-".$wimpre[$i][6]."</td><td id=".$tipo."06>".$wimpre[$i][3]."</td><td id=".$tipo."04>".$wimpre[$i][4]."-".$wimpre[$i][7]."</td><td id=".$tipo."05><textarea name='wcoma' cols=88 readonly='readonly' rows=2 class=tipo3A>".$wimpre[$i][5]."</textarea></td></tr>";
	}
	echo "</table>";
}
?>
</body>
</html>