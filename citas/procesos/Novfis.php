<html>
<head>
<title>HORARIOS DE FISIOTERAPIA</title>
<style type="text/css">
    	//body{background:white url(portal.gif) transparent center no-repeat scroll;}
    	#tipo1{color:#000000;background:#FFFFFF;font-size:10pt;font-family:Tahoma;font-weight:normal;}
    	#tipo2{color:#000066;background:#FFFFFF;font-size:7pt;font-family:Tahoma;font-weight:bold;}
    	.tipo3{color:#000066;background:#FFFFFF;font-size:7pt;font-family:Tahoma;font-weight:bold;text-align:left;}
    	.tipo4{color:#000066;background:#dddddd;font-size:6pt;font-family:Tahoma;font-weight:bold;text-align:center;}
    	#tipo5{color:#000066;background:#FFFFFF;font-size:10pt;font-family:Tahoma;font-weight:bold;}
    	.tipo6{color:#000066;background:#FFFFFF;font-size:10pt;font-family:Tahoma;font-weight:bold;text-align:center;}
    	#tipo7{color:#FFFFFF;background:#000066;font-size:12pt;font-family:Tahoma;font-weight:bold;width:30em;}
    	#tipo8{color:#99CCFF;background:#000066;font-size:6pt;font-family:Tahoma;font-weight:bold;}
    	#tipo9{color:#660000;background:#dddddd;font-size:8pt;font-family:Tahoma;font-weight:bold;text-align:center;}
    	#tipo10{color:#FFFFFF;background:#000066;font-size:10pt;font-family:Tahoma;font-weight:bold;text-align:center;}
    	#tipo11{color:#000066;background:#999999;font-size:7pt;font-family:Tahoma;font-weight:bold;text-align:center;}
    	#tipo12{color:#000066;background:#FFFFFF;font-size:7pt;font-family:Tahoma;font-weight:bold;text-align:left;}
    	#tipo13{color:#000066;background:#99CCFF;font-size:7pt;font-family:Tahoma;font-weight:bold;text-align:left;}
    	#tipo14{color:#FFFFFF;background:#000066;font-size:14pt;font-family:Tahoma;font-weight:bold;text-align:center;}
    	#tipo15{color:#000066;background:#FFFFFF;font-size:7pt;font-family:Tahoma;font-weight:bold;text-align:center;}
    	#tipo16{color:#000066;background:#99CCFF;font-size:7pt;font-family:Tahoma;font-weight:bold;text-align:center;}
    	
    	#tipoG00{color:#000066;background:#FFFFFF;font-size:7pt;font-family:Tahoma;font-weight:bold;table-layout:fixed;text-align:center;}
    	#tipoG01{color:#000066;background:#FFFFFF;font-size:7pt;font-family:Tahoma;font-weight:bold;width:8.5em;text-align:center;height:3em;}
    	#tipoG54{color:#000066;background:#999999;font-size:7pt;font-family:Tahoma;font-weight:bold;width:8.5em;text-align:center;height:3em;}
    	#tipoG58{color:#000066;background:#999999;font-size:7pt;font-family:Tahoma;font-weight:bold;width:15em;text-align:center;height:3em;}
    	#tipoG59{color:#000066;background:#DDDDDD;font-size:7pt;font-family:Tahoma;font-weight:bold;width:15em;text-align:center;height:3em;}
    	#tipoG60{color:#000066;background:#CCCCCC;font-size:7pt;font-family:Tahoma;font-weight:bold;width:15em;text-align:center;height:3em;}
    	#tipoG55{color:#000066;background:#99CCFF;font-size:7pt;font-family:Tahoma;font-weight:bold;width:59.5em;text-align:center;height:3em;}
    	#tipoG11{color:#FFFFFF;background:#99CCFF;font-size:7pt;font-family:Tahoma;font-weight:bold;width:8.5em;text-align:center;height:3em;}
    	#tipoG11A{color:#FFFFFF;background:#9999FF;font-size:7pt;font-family:Tahoma;font-weight:bold;width:8.5em;text-align:center;height:3em;}
    	#tipoG21{color:#FFFFFF;background:#CC3333;font-size:7pt;font-family:Tahoma;font-weight:bold;width:8.5em;text-align:center;height:3em;}
    	#tipoG21A{color:#FFFFFF;background:#FFOOOO;font-size:7pt;font-family:Tahoma;font-weight:bold;width:8.5em;text-align:center;height:3em;}
    	#tipoG32{color:#FF0000;background:#FFFF66;font-size:7pt;font-family:Tahoma;font-weight:bold;width:8.5em;text-align:center;height:3em;}
    	#tipoG32A{color:#FF0000;background:#FFCC66;font-size:7pt;font-family:Tahoma;font-weight:bold;width:8.5em;text-align:center;height:3em;}
    	#tipoG33{color:#006600;background:#FFFF66;font-size:7pt;font-family:Tahoma;font-weight:bold;width:8.5em;text-align:center;height:3em;}
    	#tipoG34{color:#000066;background:#FFFF66;font-size:7pt;font-family:Tahoma;font-weight:bold;width:8.5em;text-align:center;height:3em;}
    	#tipoG42{color:#FF0000;background:#00CC66;font-size:7pt;font-family:Tahoma;font-weight:bold;width:8.5em;text-align:center;height:3em;}
    	#tipoG41{color:#FFFFFF;background:#00CC66;font-size:7pt;font-family:Tahoma;font-weight:bold;width:8.5em;text-align:center;height:3em;}
    	#tipoG41A{color:#FFFFFF;background:#66FF00;font-size:7pt;font-family:Tahoma;font-weight:bold;width:8.5em;text-align:center;height:3em;}
    	#tipoG44{color:#000066;background:#00CC66;font-size:7pt;font-family:Tahoma;font-weight:bold;width:8.5em;text-align:center;height:3em;}
    	
    	#tipoM00{color:#000066;background:#FFFFFF;font-size:7pt;font-family:Tahoma;font-weight:bold;table-layout:fixed;text-align:center;}
    	#tipoM01{color:#000066;background:#DDDDDD;font-size:7pt;font-family:Tahoma;font-weight:bold;width:40em;text-align:left;height:3em;}
    	#tipoM02{color:#000066;background:#99CCFF;font-size:7pt;font-family:Tahoma;font-weight:bold;width:40em;text-align:left;height:3em;}
    	
    </style>
</head>
<body BGCOLOR='#FFFFFF' TEXT='#000066'>
<script type="text/javascript">
<!--
	function enter()
	{
		document.forms.Novfis.submit();
	}
	function teclado()  
	{ 
		if (event.keyCode < 48 || event.keyCode > 57  || event.keyCode == 13) event.returnValue = false;
	}
//-->
</script>
<?php
include_once("conex.php");
function ultimoDia($mes,$ano){ 
    $udia=28; 
    while (checkdate($mes,$udia + 1,$ano)){ 
       $udia++; 
    } 
    return $udia; 
}
echo "<center>";
echo "<table border=0 align=center>";
echo "<tr><td align=center bgcolor='#cccccc'><A NAME='Arriba'><font size=6><b>Horarios De Fisioterapia</b></font></a></tr></td>";
echo "<tr><td align=center bgcolor='#cccccc'><font size=2> <b> Novfis.php Ver. 2010-01-14</b></font></tr></td></table>";
echo "</center>";
$wfec=date("Y-m-d");
echo "<form name='Novfis' action='Novfis.php' method=post>";
session_start();
if(!isset($_SESSION['user']))
	echo "Error Usuario NO Registrado";
else
{
	

	

	echo "<input type='HIDDEN' name= 'empresa' value='".$empresa."'>";
	if(isset($ok))
	{
		echo "<center><table border=0>";
		echo "<tr><td bgcolor=#cccccc align=center><b>INCONSISTENCIAS EN ACTUALIZACION</b></td></tr>";
		for ($i=0;$i<12;$i++)
			for ($j=0;$j<7;$j++)
			{
				$dia=$j + 1;
				$HI=($i + 7)."00";
				if(strlen($HI) < 4)
					$HI="0".$HI;
				if($west[$i][$j] == 1)
				{
					$query =  " Select count(*) from ".$empresa."_000017  where Terapeuta='".substr($wter,0,strpos($wter,"-"))."' and Fecha >= '".$Wfechai."' and Fecha <= '".$Wfechaf."' and DAYOFWEEK(Fecha) = ".$dia." and Hora_inicial='".$HI."' and Actividad < 2 ";
					$err3 = mysql_query($query,$conex) or die(mysql_errno().":".mysql_error());
					$row = mysql_fetch_array($err3);
					if($row[0] == 0)
					{
						$query =  " update ".$empresa."_000016 set Personas=".$wper[$i][$j].", Adicionales=".$wadi[$i][$j].", Tipo='".$wtip[$i][$j]."' where Terapeuta='".substr($wter,0,strpos($wter,"-"))."' and Fecha_I='".$Wfechai."' and Fecha_F='".$Wfechaf."' and Dia=".$dia." and Hora_inicial='".$HI."'";
						$err3 = mysql_query($query,$conex) or die(mysql_errno().":".mysql_error());
					}
					else
					{
						echo "<tr><td bgcolor=#dddddd align=center>HORARIO : Terapeuta=".substr($wter,0,strpos($wter,"-"))." Y Fecha_I=".$Wfechai." Y Fecha_F=".$Wfechaf." Y Dia=".$dia." Y Hora_inicial=".$HI." NO SE MODIFICO. CONTIENE TURNOS DE PACIENTES </td></tr>";
					}
				}
				else
				{
					$fecha = date("Y-m-d");
					$hora = (string)date("H:i:s");
	        		$query = "insert ".$empresa."_000016 (medico,fecha_data,hora_data, Terapeuta, Fecha_I, Fecha_F, Dia, Hora_inicial, Personas, Adicionales, Tipo, Estado,seguridad) values ('citasfi','".$fecha."','".$hora."','".substr($wter,0,strpos($wter,"-"))."','".$Wfechai."','".$Wfechaf."',".$dia.",'".$HI."',".$wper[$i][$j].",".$wadi[$i][$j].",'".$wtip[$i][$j]."','on','C-citasfi')";
					$err1 = mysql_query($query,$conex) or die(mysql_errno().":".mysql_error());
				}
			}
		echo "</table>";
		unset($ok);
		unset($wter);
	}
	if(!isset($wter) or !isset($wanop) or !isset($wmes) or $wanop < 2010 or $wanop > 2040 or (isset($wter) and $wter == "SELECCIONAR"))
	{
		echo "<center><table border=0>";
		echo "<tr><td align=center colspan=2><b>PROMOTORA MEDICA LAS AMERICAS S.A.<b></td></tr>";
		echo "<tr><td align=center  id=tipo14 colspan=2>HORARIOS DE FISIOTERAPIA</td></tr>";
		echo "<tr><td align=center bgcolor='#cccccc'><b>Terapeuta : </td><td bgcolor=#cccccc align=center>";
		$query = "SELECT Codigo, Nombre  from  ".$empresa."_000015 where estado='on' order by Nombre";
		$err = mysql_query($query,$conex) or die(mysql_errno().":".mysql_error());
		$num = mysql_num_rows($err);
		echo "<select name='wter' id=tipo1>";
		if ($num>0)
		{
			echo "<option>SELECCIONAR</option>";
			for ($i=0;$i<$num;$i++)
			{
				$row = mysql_fetch_array($err);
				echo "<option>".$row[0]."-".$row[1]."</option>";
			}
		}
		echo "</select>";
		echo"</td></tr>";
		echo "<tr><td bgcolor=#cccccc align=center>Año de Proceso</td>";
		echo "<td bgcolor=#cccccc align=center><input type='TEXT' name='wanop' size=4 maxlength=4 value=".date("Y")." onkeypress='teclado()'></td></tr>";
		echo "<tr><td bgcolor=#cccccc align=center>Mes de Proceso</td>";
		echo "<td bgcolor=#cccccc align=center>";
		echo "<select name='wmes' id=tipo1>";
		echo "<option>01</option>";
		echo "<option>02</option>";
		echo "<option>03</option>";
		echo "<option>04</option>";
		echo "<option>05</option>";
		echo "<option>06</option>";
		echo "<option>07</option>";
		echo "<option>08</option>";
		echo "<option>09</option>";
		echo "<option>10</option>";
		echo "<option>11</option>";
		echo "<option>12</option>";
		echo "</select>";
		echo"</td></tr>";
		echo "<tr><td bgcolor='#999999' align=center colspan=2><input type='submit' value='IR'></td></tr>";
		echo "</table>";
	}
	else
	{
		echo "<center><table border=0>";
		echo "<tr><td align=center colspan=2><b>PROMOTORA MEDICA LAS AMERICAS S.A.<b></td></tr>";
		echo "<tr><td align=center  id=tipo14 colspan=2>HORARIOS DE FISIOTERAPIA</td></tr>";
		echo "<tr><td align=center bgcolor='#cccccc'><b>Terapeuta : </b></td><td bgcolor=#cccccc align=center>".$wter."</td></tr>";
		echo "<tr><td align=center bgcolor='#cccccc'>Año de Proceso</td><td bgcolor=#cccccc align=center>".$wanop."</td></tr>";
		echo "<tr><td bgcolor=#cccccc align=center>Mes de Proceso</td><td bgcolor=#cccccc align=center>".$wmes."</td></tr>";
		echo "</table>";
		echo "<center><input type='HIDDEN' name= 'wter' value='".$wter."'>";
		echo "<center><input type='HIDDEN' name= 'wanop' value='".$wanop."'>";
		echo "<center><input type='HIDDEN' name= 'wmes' value='".$wmes."'>";
		$wper=array();
		$wadi=array();
		$wtip=array();
		for ($i=0;$i<12;$i++)
			for ($j=0;$j<7;$j++)
			{
				$wper[$i][$j]=0;
				$wadi[$i][$j]=0;
				$wtip[$i][$j]="A";
				$west[$i][$j]=0;
			}
		$dias=array();
		$dias[1]="DOM";
		$dias[2]="LUN";
		$dias[3]="MAR";
		$dias[4]="MIE";
		$dias[5]="JUE";
		$dias[6]="VIE";
		$dias[7]="SAB";
		$fase="07:00-08:00";
		$horas=array();
		for ($i=0;$i<12;$i++)
		{
			$horas[$i]=$fase;
			$hor1=(integer)substr($fase,0,2) + 1;
			if($hor1 < 10)
				$hor1="0".$hor1;
			$min1="00";
			$hor2=(integer)substr($fase,6,2) + 1;
			if($hor2 < 10)
				$hor2="0".$hor2;
			$min2="00";
			$fase=$hor1.":".$min1."-".$hor2.":".$min2;
		}
		echo "<br><center><table border=0 align=center id=tipoG00>";
		echo "<tr><td id=tipoG01></td>";
		for ($j=0;$j<7;$j++)
			echo "<td id=tipoG58>".$dias[$j+1]."</td>";
		echo "</tr>";
		echo "<tr><td id=tipoG01></td>";
		for ($j=0;$j<7;$j++)
			echo "<td id=tipoG60>PAC - ADI - TIP</td>";
		echo "</tr>";
		$Wfechai=$wanop."-".$wmes."-01";
		$Wfechaf=$wanop."-".$wmes."-".ultimoDia($wmes,$wanop);
		echo "<center><input type='HIDDEN' name= 'Wfechai' value='".$Wfechai."'>";
		echo "<center><input type='HIDDEN' name= 'Wfechaf' value='".$Wfechaf."'>";
		$query = "SELECT Dia, Hora_inicial, Personas, Adicionales, Tipo from  ".$empresa."_000016 ";
		$query .=" where estado='on' ";
		$query .="   and Terapeuta = '".substr($wter,0,strpos($wter,"-"))."'";
		$query .="   and Fecha_I = '".$Wfechai."'";
		$query .="   and Fecha_F = '".$Wfechaf."'";
		$query .="   and Estado = 'on' ";
		$err = mysql_query($query,$conex) or die(mysql_errno().":".mysql_error());
		$num = mysql_num_rows($err);
		if ($num>0)
		{
			for ($i=0;$i<$num;$i++)
			{
				$row = mysql_fetch_array($err);
				$fila=(integer)substr($row[1],0,2) - 7;
				$columna=$row[0] - 1;
				$wper[$fila][$columna]=$row[2];
				$wadi[$fila][$columna]=$row[3];
				$wtip[$fila][$columna]=$row[4];
				$west[$fila][$columna]=1;
			}
		}
		for ($i=0;$i<12;$i++)
		{
			echo "<tr><td id=tipoG54>".$horas[$i]."</td>";
			for ($j=0;$j<7;$j++)
			{
				echo "<td id=tipoG59><input type='TEXT' name='wper[".$i."][".$j."]' size=2 maxlength=2 value=".$wper[$i][$j]." onkeypress='teclado()'><input type='TEXT' name='wadi[".$i."][".$j."]' size=2 maxlength=2 value=".$wadi[$i][$j]." onkeypress='teclado()'>";
				echo "<select name='wtip[".$i."][".$j."]' id=tipo1>";
				if($wtip[$i][$j] == "A")
				{
					echo "<option selected>A</option>";
					echo "<option>H</option>";
				}
				else
				{
					echo "<option>A</option>";
					echo "<option selected>H</option>";
				}
				echo "</select></td>";
				echo "<center><input type='HIDDEN' name= 'west[".$i."][".$j."]' value='".$west[$i][$j]."'>";
			}
			echo "</tr>";
		}
		echo "<tr><td bgcolor='#CCCCCC' align=center colspan=8>DATOS COMPLETOS<input type='checkbox' name='ok'></td></tr>";
		echo "<tr><td bgcolor='#999999' align=center colspan=8><input type='submit' value='IR'></td></tr>";
		echo "</table><br>";
	}
	include_once("free.php");
}
?>
</body>
</html>