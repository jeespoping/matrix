<html>
<head>
  	<title>MATRIX Programa de Turnos de Fisioterapia</title>
  	<!-- UTF-8 is the recommended encoding for your pages -->
 
    <title>Zapatec DHTML Calendar</title>

<!-- Loading Theme file(s) -->
    <link rel="stylesheet" href="../../zpcal/themes/winter.css" />

<!-- Loading Calendar JavaScript files -->
    <script type="text/javascript" src="../../zpcal/src/utils.js"></script>
    <script type="text/javascript" src="../../zpcal/src/calendar.js"></script>
    <script type="text/javascript" src="../../zpcal/src/calendar-setup.js"></script>
    <!-- Loading language definition file -->
    <script type="text/javascript" src="../../zpcal/lang/calendar-sp.js"></script>
    <style type="text/css">
    	//body{background:white url(portal.gif) transparent center no-repeat scroll;}
    	#tipo1{color:#000066;background:#FFFFFF;font-size:7pt;font-family:Tahoma;font-weight:bold;}
    	#tipo2{color:#000066;background:#FFFFFF;font-size:7pt;font-family:Tahoma;font-weight:bold;}
    	.tipo3{color:#000066;background:#FFFFFF;font-size:7pt;font-family:Tahoma;font-weight:bold;text-align:left;}
    	.tipo4{color:#000066;background:#dddddd;font-size:6pt;font-family:Tahoma;font-weight:bold;text-align:center;}
    	#tipo5{color:#000066;background:#FFFFFF;font-size:10pt;font-family:Tahoma;font-weight:bold;}
    	.tipo6{color:#000066;background:#FFFFFF;font-size:10pt;font-family:Tahoma;font-weight:bold;text-align:center;}
    	#tipo7{color:#FFFFFF;background:#000066;font-size:12pt;font-family:Tahoma;font-weight:bold;width:30em;}
    	#tipo8{color:#99CCFF;background:#000066;font-size:6pt;font-family:Tahoma;font-weight:bold;}
    	#tipo9{color:#660000;background:#dddddd;font-size:8pt;font-family:Tahoma;font-weight:bold;text-align:center;}
    	#tipo10{color:#FFFFFF;background:#000066;font-size:10pt;font-family:Tahoma;font-weight:bold;text-align:center;}
    	#tipo11{color:#000066;background:#999999;font-size:7pt;font-family:Tahoma;font-weight:bold;text-align:center;}
    	#tipo12{color:#000066;background:#FFFFFF;font-size:7pt;font-family:Tahoma;font-weight:bold;text-align:left;}
    	#tipo13{color:#000066;background:#99CCFF;font-size:7pt;font-family:Tahoma;font-weight:bold;text-align:left;}
    	#tipo14{color:#FFFFFF;background:#000066;font-size:14pt;font-family:Tahoma;font-weight:bold;text-align:center;}
    	#tipo15{color:#000066;background:#FFFFFF;font-size:7pt;font-family:Tahoma;font-weight:bold;text-align:center;}
    	#tipo16{color:#000066;background:#99CCFF;font-size:7pt;font-family:Tahoma;font-weight:bold;text-align:center;}
    	
    	#tipoG00{color:#000066;background:#FFFFFF;font-size:7pt;font-family:Tahoma;font-weight:bold;table-layout:fixed;text-align:center;}
    	#tipoG01{color:#000066;background:#FFFFFF;font-size:7pt;font-family:Tahoma;font-weight:bold;width:8.5em;text-align:center;height:3em;}
    	#tipoG54{color:#000066;background:#DDDDDD;font-size:7pt;font-family:Tahoma;font-weight:bold;width:8.5em;text-align:center;height:3em;}
    	#tipoG54A{color:#000066;background:#DDDDDD;font-size:7pt;font-family:Tahoma;font-weight:bold;width:8.5em;text-align:center;height:3em;}
    	#tipoG55{color:#000066;background:#DDDDDD;font-size:7pt;font-family:Tahoma;font-weight:bold;width:59.5em;text-align:center;height:3em;}
    	#tipoG11{color:#FFFFFF;background:#99CCFF;font-size:7pt;font-family:Tahoma;font-weight:bold;width:8.5em;text-align:center;height:3em;}
    	#tipoG11A{color:#FFFFFF;background:#9999FF;font-size:7pt;font-family:Tahoma;font-weight:bold;width:8.5em;text-align:center;height:3em;}
    	#tipoG21{color:#FFFFFF;background:#CC3333;font-size:7pt;font-family:Tahoma;font-weight:bold;width:8.5em;text-align:center;height:3em;}
    	#tipoG21A{color:#FFFFFF;background:#FF0000;font-size:7pt;font-family:Tahoma;font-weight:bold;width:8.5em;text-align:center;height:3em;}
    	#tipoG21B{color:#FFFFFF;background:#FFFFFF;font-size:7pt;font-family:Tahoma;font-weight:bold;width:8.5em;text-align:center;height:3em;}
    	#tipoG32{color:#FF0000;background:#FFFF66;font-size:7pt;font-family:Tahoma;font-weight:bold;width:8.5em;text-align:center;height:3em;}
    	#tipoG32A{color:#FF0000;background:#FFCC66;font-size:7pt;font-family:Tahoma;font-weight:bold;width:8.5em;text-align:center;height:3em;}
    	#tipoG33{color:#006600;background:#FFFF66;font-size:7pt;font-family:Tahoma;font-weight:bold;width:8.5em;text-align:center;height:3em;}
    	#tipoG34{color:#000066;background:#FFFF66;font-size:7pt;font-family:Tahoma;font-weight:bold;width:8.5em;text-align:center;height:3em;}
    	#tipoG42{color:#FF0000;background:#00CC66;font-size:7pt;font-family:Tahoma;font-weight:bold;width:8.5em;text-align:center;height:3em;}
    	#tipoG41{color:#FFFFFF;background:#00CC66;font-size:7pt;font-family:Tahoma;font-weight:bold;width:8.5em;text-align:center;height:3em;}
    	#tipoG41A{color:#FFFFFF;background:#66FF00;font-size:7pt;font-family:Tahoma;font-weight:bold;width:8.5em;text-align:center;height:3em;}
    	#tipoG44{color:#000066;background:#00CC66;font-size:7pt;font-family:Tahoma;font-weight:bold;width:8.5em;text-align:center;height:3em;}
    	
    	#tipoM00{color:#000066;background:#FFFFFF;font-size:7pt;font-family:Tahoma;font-weight:bold;table-layout:fixed;text-align:center;}
    	#tipoM01{color:#000066;background:#DDDDDD;font-size:7pt;font-family:Tahoma;font-weight:bold;width:40em;text-align:left;height:3em;}
    	#tipoM02{color:#000066;background:#99CCFF;font-size:7pt;font-family:Tahoma;font-weight:bold;width:40em;text-align:left;height:3em;}
    	
    </style>
</head>
<body onload=ira() BGCOLOR="FFFFFF" oncontextmenu = "return true" onselectstart = "return true" ondragstart = "return true">
<BODY TEXT="#000066">
<script type="text/javascript">
<!--
	function ejecutar(path,tipo)
	{
		if(tipo == 1)
		{
			x=window.open(path,'','fullscreen=0,status=0,menubar=0,toolbar =0,directories =0,resizable=0,scrollbars =1,titlebar=0,width=900,height=425');
			x.moveTo(0,0);
		}
		else
		{
			x=window.open(path,'','fullscreen=0,status=0,menubar=0,toolbar =0,directories =0,resizable=0,scrollbars =1,titlebar=0,width=900,height=580');
			x.moveTo(0,0);
		}
	}
	function enter()
	{
		document.forms.Turfis.submit();
	}
	function teclado()  
	{ 
		if ((event.keyCode < 48 || event.keyCode > 57  || event.keyCode == 13) & event.keyCode != 46) event.returnValue = false;
	}
	function teclado1()  
	{ 
		if ((event.keyCode < 48 || event.keyCode > 57 ) & event.keyCode != 46 & event.keyCode != 13)  event.returnValue = false;
	}
	function teclado2()  
	{ 
		if ((event.keyCode < 48 || event.keyCode > 57 ) & (event.keyCode < 65 || event.keyCode > 90 ) & (event.keyCode < 97 || event.keyCode > 122 ) & event.keyCode != 13) event.returnValue = false;
	}
	function teclado3()  
	{ 
		if ((event.keyCode < 48 || event.keyCode > 57 ) & (event.keyCode < 65 || event.keyCode > 90 ) & (event.keyCode < 97 || event.keyCode > 122 ) & event.keyCode != 13 & event.keyCode != 45) event.returnValue = false;
	}

//-->
</script>
<?php
include_once("conex.php");
/**********************************************************************************************************************  
	   PROGRAMA : turfis.php
	   Fecha de Liberacion : 2010-01-28
	   Autor : Ing. Pedro Ortiz Tamayo
	   Version Actual : 2014-12-30
	   
	   OBJETIVO GENERAL :Este programa ofrece al usuario una interface grafica que permite grabar los turnos de las
	   Terapuetas de la unidad de Fisiatria.
	   
	   
	   REGISTRO DE MODIFICACIONES :
	   .2014-12-30
	   		Se modifico el programa para que cuando se modifique o actulice un registro de lock a la tabla 17.
	   		Se publico el programa InfoTurFis.php, el cual no se encontraba en producciÃ³n y estaba generando
	   		numerosos errores en la estadistica de Apache Server.
	   		
	   .2010-04-14
	   		Se modifico el programa para que cuando se digite en el tablero de turnos la cedula del paciente traiga el
	   		nombre y el responsable de la ultima cita asignada.
	   	
	   .2010-02-09
	   		Se modifico el programa para incluir en el tablero de citas la identificacion, la cedula y el responsable
	   		para no tenerlo que digitar nuevamente por cada cita. Estos campos se inicializan con el checkbox Iniciar.
	   	
	   .2010-01-28
	   		Release de Version Beta.
	   		
***********************************************************************************************************************/
function date_format_fis($fecha)
{
	$dia=substr($fecha,0,strpos($fecha,"/"));
	if(strlen($dia) < 2)
		$dia = "0".$dia;
	$mes=substr($fecha,strpos($fecha,"/")+1,strrpos($fecha,"/") - (strpos($fecha,"/")+1));
	if(strlen($mes) < 2)
		$mes = "0".$mes;
	$ano=substr($fecha,strrpos($fecha,"/")+1);
	$fecha=$ano."-".$mes."-".$dia;
	return $fecha;
}
function ultimoDia($mes,$ano){ 
    $udia=28; 
    while (checkdate($mes,$udia + 1,$ano)){ 
       $udia++; 
    } 
    return $udia; 
}


function ver($chain)
{
	if(strpos($chain,"-") === false)
		return $chain;
	else
		return substr($chain,0,strpos($chain,"-"));
}
function validar1($chain)
{
	// Funcion que permite validar la estructura de un numero Real
	$decimal ="/^(\+|-)?([[:digit:]]+)\.([[:digit:]]+)$/";
	if (preg_match($decimal,$chain,$occur))
		if(substr($occur[2],0,1)==0 and strlen($occur[2])!=1)
			return false;
		else
			return true;
	else
		return false;
}
function validar2($chain)
{
	// Funcion que permite validar la estructura de un numero Entero
	$regular="/^(\+|-)?([[:digit:]]+)$/";
	if (preg_match($regular,$chain,$occur))
		if(substr($occur[2],0,1)==0 and strlen($occur[2])!=1)
			return false;
		else
			return true;
	else
		return false;
}
function validar3($chain)
{
	// Funcion que permite validar la estructura de una fecha
	$fecha="/^([[:digit:]]{4})-([[:digit:]]{1,2})-([[:digit:]]{1,2})$/";
	if(preg_match($fecha,$chain,$occur))
	{
		if($occur[2] < 0 or $occur[2] > 12)
			return false;
		if(($occur[3] < 0 or $occur[3] > 31) or 
		  ($occur[2] == 4 and  $occur[3] > 30) or 
		  ($occur[2] == 6 and  $occur[3] > 30) or 
		  ($occur[2] == 9 and  $occur[3] > 30) or 
		  ($occur[2] == 11 and $occur[3] > 30) or 
		  ($occur[2] == 2 and  $occur[3] > 29 and bisiesto($occur[1])) or 
		  ($occur[2] == 2 and  $occur[3] > 28 and !bisiesto($occur[1])))
			return false;
		return true;
	}
	else
		return false;
}
function validar4($chain)
{
	// Funcion que permite validar la estructura de un dato alfanumerico
	$regular="/[A-Za-z0-9]/i";
	return (preg_match($regular,$chain));
}
function validar5($chain)
{
	// Funcion que permite validar la estructura de un dato numerico
	$regular="/^([0-9:])+$/";
	return (preg_match($regular,$chain));
}
function validar6($chain)
{
	// Funcion que permite validar la estructura de un campo Hora
	$hora="/^([[:digit:]]{1,2}):([[:digit:]]{1,2}):([[:digit:]]{1,2})$/";
	if(preg_match($hora,$chain,$occur))
		if($occur[1] < 0 or $occur[1] >23 or $occur[2]<0 or $occur[2]>59)
			return false;
		else
			return true;
	else
		return false;
}
function validar7($chain)
{
	// Funcion que permite validar la estructura de un campo Hora Especial
	$hora="/^([[:digit:]]{1,2}):([[:digit:]]{1,2})$/";
	if(preg_match($hora,$chain,$occur))
		if($occur[1] < 0 or $occur[1] >23 or ($occur[2]!=0 and $occur[2]!=30))
			return false;
		else
			return true;
	else
		return false;
}
function valgen($ok,$conex,$wced,$wnom,$wres,$wtip,&$werr,&$e)
{
	global $empresa;
	//VALIDACION DE DATOS GENERALES
	if(!validar4($wced))
	{
		$e=$e+1;
		$werr[$e]="ERROR O NO DIGITO CEDULA O ESTA INCORRECTA";
		$wsw=1;
	}
	if(!validar4($wnom))
	{
		$e=$e+1;
		$werr[$e]="ERROR O NO DIGITO NOMBRE O ESTA INCORRECTO";
		$wsw=1;
	}
	if($wres == "SELECCIONE")
	{
		$e=$e+1;
		$werr[$e]="ERROR NO SELECCIONO RESPONSABLE";
		$wsw=1;
	}
	if($wtip == "X-SELECCIONE")
	{
		$e=$e+1;
		$werr[$e]="ERROR NO SELECCIONO TIPO DE PACIENTE";
		$wsw=1;
	}
	
	if($e == -1)
		return true;
	else
		return false;
}


function ING_TUR($key,$conex,$wced,$wnom,$wres,$wobs,$wter,$wtip,$wfecha,$whin,&$werr,&$e,$Wnum,$wmax)
{
	global $empresa;
	$wsw=0;
	//VALIDACION DE EXISTENCIA DEL TURNO
	$query = "select Cedula, Nombre, Responsable, Comentarios ";
	$query .= " from ".$empresa."_000017 ";
	$query .= " where Terapeuta = '".$wter."' ";
	$query .= "   and Fecha = '".$wfecha."' ";
	$query .= "   and Hora_Inicial = '".substr($whin,0,2).substr($whin,3,2)."' ";
	$query .= "   and Cedula = '".$wced."' ";
	$query .= " order by Nombre ";
	$err = mysql_query($query,$conex) or die(mysql_errno().":".mysql_error());
	$num = mysql_num_rows($err);
	if($num == 0)
	{
		if($Wnum < $wmax)
		{
			$fecha = date("Y-m-d");
			$hora = (string)date("H:i:s");
			$query = "insert ".$empresa."_000017 (medico,fecha_data,hora_data, Terapeuta, Fecha, Hora_Inicial, Cedula, Nombre, Responsable, Tipo, Comentarios, Actividad, Seguridad) values ('";
			$query .=  $empresa."','";
			$query .=  $fecha."','";
			$query .=  $hora."','";
			$query .=  $wter."','";
			$query .=  $wfecha."','";
			$query .=  substr($whin,0,2).substr($whin,3,2)."','";
			$query .=  $wced."','";
			$query .=  $wnom."','";
			$query .=  substr($wres,0,strpos($wres,"-"))."','";
			$query .=  substr($wtip,0,strpos($wtip,"-"))."','";
			$query .=  $wobs."',";
			$query .=  "'off','C-".$empresa."')";
			$err1 = mysql_query($query,$conex) or die("ERROR GRABANDO TURNOS : ".mysql_errno().":".mysql_error());
			$e=$e+1;
			$werr[$e]="OK! TURNO GRABADO";
			return true;
		}
		else
		{
			$e=$e+1;
			$werr[$e]="EL TURNO NO FUE GRABADO - CUPO MAXIMO SUPERADO";
			return true;
		}
	}
	else
	{
		$query =  " update ".$empresa."_000017 set ";
		$query .=  "  Nombre = '".$wnom."',";
		$query .=  "  Responsable = '".substr($wres,0,strpos($wres,"-"))."',";
		$query .=  "  Tipo = '".substr($wtip,0,strpos($wtip,"-"))."',";
		$query .=  "  Comentarios = '".$wobs."'";
		$query .=  "  where Terapeuta='".$wter."' and Fecha='".$wfecha."' and Hora_Inicial='".substr($whin,0,2).substr($whin,3,2)."' and Cedula='".$wced."' ";
		$err1 = mysql_query($query,$conex) or die("ERROR ACTUALIZANDO TURNOS : ".mysql_errno().":".mysql_error());
		$e=$e+1;
		$werr[$e]="OK! TURNO ACTUALIZADO ";
		return true;
	}
}
		
@session_start();

if(!isset($_SESSION['user']))
	echo "error";
else
{
	$key = substr($user,2,strlen($user));
	echo "<form name='Turfis' action='Turfis.php' method=post>";	

	echo "<center><input type='HIDDEN' name= 'empresa' value='".$empresa."'>";
	if($ok == 99)
	{
		echo "<table border=0 align=center id=tipo5>";
		?>
		<script>
			function ira(){document.Turfis.wfecha.focus();}
		</script>
		<?php
		echo "<tr><td align=center colspan=7><IMG SRC='/matrix/images/medical/citas/logo_".$empresa.".png'></td></tr>";
		echo "<tr><td align=right colspan=7><font size=2>Ver. 2014-12-30 </font></td></tr>";
		echo "<tr><td align=center colspan=7 id=tipo14><b>TURNOS DE FISIOTERAPIA</td></tr>";
		if (!isset($wfecha))
			$wfecha=date("Y-m-d");
		if (!isset($wcedT))
			$wcedT="";
		if (!isset($wnomT))
			$wnomT="";
		if (!isset($wresT))
			$wresT="";
		if (isset($wini))
		{
			$wcedT="";
			$wnomT="";
			$wresT="";
		}
		$year = (integer)substr($wfecha,0,4);
		$month = (integer)substr($wfecha,5,2);
		$day = (integer)substr($wfecha,8,2);
		$nomdia=mktime(0,0,0,$month,$day,$year);
		$nomdia = strftime("%w",$nomdia);
		$wsw=0;
		switch ($nomdia)
		{
			case 0:
				$diasem = "DOMINGO";
				break;
			case 1:
				$diasem = "LUNES";
				break;
			case 2:
				$diasem = "MARTES";
				break;
			case 3:
				$diasem = "MIERCOLES";
				break;
			case 4:
				$diasem = "JUEVES";
				break;
			case 5:
				$diasem = "VIERNES";
				break;
			case 6:
				$diasem = "SABADO";
				break;
		}
		echo "<tr><td bgcolor='#cccccc' align=center><b>FECHA :</b></td>";
		echo "<td bgcolor='#cccccc' align=center>Dia de la Semana<br><b>".$diasem."</b></td>";
		echo "<td bgcolor='#cccccc' align=center valign=bottom>A&ntilde;o - Mes - Dia<br><input type='TEXT' name='wfecha' size=10 maxlength=10 id='wfecha' readonly='readonly' value=".$wfecha." class=tipo6></td><td bgcolor='#cccccc' align=center valign=center><IMG SRC='/matrix/images/medical/TCX/calendario.jpg' id='trigger1'></td>";
		?>
		<script type="text/javascript">//<![CDATA[
			Zapatec.Calendar.setup({weekNumbers:false,showsTime:true,timeFormat:'12',electric:false,inputField:'wfecha',button:'trigger1',ifFormat:'%Y-%m-%d',daFormat:'%Y/%m/%d'});	
		//]]></script>
		<?php
		echo "<td bgcolor='#cccccc'  align=center><b>BUSQUEDA : </b><A HREF='/MATRIX/citas/reportes/busfis.php?empresa=".$empresa."' target='_blank'><IMG SRC='/MATRIX/images/medical/Citas/find.gif'></A></td><td bgcolor='#cccccc'  align=center><b>CANCELACION : </b><A HREF='/MATRIX/citas/procesos/canfis.php?empresa=".$empresa."' target='_blank'><IMG SRC='/MATRIX/images/medical/Citas/cancelar.PNG'></A></td><td bgcolor='#cccccc' rowspan=2><input type='submit' value='IR'></td></tr>";
		echo "<tr><td align=center colspan=7 bgcolor='#cccccc'><b>Terapeuta : ";
		$query = "SELECT Codigo, Nombre  from  ".$empresa."_000015 where estado='on' order by Nombre";
		$err = mysql_query($query,$conex) or die(mysql_errno().":".mysql_error());
		$num = mysql_num_rows($err);
		echo "<select name='wter' id=tipo1 OnChange='enter()'>";
		if ($num>0)
		{
			echo "<option>SELECCIONAR</option>";
			for ($i=0;$i<$num;$i++)
			{
				$row = mysql_fetch_array($err);
				$wter=ver($wter);
				if($wter == $row[0])
					echo "<option selected>".$row[0]."-".$row[1]."</option>";
				else
					echo "<option>".$row[0]."-".$row[1]."</option>";
			}
		}
		echo "</select>";
		echo"</td></tr>";
		echo "<tr>";
		echo "<td bgcolor='#cccccc' colspan=2>INDENTIFICACION :<br><input type='TEXT' name='wcedT' size=12 maxlength=12 value='".$wcedT."' OnBlur='enter()' class=tipo3></td>";
		if(isset($wcedT) and $wcedT != "" and $wnomT == "")
		{
			$query = "SELECT  Cedula, Nombre, Responsable, Fecha  from  ".$empresa."_000017 where Cedula='".$wcedT."' order by Fecha DESC";
			$err = mysql_query($query,$conex) or die(mysql_errno().":".mysql_error());
			$num = mysql_num_rows($err);
			if ($num>0)
			{
				$row = mysql_fetch_array($err);
				$wnomT=$row[1];
				$wresT=$row[2];
			}
		}
		echo "<td bgcolor='#cccccc' colspan=2>NOMBRE :<br><input type='TEXT' name='wnomT' size=40 maxlength=40 value='".$wnomT."' class=tipo3></td>";
		echo "<td bgcolor='#cccccc' colspan=2>RESPONSABLE :<br>";
		$query = "SELECT Nit, Descripcion from ".$empresa."_000002 where Activo='A' order by Descripcion";
		$err = mysql_query($query,$conex);
		$num = mysql_num_rows($err);
		echo "<select name='wresT' onChange='enter()' id=tipo1>";
		if ($num>0)
		{
			echo "<option>SELECCIONE</option>";
			for ($i=0;$i<$num;$i++)
			{
				$row = mysql_fetch_array($err);
				$wresT=ver($wresT);
				if($wresT == $row[0])
					echo "<option selected>".$row[0]."-".$row[1]."</option>";
				else
					echo "<option>".$row[0]."-".$row[1]."</option>";
			}
		}
		echo "</select>";
		echo "</td>";
		echo "<td bgcolor='#cccccc' align=center>Iniciar<br><input type='checkbox' name='wini' onclick='enter()'></td>";
		echo"</tr>";
		echo "</table><br>";
		echo "<input type='HIDDEN' name= 'ok' value='".$ok."'>";
		$Grid=array();
		$Data=array();
		$Grid[0][0]["tex"]="";
		$Grid[0][0]["bac"]=0;
		$Grid[0][0]["for"]=1;
		$Grid[0][0]["alt"]="";
		$Grid[0][0]["url"]="";
		$fase="07:00-08:00";
		for ($i=1;$i<13;$i++)
		{
			$Grid[$i][0]["tex"]=$fase;
			$Grid[$i][0]["bac"]=5;
			$Grid[$i][0]["for"]=4;
			$Grid[$i][0]["alt"]="";
			$Grid[$i][0]["url"]="";
			$hor1=(integer)substr($fase,0,2) + 1;
			if($hor1 < 10)
				$hor1="0".$hor1;
			$min1="00";
			$hor2=(integer)substr($fase,6,2) + 1;
			if($hor2 < 10)
				$hor2="0".$hor2;
			$min2="00";
			$fase=$hor1.":".$min1."-".$hor2.":".$min2;
		}
		// Quicod Quides Quiest 
		if($month == 1)
		{
			$montha = 12;
			$yeara = $year - 1;
		}
		else
		{
			$montha = $month - 1;
			$yeara = $year;
		}
		$udiama=ultimoDia($montha,$yeara);
		$udiam=ultimoDia($month,$year);
		$dias=array();
		$dias[1]="DOM";
		$dias[2]="LUN";
		$dias[3]="MAR";
		$dias[4]="MIE";
		$dias[5]="JUE";
		$dias[6]="VIE";
		$dias[7]="SAB";
		for ($i=0;$i<7;$i++)
		{
			$dia=$day - $nomdia + $i;
			if($dia < 1)
			{
				$dia = $udiama + $dia;
				$dia=$dia."/".$montha."/".$yeara;
			}
			elseif($dia > $udiam)
				{
					$dia = $dia - $udiam;
					if($month == 12)
					{
						$monthn = 1;
						$yearn = $year + 1;
					}
					else
					{
						$monthn = $month + 1;
						$yearn = $year;
					}
					$dia=$dia."/".$monthn."/".$yearn;
				}
				else
					$dia=$dia."/".$month."/".$year;
			$Grid[0][$i+1]["tex"]=date_format_fis($dia);
			$Grid[0][$i+1]["bac"]=5;
			$Grid[0][$i+1]["for"]=4;
			$Grid[0][$i+1]["alt"]="";
			$Grid[0][$i+1]["url"]="";
		}
		for ($i=1;$i<=12;$i++)
		{
			for ($j=1;$j<=7;$j++)
			{
				$Grid[$i][$j]["tex"]="";
				$Grid[$i][$j]["bac"]=1;
				$Grid[$i][$j]["for"]=1;
				$Grid[$i][$j]["alt"]="";
				$Grid[$i][$j]["url"]="";
			}
		}
		for ($i=0;$i<=12;$i++)
		{
			for ($j=0;$j<=7;$j++)
			{
				$Data[$i][$j]["npa"]=0;
				$Data[$i][$j]["tpa"]=0;
				$Data[$i][$j]["msg"]="";
			}
		}
		$wfechas=array();
		
		$diacambio=0;
		$mt=(integer)substr($Grid[0][1]["tex"],5,2);
		
		for ($i=0;$i<7;$i++)
		{
			if($mt != (integer)substr($Grid[0][$i+1]["tex"],5,2))
			{
				$diacambio=$i+1;
				$i=8;
			}
		}
		$kfec=0;
		$udiat=ultimoDia((integer)substr($Grid[0][1]["tex"],5,2),(integer)substr($Grid[0][1]["tex"],0,4));
		$wfechas[$kfec][1]=date_format_fis("1/".(integer)substr($Grid[0][1]["tex"],5,2)."/".(integer)substr($Grid[0][1]["tex"],0,4));
		$wfechas[$kfec][2]=date_format_fis($udiat."/".(integer)substr($Grid[0][1]["tex"],5,2)."/".(integer)substr($Grid[0][1]["tex"],0,4));
		if($diacambio > 0)
		{
			$kfec++;
			$udiat=ultimoDia((integer)substr($Grid[0][$diacambio]["tex"],5,2),(integer)substr($Grid[0][$diacambio]["tex"],0,4));
			$wfechas[$kfec][1]=date_format_fis("1/".(integer)substr($Grid[0][$diacambio]["tex"],5,2)."/".(integer)substr($Grid[0][$diacambio]["tex"],0,4));
			$wfechas[$kfec][2]=date_format_fis($udiat."/".(integer)substr($Grid[0][$diacambio]["tex"],5,2)."/".(integer)substr($Grid[0][$diacambio]["tex"],0,4));
			$wfechas[$kfec-1][0]="1-".(string)($diacambio-1);
			$wfechas[$kfec][0]=$diacambio."-7";
		}
		else
			$wfechas[$kfec][0]="1-7";
		
			
		if(!isset($wter) OR $wter == "")
			$wter="SELECCIONAR";
		//                 0          1          2      3        4   
		$query = "SELECT Fecha, Hora_Inicial, Cedula, Nombre, Actividad from ".$empresa."_000017 ";
		$query .= " where Terapeuta = '".$wter."' ";
		$query .= "   and Fecha between '".$Grid[0][1]["tex"]."' and '".$Grid[0][7]["tex"]."' ";
		$query .= "   and Actividad IN (0,1,9) ";
		$query .= "   order by Fecha, Hora_Inicial";
		$err = mysql_query($query,$conex) or die(mysql_errno().":".mysql_error());
		$num = mysql_num_rows($err);
		if ($num>0)
		{
			for ($i=0;$i<$num;$i++)
			{
				$row = mysql_fetch_array($err);
				$year = (integer)substr($row[0],0,4);
				$month = (integer)substr($row[0],5,2);
				$day = (integer)substr($row[0],8,2);
				$col = mktime(0,0,0,$month,$day,$year);
				$col = strftime("%w",$col)+1;
				$fil = (integer)substr($row[1],0,2) - 6;
				if($row[4] == 9)
				{
					$Data[$fil][$col]["tpa"] = 99;
					$Data[$fil][$col]["npa"] = 0;
				}
				else
					$Data[$fil][$col]["npa"]++;
				//$Data[$fil][$col]["msg"] .= $row[3].chr(10).chr(13);
			}
		}
		if($kfec == 0)
		{
			$query = "SELECT Dia, Hora_Inicial, Personas, Adicionales, Tipo from ".$empresa."_000016 ";
			$query .= " where Terapeuta = '".$wter."' ";
			$query .= "   and Fecha_I = '".$wfechas[0][1]."' ";
			$query .= "   and Fecha_F = '".$wfechas[0][2]."' ";
			$query .= "   and Dia between ".substr($wfechas[0][0],0,strpos($wfechas[0][0],"-"))." and ".substr($wfechas[0][0],strpos($wfechas[0][0],"-")+1);
			$query .= "   and Estado = 'on' ";
			$query .= "   order by Dia, Hora_Inicial";
		}
		else
		{
			$query = "SELECT Dia, Hora_Inicial, Personas, Adicionales, Tipo from ".$empresa."_000016 ";
			$query .= " where Terapeuta = '".$wter."' ";
			$query .= "   and Fecha_I = '".$wfechas[0][1]."' ";
			$query .= "   and Fecha_F = '".$wfechas[0][2]."' ";
			$query .= "   and Dia between ".substr($wfechas[0][0],0,strpos($wfechas[0][0],"-"))." and ".substr($wfechas[0][0],strpos($wfechas[0][0],"-")+1);
			$query .= "   and Estado = 'on' ";
			$query .= "   union ";
			$query .= " SELECT Dia, Hora_Inicial, Personas, Adicionales, Tipo from ".$empresa."_000016 ";
			$query .= " where Terapeuta = '".$wter."' ";
			$query .= "   and Fecha_I = '".$wfechas[1][1]."' ";
			$query .= "   and Fecha_F = '".$wfechas[1][2]."' ";
			$query .= "   and Dia between ".substr($wfechas[1][0],0,strpos($wfechas[1][0],"-"))." and ".substr($wfechas[1][0],strpos($wfechas[1][0],"-")+1);
			$query .= "   and Estado = 'on' ";
			$query .= "   order by Dia, Hora_Inicial";
		}
		$err = mysql_query($query,$conex) or die(mysql_errno().":".mysql_error());
		$num = mysql_num_rows($err);
		if ($num>0)
		{
			for ($i=0;$i<$num;$i++)
			{
				$row = mysql_fetch_array($err);
				//$col = $row[0] + 1;
				$col = $row[0];
				$fil = (integer)substr($row[1],0,2) - 6;
				if($Data[$fil][$col]["tpa"] == 99)
					$Data[$fil][$col]["tpa"] = 0;	
				else
					$Data[$fil][$col]["tpa"] = $row[2] + $row[3];
				$Data[$fil][$col]["msg"] = $row[4];
			}
		}
		for ($i=1;$i<=12;$i++)
		{
			for ($j=1;$j<=7;$j++)
			{
				$Grid[$i][$j]["tex"]=(string)$Data[$i][$j]["npa"]."/".(string)$Data[$i][$j]["tpa"]." - ".(string)$Data[$i][$j]["msg"];
				if($Data[$i][$j]["npa"] == 0 and $Data[$i][$j]["tpa"] > 0)
				{
					$Grid[$i][$j]["bac"]=1;
					$Grid[$i][$j]["for"]=1;
				}
				elseif($Data[$i][$j]["npa"] > 0 and $Data[$i][$j]["npa"] < $Data[$i][$j]["tpa"])
					{
						$Grid[$i][$j]["bac"]=4;
						$Grid[$i][$j]["for"]=1;
					}
					elseif($Data[$i][$j]["npa"] > 0 and $Data[$i][$j]["npa"] == $Data[$i][$j]["tpa"])
					{
						$Grid[$i][$j]["bac"]=3;
						$Grid[$i][$j]["for"]=2;
					}
					elseif($Data[$i][$j]["tpa"] == 0)
						{
							$Grid[$i][$j]["bac"]=2;
							$Grid[$i][$j]["for"]=1;
						}
				$Grid[$i][$j]["alt"]=$Data[$i][$j]["msg"];
				$Grid[$i][$j]["url"]="Turfis.php?ok=9&wfecha=".$Grid[0][$j]["tex"]."&wter=".$wter."&whin=".$Grid[$i][0]["tex"]."&wmax=".$Data[$i][$j]["tpa"]."&empresa=citasfi&wtipo=".$Data[$i][$j]["msg"]."&wcedT=".$wcedT."&wnomT=".$wnomT."&wresT=".$wresT;
			}
		}
		if(isset($wter) and $wter != "SELECCIONAR")
		{
			echo "<br><center><table border=0 align=center id=tipoG00>";
			echo "<tr><td id=tipoG01></td>";
			for ($j=0;$j<7;$j++)
				echo "<td id=tipoG54>".$dias[$j+1]."</td>";
			echo "</tr>";
			for ($i=0;$i<=12;$i++)
			{
				echo "<tr>";
				for ($j=0;$j<=7;$j++)
				{
					if($Data[$i][$j]["msg"] == "A")
						$tipo="tipoG".$Grid[$i][$j]["bac"].$Grid[$i][$j]["for"];
					elseif($Data[$i][$j]["msg"] == "H")
							$tipo="tipoG".$Grid[$i][$j]["bac"].$Grid[$i][$j]["for"]."A";
						elseif($i > 0 and $j > 0)
								$tipo="tipoG".$Grid[$i][$j]["bac"].$Grid[$i][$j]["for"]."B";
							else
								$tipo="tipoG".$Grid[$i][$j]["bac"].$Grid[$i][$j]["for"];
					if(strpos($Grid[$i][$j]["tex"],"/") !== false)
					{
						$image1 = $Data[$i][$j]["npa"];
						$image2 = $Data[$i][$j]["tpa"];
						$image3 = $Data[$i][$j]["msg"];
						if($Grid[$i][$j]["bac"].$Grid[$i][$j]["for"] != 21)
						{ 
							echo "<td id=".$tipo." ondblclick='ejecutar(".chr(34)."/matrix/citas/procesos/InfoTurFis.php?wfecha=".$Grid[0][$j]["tex"]."&wter=".$wter."&whin=".$Grid[$i][0]["tex"]."&wmax=".$Data[$i][$j]["tpa"]."&empresa=citasfi".chr(34).",1)'><A HREF='".$Grid[$i][$j]["url"]."'>".$image1." de ".$image2." - ".$image3."</A></td>"; 
						}
						else
						{ 
							echo "<td id=".$tipo.">".$image1." de ".$image2." - ".$image3."</td>"; 
						}
					}
					else
						echo "<td id=".$tipo.">".$Grid[$i][$j]["tex"]."</td>"; 
				}
				echo "</tr>";
			}
			echo "</table></td>";
		}
	}
	else
	{
		
		echo "<table border=0 align=center id=tipo2>";
		echo "<tr><td align=center colspan=6><IMG SRC='/matrix/images/medical/citas/logo_".$empresa.".png'></td></tr>";
		echo "<tr><td align=right colspan=6><font size=2>Ver. 2014-12-30 </font></td></tr>";
		//******* INICIALIZACION DEL SISTEMA *********
		if(isset($ok) and $ok == 9)
			$ok=0;
		
		//******* GRABACION DE INFORMACION *********
		if(isset($ok) and $ok == 2)
		{
			$werr=array();
			$e=-1;
			if(valgen($ok,$conex,$wced,$wnom,$wres,$wtip,$werr,$e))
			{
				// 2020-11-20 se desactiva para reducir los bloqueos a las tabla citasfi_000017
				//$query = "lock table ".$empresa."_000017 LOW_PRIORITY WRITE ";
				//$err1 = mysql_query($query,$conex) or die("ERROR BLOQUEANDO ARCHIVO DE ARCHIVOS : ".mysql_errno().":".mysql_error());
				if(ING_TUR($key,$conex,$wced,$wnom,$wres,$wobs,$wter,$wtip,$wfecha,$whin,$werr,$e,$Wnum,$wmax))
					$ok=0;
				//$query = " UNLOCK TABLES";
				//$err1 = mysql_query($query,$conex) or die("ERROR DESBLOQUEANDO TABLAS : ".mysql_errno().":".mysql_error());	
				if($ok != 0)
					$ok = 1;
			}
			else
				$ok=1;
		}
		
		
		//******* INICIALIZACION DE CAMPOS *********
		if(isset($ok) and $ok == 0)
		{
			$wced="";
			$wnom="";
			$wobs="";
			$wres="";
			$wtip="";
			$query = "SELECT Nombre from ".$empresa."_000015 where Codigo='".$wter."' ";
			$err1 = mysql_query($query,$conex);
			$row1 = mysql_fetch_array($err1);
			$wnter=$row1[0];
			$ok=1;
		}
		
		if(isset($ok) and $ok == 1 and isset($Wnum) and isset($numero) and $numero > 0)
		{
			// 2020-11-20 se desactiva para reducir los bloqueos a las tabla citasfi_000017
			//$query = "lock table ".$empresa."_000017 LOW_PRIORITY WRITE ";
			//$err1 = mysql_query($query,$conex) or die("ERROR BLOQUEANDO ARCHIVO DE ARCHIVOS : ".mysql_errno().":".mysql_error());
			for ($i=0;$i<$numero;$i++)
			{
				if(isset($wact[$i]))
				{
					$wced=$Wdata[$i][0];
					$wnom=$Wdata[$i][1];
					$wres=$Wdata[$i][2];
					$wobs=$Wdata[$i][3];
					switch ($Wdata[$i][4])
					{
						case "A":
							$wtip="A-AMBULATORIO";
						break;
						case "H":
							$wtip="H-HOSPITALIZADO";
						break;
						default:
							$wtip="X-SELECCIONE";
					}
					$i=$Wnum;
				}
				elseif(isset($wdel[$i]))
					{
						$query = "Delete from ".$empresa."_000017 ";
						$query .= " where Terapeuta = '".$wter."' ";
						$query .= "   and Fecha = '".$wfecha."' ";
						$query .= "   and Hora_Inicial = '".substr($whin,0,2).substr($whin,3,2)."' ";
						$query .= "   and Cedula = '".$Wdata[$i][0]."' ";
						$err1 = mysql_query($query,$conex) or die("ERROR BORRANDO TURNOS : ".mysql_errno().":".mysql_error());	
						$i=$Wnum;
						$wced="";
						$wnom="";
						$wobs="";
						$wres="";
					}
					elseif(isset($wasis[$i]))
						{
							//echo "Activos : ".$Wnum." Maximos :".$wmax."<br>";
							$query = "Select Actividad from ".$empresa."_000017 ";
							$query .= " where Terapeuta = '".$wter."' ";
							$query .= "   and Fecha = '".$wfecha."' ";
							$query .= "   and Hora_Inicial = '".substr($whin,0,2).substr($whin,3,2)."' ";
							$query .= "   and Cedula = '".$Wdata[$i][0]."' ";
							$err1 = mysql_query($query,$conex) or die("ERROR ACTUALIZANDO ASISTENCIA TURNOS : ".mysql_errno().":".mysql_error());	
							$row = mysql_fetch_array($err1);
							//echo "Anterior : ".$row[0]." Actual :".$wasis[$i]."<br>";
							if(($row[0] > 1 and $Wnum < $wmax and $wasis[$i] < 2) or ($row[0] > 1 and $wasis[$i] > 1) or ($row[0] < 2 and $wasis[$i] > 1) or ($row[0] < 2 and $wasis[$i] < 2))
							{
								$query = "Update ".$empresa."_000017 ";
								$query .= " SET Actividad = ".$wasis[$i];
								$query .= " where Terapeuta = '".$wter."' ";
								$query .= "   and Fecha = '".$wfecha."' ";
								$query .= "   and Hora_Inicial = '".substr($whin,0,2).substr($whin,3,2)."' ";
								$query .= "   and Cedula = '".$Wdata[$i][0]."' ";
								$err1 = mysql_query($query,$conex) or die("ERROR ACTUALIZANDO ASISTENCIA TURNOS : ".mysql_errno().":".mysql_error());
							}	
						}
			}
			//$query = " UNLOCK TABLES";
			//$err1 = mysql_query($query,$conex) or die("ERROR DESBLOQUEANDO TABLAS : ".mysql_errno().":".mysql_error());	
		}
		//*******PROCESO DE INFORMACION *********
		echo "<tr><td align=center colspan=4 id=tipo14><b>TURNOS DE FISIOTERAPIA</td></tr>";
		$color="#dddddd";
		$color1="#000099";
		$color2="#006600";
		$color3="#cc0000";
		$color4="#CC99FF";
		$color5="#99CCFF";
		$color6="#FF9966";
		$color7="#cccccc";
		//********************************************************************************************************
		//*                                         DATOS DEL PACIENTE                                             *                                
		//********************************************************************************************************
		$query = "select count(*) from ".$empresa."_000017 ";
		$query .= " where Terapeuta = '".$wter."' ";
		$query .= "   and Fecha = '".$wfecha."' ";
		$query .= "   and Hora_Inicial = '".substr($whin,0,2).substr($whin,3,2)."' ";
		$err1 = mysql_query($query,$conex) or die("ERROR CONSULTANDO TURNOS : ".mysql_errno().":".mysql_error());
		$row = mysql_fetch_array($err1);
		$Wmax=$row[0];
		?>
		<script>
			function ira(){document.Turfis.wced.focus();}
		</script>
		<?php
		echo "<tr><td align=center bgcolor=#999999 colspan=4><b>DATOS DEL PACIENTE</b></td></tr>";
		
		//PRIMERA LINEA
		echo "<tr>";
		echo "<td bgcolor=".$color." align=center>Terapeuta :<br>".$wter." - ".$wnter."</td>";
		echo "<td bgcolor=".$color." align=center>Fecha :<br>".$wfecha."</td>";
		echo "<td bgcolor=".$color." align=center>Horario :<br>".$whin."</td>";
		echo "<td bgcolor=".$color." align=center>Pacientes Maximos :<br>".$wmax."</td>";
		echo "<input type='HIDDEN' name= 'wter' value='".$wter."'>";
		echo "<input type='HIDDEN' name= 'wnter' value='".$wnter."'>";
		echo "<input type='HIDDEN' name= 'wfecha' value='".$wfecha."'>";
		echo "<input type='HIDDEN' name= 'whin' value='".$whin."'>";
		echo "<input type='HIDDEN' name= 'wmax' value='".$wmax."'>";
		echo "<input type='HIDDEN' name= 'wtipo' value='".$wtipo."'>";
		echo "<input type='HIDDEN' name= 'wcedT' value='".$wcedT."'>";
		echo "<input type='HIDDEN' name= 'wnomT' value='".$wnomT."'>";
		echo "<input type='HIDDEN' name= 'wresT' value='".$wresT."'>";
		echo "</tr>";
		
		
		if($wcedT != "")
			$wced = $wcedT;
		if($wnomT != "")
			$wnom = $wnomT;
		if($wresT != "SELECCIONE")
			$wres = $wresT;
		
		//SEGUNDA LINEA
		echo "<tr>";
		echo "<td bgcolor=".$color." align=center>Identificacion :<br><input type='TEXT' name='wced' size=12 maxlength=12 value='".$wced."' class=tipo3></td>";
		echo "<td bgcolor=".$color." align=center>Nombre :<br><input type='TEXT' name='wnom' size=35 maxlength=40 value='".$wnom."' class=tipo3></td>";
		echo "<td bgcolor=".$color." align=center>Responsable : <br>";
		$query = "SELECT Nit, Descripcion from ".$empresa."_000002 where Activo='A' order by Descripcion";
		$err = mysql_query($query,$conex);
		$num = mysql_num_rows($err);
		echo "<select name='wres' id=tipo1>";
		if ($num>0)
		{
			echo "<option>SELECCIONE</option>";
			for ($i=0;$i<$num;$i++)
			{
				$row = mysql_fetch_array($err);
				$wres=ver($wres);
				if($wres == $row[0])
					echo "<option selected>".$row[0]."-".$row[1]."</option>";
				else
					echo "<option>".$row[0]."-".$row[1]."</option>";
			}
		}
		echo "</select>";
		echo "</td>";
		echo "<td bgcolor=".$color." valign=center align=center>Observaciones :<br><textarea name='wobs' cols=50 rows=5 class=tipo3>".$wobs."</textarea></td>";
		echo "</tr>";
		
		//TERCERA LINEA
		echo "<tr>";
		echo "<td bgcolor=".$color." colspan=4 align=center>Tipo de Paciente : <br>";
		$Tipos=array();
		$Tipos[0]="A-AMBULATORIO";
		$Tipos[1]="H-HOSPITALIZADO";
		echo "<select name='wtip' id=tipo1>";
		if ($num>0)
		{
			for ($i=0;$i<2;$i++)
			{
				if(substr($Tipos[$i],0,1) == $wtipo)
					echo "<option selected>".$Tipos[$i]."</option>";
				//else
				//	echo "<option>".$Tipos[$i]."</option>";
			}
		}
		echo "</select>";
		echo "</td>";
		echo "</tr>";
		
		//PARTE CENTRAL DE LA PANTALLA 
		$ok=1;
		echo "<td bgcolor=#cccccc colspan=2 align=center><input type='RADIO' name=ok value=1 checked onclick='enter()'><b>PROCESO</b></td>";
		echo "<td bgcolor=#cccccc colspan=2 align=center><input type='RADIO' name=ok value=2 onclick='enter()'><b>GRABAR</b></td></tr>";
		echo "<tr><td bgcolor=#999999 colspan=4 align=center><input type='submit' value='OK'></td></tr>";
		echo "<tr><td bgcolor=#ffffff colspan=4 align=center><A HREF='/MATRIX/citas/Procesos/Turfis.php?ok=99&root=1&empresa=".$empresa."&wfecha=".$wfecha."&wter=".$wter."&wcedT=".$wcedT."&wnomT=".$wnomT."&wresT=".$wresT."'><IMG SRC='/matrix/images/medical/movhos/pac.png' alt='Lista'><br>Lista</A></td></tr></table><br><br></center>";
		if(isset($werr) and isset($e) and $e > -1)
		{
			echo "<br><br><center><table border=0 aling=center id=tipo2>";
			for ($i=0;$i<=$e;$i++)
				if(substr($werr[$i],0,3) == "OK!")
					echo "<tr><td align=center bgcolor=".$color5."><IMG SRC='/matrix/images/medical/root/feliz.ico'>&nbsp&nbsp<font color=#000000 face='tahoma'></font></TD><TD bgcolor=".$color5."><font color=#000000 face='tahoma'><b>".$werr[$i]."</b></font></td></tr>";
				else
					echo "<tr><td align=center bgcolor=".$color4."><IMG SRC='/matrix/images/medical/root/Malo.ico'>&nbsp&nbsp<font color=#000000 face='tahoma'></font></TD><TD bgcolor=".$color4."><font color=#000000 face='tahoma'><b>".$werr[$i]."</b></font></td></tr>";
			echo "</table><br><br></center>";
		}

			
		//********************************************************************************************************
		//*                             DATOS ASOCIADOS A LOS PACIENTES                                          *                                                                 
		//********************************************************************************************************
		$Wnum=0;
		echo "<table border=0 align=center id=tipo2>";
		$query = "select Cedula, Nombre, Responsable, Comentarios, Descripcion, Actividad, Tipo ";
		$query .= " from ".$empresa."_000017,".$empresa."_000002 ";
		$query .= " where Terapeuta = '".$wter."' ";
		$query .= "   and Fecha = '".$wfecha."' ";
		$query .= "   and Hora_Inicial = '".substr($whin,0,2).substr($whin,3,2)."' ";
		$query .= "   and Responsable = Nit ";
		$query .= " order by Nombre ";
		$err = mysql_query($query,$conex) or die(mysql_errno().":".mysql_error());
		$num = mysql_num_rows($err);
		if ($num>0)
		{
			$Wdata=array();
			for ($i=0;$i<$num;$i++)
			{
				if($i % 2 == 0)
				{
					$tipo="tipo13";
				}
				else
				{
					$tipo="tipo12";
				}
				$row = mysql_fetch_array($err);
				if($row[5] < 2)
					$Wnum++;
				$Wdata[$i][0]=$row[0];
				$Wdata[$i][1]=$row[1];
				$Wdata[$i][2]=$row[2];
				$Wdata[$i][3]=$row[3];
				$Wdata[$i][4]=$row[6];
				echo "<input type='HIDDEN' name= 'Wdata[".$i."][0]' value='".$Wdata[$i][0]."'>";
				echo "<input type='HIDDEN' name= 'Wdata[".$i."][1]' value='".$Wdata[$i][1]."'>";
				echo "<input type='HIDDEN' name= 'Wdata[".$i."][2]' value='".$Wdata[$i][2]."'>";
				echo "<input type='HIDDEN' name= 'Wdata[".$i."][3]' value='".$Wdata[$i][3]."'>";
				echo "<input type='HIDDEN' name= 'Wdata[".$i."][4]' value='".$Wdata[$i][4]."'>";
			 	echo "<tr><td id=tipo11>Cedula</td><td id=tipo11>Nombre</td><td id=tipo11>Responsable</td><td id=tipo11>Tipo</td><td id=tipo11>Observaciones</td><td id=tipo11>Actualizar</td><td id=tipo11>Borrar</td><td id=tipo11>Actividad</td></tr>";
			 	echo "<tr><td id=".$tipo.">".$row[0]."</td><td id=".$tipo.">".$row[1]."</td><td id=".$tipo.">".$row[2]."-".$row[4]."</td><td id=".$tipo.">".$row[6]."</td><td id=".$tipo."><textarea name='wobs1[".$i."]' cols=80 readonly='readonly' rows=3 class=tipo3>".$row[3]."</textarea></td><td id=".$tipo."><input type='checkbox' name='wact[".$i."]' onclick='enter()'></td><td id=".$tipo."><input type='checkbox' name='wdel[".$i."]' onclick='enter()'></td>";
			 	echo "<td id=".$tipo.">";
			 	switch ($row[5])
				{
					case 0:
						echo "<input type='RADIO' name='wasis[".$i."]' value=0 checked onclick='enter()'>Pendiente";
						echo "<input type='RADIO' name='wasis[".$i."]' value=1 onclick='enter()'>Asitio";
						echo "<input type='RADIO' name='wasis[".$i."]' value=2 onclick='enter()'>Cancelo";
						echo "<input type='RADIO' name='wasis[".$i."]' value=3 onclick='enter()'>No Asistio";
					break;
					case 1:
						echo "<input type='RADIO' name='wasis[".$i."]' value=0 onclick='enter()'>Pendiente";
						echo "<input type='RADIO' name='wasis[".$i."]' value=1 checked onclick='enter()'>Asitio";
						echo "<input type='RADIO' name='wasis[".$i."]' value=2 onclick='enter()'>Cancelo";
						echo "<input type='RADIO' name='wasis[".$i."]' value=3 onclick='enter()'>No Asistio";
					break;
					case 2:
						echo "<input type='RADIO' name='wasis[".$i."]' value=0 onclick='enter()'>Pendiente";
						echo "<input type='RADIO' name='wasis[".$i."]' value=1 onclick='enter()'>Asitio";
						echo "<input type='RADIO' name='wasis[".$i."]' value=2 checked onclick='enter()'>Cancelo";
						echo "<input type='RADIO' name='wasis[".$i."]' value=3 onclick='enter()'>No Asistio";
					break;
					case 3:
						echo "<input type='RADIO' name='wasis[".$i."]' value=0 onclick='enter()'>Pendiente";
						echo "<input type='RADIO' name='wasis[".$i."]' value=1 onclick='enter()'>Asitio";
						echo "<input type='RADIO' name='wasis[".$i."]' value=2 onclick='enter()'>Cancelo";
						echo "<input type='RADIO' name='wasis[".$i."]' value=3 checked onclick='enter()'>No Asistio";
					break;
				}
			 	echo "</td></tr>";
			}
		}
		echo "<input type='HIDDEN' name= 'numero' value='".$num."'>";
		echo "<input type='HIDDEN' name= 'Wnum' value='".$Wnum."'>";
		echo "</table>";
		echo"</form>";
	}
}
?>
</body>
</html>
