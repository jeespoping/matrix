<html><head><title>MATRIX</title></head><body BGCOLOR=""><BODY TEXT="#000066"><center><table border=0 align=center><tr><td align=center bgcolor="#cccccc"><A NAME="Arriba"><font size=5>Informe de Actividades de las Terapias</font></a></tr></td><tr><td align=center bgcolor="#cccccc"><font size=2> <b>Estxfis.php Ver 2011-08-12 01</b></font></tr></td></table></center><?php
include_once("conex.php");function bi($d,$n,$k,$i){	$n--;	if($n > 0)	{		$li=0;		$ls=$n;		while ($ls - $li > 1)		{			$lm=(integer)(($li + $ls) / 2);			$val=strncmp(strtoupper($k),strtoupper($d[$lm][$i]),20);			if($val == 0)				return $lm;			elseif($val < 0)					$ls=$lm;				else					$li=$lm;		}		if(strtoupper($k) == strtoupper($d[$li][$i]))			return $li;		elseif(strtoupper($k) == strtoupper($d[$ls][$i]))					return $ls;				else					return -1;	}	else		return -1;} @session_start(); if(!isset($_SESSION['user']))	echo "error"; else { 	$key = substr($user,2,strlen($user));	
	
	echo "<form action='Estxfis.php' method=post>";	echo "<center><input type='HIDDEN' name= 'empresa' value='".$empresa."'>";	if(!isset($wano) or !isset($wmes) or $wmes < 1 or $wmes > 12)	{		echo  "<center><table border=0>";		echo "<tr><td align=center colspan=2><b>PROMOTORA MEDICA LAS AMERICAS S.A.<b></td></tr>";		echo "<tr><td colspan=2 align=center><b>INFORME DE ACTIVIDADES DE LAS TERAPIAS (UNIDAD DE FISIATRIA)</b></td></tr>";		echo  "<tr><td bgcolor=#cccccc align=center>A&ntilde;o Proceso</td>";		echo  "<td bgcolor=#cccccc align=center><input type='TEXT' name='wano' size=4 maxlength=4></td></tr>";		echo  "<tr><td bgcolor=#cccccc align=center>Mes de Proceso</td>";		echo  "<td bgcolor=#cccccc align=center><input type='TEXT' name='wmes' size=2 maxlength=2></td></tr>";		echo "<tr><td bgcolor=#cccccc  colspan=2 align=center><input type='submit' value='ENTER'></td></tr></table>";	}	else	{		$H=array();		//                     0      1       2        3            4                                          		$query  =  "select Terapeuta,Dia,Hora_inicial,tipo,(Personas+Adicionales) from citasfi_000016 "; 		$query .= " where MONTH(fecha_i) = ".$wmes;		$query .= "  and YEAR(fecha_f) = ".$wano;		$query .= "  order by 1,2,3,4,5 ";		$err = mysql_query($query,$conex);		$numH = mysql_num_rows($err);		for ($i=0;$i<$numH;$i++)		{			$row = mysql_fetch_array($err);			$H[$i][0] = $row[0].$row[1].$row[2].$row[3];			$H[$i][1] = $row[4];		}		//                     0                      1       2               3        4         5      6                    7		$query  =  "select Terapeuta,citasfi_000015.Nombre,Cedula,DAYOFWEEK(Fecha),Hora_inicial,Tipo,Actividad,citasfi_000015.Especialidad from citasfi_000017,citasfi_000015 "; 		$query .= "  where MONTH(fecha) = ".$wmes;		$query .= "	   and YEAR(fecha) = ".$wano;		$query .= "	   and terapeuta = citasfi_000015.codigo ";		$query .= "	   and Actividad between 1 and 3 ";   		$query .= "   order by 1,3,6 ";		$err = mysql_query($query,$conex);		$num = mysql_num_rows($err);		echo "<table border=0>";		echo "<tr><td colspan=45 align=center><b>PROMOTORA MEDICA LAS AMERICAS S.A.</b></td></tr>";		echo "<tr><td colspan=45 align=center><b>DIRECCION DE INFORMATICA</b></td></tr>";		echo "<tr><td colspan=45 align=center><b>INFORME DE ACTIVIDADES DE LAS TERAPIAS (UNIDAD DE FISIATRIA)</b></td></tr>";		echo "<tr><td colspan=45 align=center><b>A&Ntilde;O : ".$wano." MES : ".$wmes."</b></td></tr>";		echo "<tr>";		echo "<td bgcolor=#999999 rowspan=3><b>Codigo Terapeuta</b></td>";		echo "<td bgcolor=#999999 rowspan=3><b>Especialidad</b></td>";		echo "<td bgcolor=#999999 colspan=18 align=center><b>Terapias</b></td>";		echo "<td bgcolor=#999999 colspan=18 align=center><b>Rehabilitacion Cardiaca</b></td>";		echo "<td bgcolor=#999999 colspan=9 align=center><b>Totales Por Terapeuta</b></td></tr>";		echo "<tr>";		echo "<td bgcolor=#cccccc colspan=3 align=center><b>Sesiones</b></td>";		echo "<td bgcolor=#cccccc colspan=3 align=center><b>Pacientes</b></td>";		echo "<td bgcolor=#cccccc colspan=3 align=center><b>faltas</b></td>";		echo "<td bgcolor=#cccccc colspan=3 align=center><b>Cancelaciones</b></td>";		echo "<td bgcolor=#cccccc colspan=3 align=center><b>Capacidad</b></td>";		echo "<td bgcolor=#cccccc colspan=3 align=center><b>Ejecucion</b></td>";		echo "<td bgcolor=#cccccc colspan=3 align=center><b>Sesiones</b></td>";		echo "<td bgcolor=#cccccc colspan=3 align=center><b>Pacientes</b></td>";		echo "<td bgcolor=#cccccc colspan=3 align=center><b>faltas</b></td>";		echo "<td bgcolor=#cccccc colspan=3 align=center><b>Cancelaciones</b></td>";		echo "<td bgcolor=#cccccc colspan=3 align=center><b>Capacidad</b></td>";		echo "<td bgcolor=#cccccc colspan=3 align=center><b>Ejecucion</b></td>";		echo "<td bgcolor=#cccccc colspan=3 align=center><b>Sesiones</b></td>";		echo "<td bgcolor=#cccccc colspan=3 align=center><b>Capacidad</b></td>";		echo "<td bgcolor=#cccccc colspan=3 align=center><b>Ejecucion</b></td></tr>";		echo "<tr>";		echo "<td bgcolor=#dddddd><b>Hosp.</b></td>";		echo "<td bgcolor=#dddddd><b>Ambu.</b></td>";		echo "<td bgcolor=#dddddd><b>Total</b></td>";		echo "<td bgcolor=#dddddd><b>Hosp.</b></td>";		echo "<td bgcolor=#dddddd><b>Ambu.</b></td>";		echo "<td bgcolor=#dddddd><b>Total</b></td>";		echo "<td bgcolor=#dddddd><b>Hosp.</b></td>";		echo "<td bgcolor=#dddddd><b>Ambu.</b></td>";		echo "<td bgcolor=#dddddd><b>Total</b></td>";		echo "<td bgcolor=#dddddd><b>Hosp.</b></td>";		echo "<td bgcolor=#dddddd><b>Ambu.</b></td>";		echo "<td bgcolor=#dddddd><b>Total</b></td>";		echo "<td bgcolor=#dddddd><b>Hosp.</b></td>";		echo "<td bgcolor=#dddddd><b>Ambu.</b></td>";		echo "<td bgcolor=#dddddd><b>Total</b></td>";		echo "<td bgcolor=#dddddd><b>Hosp.</b></td>";		echo "<td bgcolor=#dddddd><b>Ambu.</b></td>";		echo "<td bgcolor=#dddddd><b>Total</b></td>";		echo "<td bgcolor=#dddddd><b>Hosp.</b></td>";		echo "<td bgcolor=#dddddd><b>Ambu.</b></td>";		echo "<td bgcolor=#dddddd><b>Total</b></td>";		echo "<td bgcolor=#dddddd><b>Hosp.</b></td>";		echo "<td bgcolor=#dddddd><b>Ambu.</b></td>";		echo "<td bgcolor=#dddddd><b>Total</b></td>";		echo "<td bgcolor=#dddddd><b>Hosp.</b></td>";		echo "<td bgcolor=#dddddd><b>Ambu.</b></td>";		echo "<td bgcolor=#dddddd><b>Total</b></td>";		echo "<td bgcolor=#dddddd><b>Hosp.</b></td>";		echo "<td bgcolor=#dddddd><b>Ambu.</b></td>";		echo "<td bgcolor=#dddddd><b>Total</b></td>";		echo "<td bgcolor=#dddddd><b>Hosp.</b></td>";		echo "<td bgcolor=#dddddd><b>Ambu.</b></td>";		echo "<td bgcolor=#dddddd><b>Total</b></td>";		echo "<td bgcolor=#dddddd><b>Hosp.</b></td>";		echo "<td bgcolor=#dddddd><b>Ambu.</b></td>";		echo "<td bgcolor=#dddddd><b>Total</b></td>"; 		echo "<td bgcolor=#dddddd><b>Hosp.</b></td>";		echo "<td bgcolor=#dddddd><b>Ambu.</b></td>";		echo "<td bgcolor=#dddddd><b>Total</b></td>";		echo "<td bgcolor=#dddddd><b>Hosp.</b></td>";		echo "<td bgcolor=#dddddd><b>Ambu.</b></td>";		echo "<td bgcolor=#dddddd><b>Total</b></td>";		echo "<td bgcolor=#dddddd><b>Hosp.</b></td>";		echo "<td bgcolor=#dddddd><b>Ambu.</b></td>";		echo "<td bgcolor=#dddddd><b>Total</b></td></tr>"; 		$wfis="";		$data=array();		$total=array();		$kc=0;		$wced="";		$WTA="";		$wesp="";		$data[0]=$wfis;		$data[46]=$wesp;		for ($j=1;$j<=45;$j++){$data[$j]=0;$total[$j]=0;}		for ($i=0;$i<$num;$i++)		{			$row = mysql_fetch_array($err);			if($row[0]."-".$row[1] != $wfis)			{				if($i > 0)				{					//                                  0                      1                                  2     3                         4 					$query  =  "select ".$empresa."_000016.Terapeuta,".$empresa."_000016.Tipo,".$empresa."_000016.Tipo,'1',sum(".$empresa."_000016.Personas+".$empresa."_000016.Adicionales) from ".$empresa."_000016 "; 					$query .= " where MONTH(".$empresa."_000016.fecha_i) = ".$wmes;					$query .= "   and YEAR(".$empresa."_000016.fecha_i) = ".$wano;  					$query .= "   and ".$empresa."_000016.Personas <= 4 ";					$query .= "   and ".$empresa."_000016.terapeuta = '".substr($wfis,0,strpos($wfis,"-"))."'";					$query .= " group by 1,2,3 ";					$query .= " union all ";					$query .= " select ".$empresa."_000016.Terapeuta,".$empresa."_000016.Tipo,".$empresa."_000016.Tipo,'2',sum(".$empresa."_000016.Personas+".$empresa."_000016.Adicionales) from ".$empresa."_000016 ";					$query .= " where MONTH(".$empresa."_000016.fecha_i) = ".$wmes;					$query .= "   and YEAR(".$empresa."_000016.fecha_i) = ".$wano;  					$query .= "   and ".$empresa."_000016.Personas > 4 ";					$query .= "   and ".$empresa."_000016.terapeuta = '".substr($wfis,0,strpos($wfis,"-"))."'";					$query .= " group by 1,2,3 ";					$err1 = mysql_query($query,$conex);					$num1 = mysql_num_rows($err1);					for ($j=0;$j<$num1;$j++)					{						$row1 = mysql_fetch_array($err1);						if($row1[3] == "1")						{							if($row1[2] == "H")								$data[13] += $row1[4] * 3;							else								$data[14] += $row1[4] * 3;							$data[15] += $row1[4] * 3;							if($data[13] > 0)								$data[16] = $data[1] / $data[13] * 100;							else								$data[16] = 0;							if($data[14] > 0)								$data[17] = $data[2] / $data[14] * 100;							else								$data[17] = 0;							if($data[15] > 0)								$data[18] = $data[3] / $data[15] * 100;							else								$data[18] = 0;						}						else						{							if($row1[2] == "H")								$data[31] += $row1[4] * 3;							else								$data[32] += $row1[4] * 3;							$data[33] += $row1[4] * 3;							if($data[31] > 0)								$data[34] = $data[19] / $data[31] * 100;							else								$data[34] = 0;							if($data[32] > 0)								$data[35] = $data[20] / $data[32] * 100;							else								$data[35] = 0;							if($data[33] > 0)								$data[36] = $data[21] / $data[33] * 100;							else								$data[36] = 0;						}					}					$data[37] = $data[1] + $data[19];					$data[38] = $data[2] + $data[20];					$data[39] = $data[3] + $data[21];					$data[40] = $data[13] + $data[31];					$data[41] = $data[14] + $data[32];					$data[42] = $data[15] + $data[33];					if($data[40] > 0)						$data[43] = $data[37] / $data[40] * 100;					else						$data[43] = 0;					if($data[41] > 0)						$data[44] = $data[38] / $data[41] * 100;					else						$data[44] = 0;					if($data[42] > 0)						$data[45] = $data[39] / $data[42] * 100;					else						$data[45] = 0;					$kc++;					if($kc % 2 == 0)						$wcolor="#99CCFF";					else						$wcolor="#FFFFFF";					echo "<tr>";					echo "<td bgcolor=".$wcolor.">".substr($data[0],strpos($data[0],"-")+1)."</td><td bgcolor=".$wcolor.">".substr($data[46],strpos($data[46],"-")+1)."</td>";					for ($j=1;$j<=45;$j++)						if(($j>15 and $j<19) or ($j>33 and $j<37) or ($j>42 and $j<46))							echo "<td bgcolor=".$wcolor." align=right>".number_format((double)$data[$j],0,'.',',')."%</td>";						else							echo "<td bgcolor=".$wcolor." align=right>".number_format((double)$data[$j],0,'.',',')."</td>";					echo "</tr>"; 				}				$wfis=$row[0]."-".$row[1];				$wesp=$row[7];				$data[0]=$wfis;				$data[46]=$wesp;				for ($j=1;$j<=36;$j++) $total[$j] += $data[$j];				for ($j=1;$j<=45;$j++) $data[$j]=0;			}			$pos=bi($H,$numH,$row[0].$row[3].$row[4].$row[5],0);			if($pos == -1)			{				$WTIPO = 1;			}			elseif($H[$pos][1] <= 4)					$WTIPO = 1;				else					$WTIPO = 2;			if($WTIPO == 1)			{				switch ($row[6])				{					case 1:						if($row[5] == "H")							$data[1]++;						else							$data[2]++;						$data[3]++;						if(($wced != $row[2]) or ($wced == $row[2] and $WTA != $WTIPO))						{							if($row[5] == "H")								$data[4]++;							else								$data[5]++;							$data[6]++;							$wced = $row[2];							$WTA = $WTIPO;						}					break;					case 3:						if($row[5] == "H")							$data[7]++;						else							$data[8]++;						$data[9]++;					break;					case 2:						if($row[5] == "H")							$data[10]++;						else							$data[11]++;						$data[12]++;					break;				}			}			else			{				switch ($row[6])				{					case 1:						if($row[5] == "H")							$data[19]++;						else							$data[20]++;						$data[21]++;						if(($wced != $row[2]) or ($wced == $row[2] and $WTA != $WTIPO))						{							if($row[5] == "H")								$data[22]++;							else								$data[23]++;							$data[24]++;							$wced = $row[2];							$WTA = $WTIPO;						}					break;					case 3:						if($row[5] == "H")							$data[25]++;						else							$data[26]++;						$data[27]++;					break;					case 2:						if($row[5] == "H")							$data[28]++;						else							$data[29]++;						$data[30]++;					break;				}			}		}		$query  =  "select ".$empresa."_000016.Terapeuta,".$empresa."_000016.Tipo,".$empresa."_000016.Tipo,'1',sum(".$empresa."_000016.Personas+".$empresa."_000016.Adicionales) from ".$empresa."_000016 "; 		$query .= " where MONTH(".$empresa."_000016.fecha_i) = ".$wmes;		$query .= "   and YEAR(".$empresa."_000016.fecha_i) = ".$wano;   		$query .= "   and ".$empresa."_000016.Personas <= 4 ";		$query .= "   and ".$empresa."_000016.terapeuta = '".substr($wfis,0,strpos($wfis,"-"))."'";		$query .= " group by 1,2,3 ";		$query .= " union all ";		$query .= " select ".$empresa."_000016.Terapeuta,".$empresa."_000016.Tipo,".$empresa."_000016.Tipo,'2',sum(".$empresa."_000016.Personas+".$empresa."_000016.Adicionales) from ".$empresa."_000016 ";		$query .= " where MONTH(".$empresa."_000016.fecha_i) = ".$wmes;		$query .= "   and YEAR(".$empresa."_000016.fecha_i) = ".$wano;    		$query .= "   and ".$empresa."_000016.Personas > 4 ";		$query .= "   and ".$empresa."_000016.terapeuta = '".substr($wfis,0,strpos($wfis,"-"))."'";		$query .= " group by 1,2,3 ";		$err1 = mysql_query($query,$conex);		$num1 = mysql_num_rows($err1);		for ($j=0;$j<$num1;$j++)		{			$row1 = mysql_fetch_array($err1);			if($row1[3] == "1")			{				if($row1[2] == "H")					$data[13] += $row1[4] * 3;				else					$data[14] += $row1[4] * 3;				$data[15] += $row1[4] * 3;				if($data[13] > 0)					$data[16] = $data[1] / $data[13] * 100;				else					$data[16] = 0;				if($data[14] > 0)					$data[17] = $data[2] / $data[14] * 100;				else					$data[17] = 0;				if($data[15] > 0)					$data[18] = $data[3] / $data[15] * 100;				else					$data[18] = 0;			}			else			{				if($row1[2] == "H")					$data[31] += $row1[4] * 3;				else					$data[32] += $row1[4] * 3;				$data[33] += $row1[4] * 3;				if($data[31] > 0)					$data[34] = $data[19] / $data[31] * 100;				else					$data[34] = 0;				if($data[32] > 0)					$data[35] = $data[20] / $data[32] * 100;				else					$data[35] = 0;				if($data[33] > 0)					$data[36] = $data[21] / $data[33] * 100;				else					$data[36] = 0;			}		}		$data[37] = $data[1] + $data[19];		$data[38] = $data[2] + $data[20];		$data[39] = $data[3] + $data[21];		$data[40] = $data[13] + $data[31];		$data[41] = $data[14] + $data[32];		$data[42] = $data[15] + $data[33];		if($data[40] > 0)			$data[43] = $data[37] / $data[40] * 100;		else			$data[43] = 0;		if($data[41] > 0)			$data[44] = $data[38] / $data[41] * 100;		else			$data[44] = 0;		if($data[42] > 0)			$data[45] = $data[39] / $data[42] * 100;		else			$data[45] = 0;		for ($j=1;$j<=36;$j++) $total[$j] += $data[$j];		if($total[13] > 0)			$total[16] = $total[1] / $total[13] * 100;		else			$total[16] = 0;		if($total[14] > 0)			$total[17] = $total[2] / $total[14] * 100;		else			$total[17] = 0;		if($total[15] > 0)			$total[18] = $total[3] / $total[15] * 100;		else			$total[18] = 0;		if($total[31] > 0)			$total[34] = $total[19] / $total[31] * 100;		else			$total[34] = 0;		if($total[32] > 0)			$total[35] = $total[20] / $total[32] * 100;		else			$total[35] = 0;		if($total[33] > 0)			$total[36] = $total[21] / $total[33] * 100;		else			$total[36] = 0;		$total[37] = $total[1] + $total[19];		$total[38] = $total[2] + $total[20];		$total[39] = $total[3] + $total[21];		$total[40] = $total[13] + $total[31];		$total[41] = $total[14] + $total[32];		$total[42] = $total[15] + $total[33];		if($total[40] > 0)			$total[43] = $total[37] / $total[40] * 100;		else			$total[43] = 0;		if($total[41] > 0)			$total[44] = $total[38] / $total[41] * 100;		else			$total[44] = 0;		if($total[42] > 0)			$total[45] = $total[39] / $total[42] * 100;		else			$total[45] = 0;		$kc++;		if($kc % 2 == 0)			$wcolor="#99CCFF";		else			$wcolor="#FFFFFF";		echo "<tr>";		echo "<td bgcolor=".$wcolor.">".substr($data[0],strpos($data[0],"-")+1)."</td><td bgcolor=".$wcolor.">".substr($data[46],strpos($data[46],"-")+1)."</td>";		for ($j=1;$j<=45;$j++)			if(($j>15 and $j<19) or ($j>33 and $j<37) or ($j>42 and $j<46))				echo "<td bgcolor=".$wcolor." align=right>".number_format((double)$data[$j],0,'.',',')."%</td>";			else				echo "<td bgcolor=".$wcolor." align=right>".number_format((double)$data[$j],0,'.',',')."</td>";		echo "</tr>";		echo "<tr>";		$wcolor="#999999";		echo "<td bgcolor=".$wcolor." colspan=2>TOTAL GENERAL</td>";		for ($j=1;$j<=45;$j++)			if(($j>15 and $j<19) or ($j>33 and $j<37) or ($j>42 and $j<46))				echo "<td bgcolor=".$wcolor." align=right>".number_format((double)$total[$j],0,'.',',')."%</td>";			else				echo "<td bgcolor=".$wcolor." align=right>".number_format((double)$total[$j],0,'.',',')."</td>";		echo "</tr>";		echo "</table>"; 	}}?></body></html>