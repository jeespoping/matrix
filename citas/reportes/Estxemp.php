<html><head><title>MATRIX</title></head><body BGCOLOR=""><BODY TEXT="#000066"><center><table border=0 align=center><tr><td align=center bgcolor="#cccccc"><A NAME="Arriba"><font size=5>Informe de Actividades de las Terapias x Empresa</font></a></tr></td><tr><td align=center bgcolor="#cccccc"><font size=2> <b>Estxemp.php Ver 2011-08-12 01</b></font></tr></td></table></center><?php
include_once("conex.php");function bi($d,$n,$k,$i){	$n--;	if($n > 0)	{		$li=0;		$ls=$n;		while ($ls - $li > 1)		{			$lm=(integer)(($li + $ls) / 2);			$val=strncmp(strtoupper($k),strtoupper($d[$lm][$i]),20);			if($val == 0)				return $lm;			elseif($val < 0)					$ls=$lm;				else					$li=$lm;		}		if(strtoupper($k) == strtoupper($d[$li][$i]))			return $li;		elseif(strtoupper($k) == strtoupper($d[$ls][$i]))					return $ls;				else					return -1;	}	else		return -1;} @session_start(); if(!isset($_SESSION['user']))	echo "error"; else { 	$key = substr($user,2,strlen($user));	
	
	echo "<form action='Estxemp.php' method=post>";	echo "<center><input type='HIDDEN' name= 'empresa' value='".$empresa."'>";	if(!isset($wano) or !isset($wmes) or $wmes < 1 or $wmes > 12)	{		echo  "<center><table border=0>";		echo "<tr><td align=center colspan=2><b>PROMOTORA MEDICA LAS AMERICAS S.A.<b></td></tr>";		echo "<tr><td colspan=2 align=center><b>INFORME DE ACTIVIDADES DE LAS TERAPIAS X EMPRESA (UNIDAD DE FISIATRIA)</b></td></tr>";		echo  "<tr><td bgcolor=#cccccc align=center>A&ntilde;o Proceso</td>";		echo  "<td bgcolor=#cccccc align=center><input type='TEXT' name='wano' size=4 maxlength=4></td></tr>";		echo  "<tr><td bgcolor=#cccccc align=center>Mes de Proceso</td>";		echo  "<td bgcolor=#cccccc align=center><input type='TEXT' name='wmes' size=2 maxlength=2></td></tr>";		echo "<tr><td bgcolor=#cccccc  colspan=2 align=center><input type='submit' value='ENTER'></td></tr></table>";	}	else	{		$H=array();		//                     0      1       2        3            4                                          		$query  =  "select Terapeuta,Dia,Hora_inicial,tipo,(Personas+Adicionales) from citasfi_000016 "; 		$query .= " where MONTH(fecha_i) = ".$wmes;		$query .= "  and YEAR(fecha_f) = ".$wano;		$query .= "  order by 1,2,3,4,5 ";		$err = mysql_query($query,$conex);		$numH = mysql_num_rows($err);		for ($i=0;$i<$numH;$i++)		{			$row = mysql_fetch_array($err);			$H[$i][0] = $row[0].$row[1].$row[2].$row[3];			$H[$i][1] = $row[4];		}		//                     0                      1             2               3        4         5      6           7		$query  =  "select Responsable,citasfi_000002.Descripcion,Cedula,DAYOFWEEK(Fecha),Hora_inicial,Tipo,Actividad,Terapeuta from citasfi_000017,citasfi_000002 "; 		$query .= "  where MONTH(fecha) = ".$wmes;		$query .= "	   and YEAR(fecha) = ".$wano;		$query .= "	   and Responsable = citasfi_000002.Nit ";		$query .= "	   and Actividad between 1 and 3 ";   		$query .= "   order by 1,3,6 ";		$err = mysql_query($query,$conex);		$num = mysql_num_rows($err);		echo "<table border=0>";		echo "<tr><td colspan=28 align=center><b>PROMOTORA MEDICA LAS AMERICAS S.A.</b></td></tr>";		echo "<tr><td colspan=28 align=center><b>DIRECCION DE INFORMATICA</b></td></tr>";		echo "<tr><td colspan=28 align=center><b>INFORME DE ACTIVIDADES DE LAS TERAPIAS X EMPRESA (UNIDAD DE FISIATRIA)</b></td></tr>";		echo "<tr><td colspan=28 align=center><b>A&Ntilde;O : ".$wano." MES : ".$wmes."</b></td></tr>";		echo "<tr>";		echo "<td bgcolor=#999999 rowspan=3><b>Empresa</b></td>";		echo "<td bgcolor=#999999 colspan=12 align=center><b>Terapias</b></td>";		echo "<td bgcolor=#999999 colspan=12 align=center><b>Rehabilitacion Cardiaca</b></td>";		echo "<td bgcolor=#999999 colspan=3 align=center><b>Totales Por Empresa</b></td></tr>";		echo "<tr>";		echo "<td bgcolor=#cccccc colspan=3 align=center><b>Sesiones</b></td>";		echo "<td bgcolor=#cccccc colspan=3 align=center><b>Pacientes</b></td>";		echo "<td bgcolor=#cccccc colspan=3 align=center><b>faltas</b></td>";		echo "<td bgcolor=#cccccc colspan=3 align=center><b>Cancelaciones</b></td>";		echo "<td bgcolor=#cccccc colspan=3 align=center><b>Sesiones</b></td>";		echo "<td bgcolor=#cccccc colspan=3 align=center><b>Pacientes</b></td>";		echo "<td bgcolor=#cccccc colspan=3 align=center><b>faltas</b></td>";		echo "<td bgcolor=#cccccc colspan=3 align=center><b>Cancelaciones</b></td>";		echo "<td bgcolor=#cccccc colspan=3 align=center><b>Sesiones</b></td></tr>";		echo "<tr>";		echo "<td bgcolor=#dddddd><b>Hosp.</b></td>";		echo "<td bgcolor=#dddddd><b>Ambu.</b></td>";		echo "<td bgcolor=#dddddd><b>Total</b></td>";		echo "<td bgcolor=#dddddd><b>Hosp.</b></td>";		echo "<td bgcolor=#dddddd><b>Ambu.</b></td>";		echo "<td bgcolor=#dddddd><b>Total</b></td>";		echo "<td bgcolor=#dddddd><b>Hosp.</b></td>";		echo "<td bgcolor=#dddddd><b>Ambu.</b></td>";		echo "<td bgcolor=#dddddd><b>Total</b></td>";		echo "<td bgcolor=#dddddd><b>Hosp.</b></td>";		echo "<td bgcolor=#dddddd><b>Ambu.</b></td>";		echo "<td bgcolor=#dddddd><b>Total</b></td>";		echo "<td bgcolor=#dddddd><b>Hosp.</b></td>";		echo "<td bgcolor=#dddddd><b>Ambu.</b></td>";		echo "<td bgcolor=#dddddd><b>Total</b></td>";		echo "<td bgcolor=#dddddd><b>Hosp.</b></td>";		echo "<td bgcolor=#dddddd><b>Ambu.</b></td>";		echo "<td bgcolor=#dddddd><b>Total</b></td>";		echo "<td bgcolor=#dddddd><b>Hosp.</b></td>";		echo "<td bgcolor=#dddddd><b>Ambu.</b></td>";		echo "<td bgcolor=#dddddd><b>Total</b></td>";		echo "<td bgcolor=#dddddd><b>Hosp.</b></td>";		echo "<td bgcolor=#dddddd><b>Ambu.</b></td>";		echo "<td bgcolor=#dddddd><b>Total</b></td>";		echo "<td bgcolor=#dddddd><b>Hosp.</b></td>";		echo "<td bgcolor=#dddddd><b>Ambu.</b></td>";		echo "<td bgcolor=#dddddd><b>Total</b></td></tr>"; 		$wfis="";		$data=array();		$total=array();		$kc=0;		$wced="";		$WTA="";		$data[0]=$wfis;		for ($j=1;$j<=27;$j++){$data[$j]=0;$total[$j]=0;}		for ($i=0;$i<$num;$i++)		{			$row = mysql_fetch_array($err);			if($row[0]."-".$row[1] != $wfis)			{				if($i > 0)				{					$data[25] = $data[1] + $data[13];					$data[26] = $data[2] + $data[14];					$data[27] = $data[3] + $data[15];					$kc++;					if($kc % 2 == 0)						$wcolor="#99CCFF";					else						$wcolor="#FFFFFF";					echo "<tr>";					echo "<td bgcolor=".$wcolor.">".substr($data[0],strpos($data[0],"-")+1)."</td>";					for ($j=1;$j<=27;$j++)						echo "<td bgcolor=".$wcolor." align=right>".number_format((double)$data[$j],0,'.',',')."</td>";					echo "</tr>"; 				}				$wfis=$row[0]."-".$row[1];				$data[0]=$wfis;				for ($j=1;$j<=27;$j++) $total[$j] += $data[$j];				for ($j=1;$j<=27;$j++) $data[$j]=0;			}			$pos=bi($H,$numH,$row[7].$row[3].$row[4].$row[5],0);			if($pos == -1)			{				$WTIPO = 1;			}			elseif($H[$pos][1] <= 4)					$WTIPO = 1;				else					$WTIPO = 2;			if($WTIPO == 1)			{				switch ($row[6])				{					case 1:						if($row[5] == "H")							$data[1]++;						else							$data[2]++;						$data[3]++;						if(($wced != $row[2]) or ($wced == $row[2] and $WTA != $WTIPO))						{							if($row[5] == "H")								$data[4]++;							else								$data[5]++;							$data[6]++;							$wced = $row[2];							$WTA = $WTIPO;						}					break;					case 3:						if($row[5] == "H")							$data[7]++;						else							$data[8]++;						$data[9]++;					break;					case 2:						if($row[5] == "H")							$data[10]++;						else							$data[11]++;						$data[12]++;					break;				}			}			else			{				switch ($row[6])				{					case 1:						if($row[5] == "H")							$data[13]++;						else							$data[14]++;						$data[15]++;						if(($wced != $row[2]) or ($wced == $row[2] and $WTA != $WTIPO))						{							if($row[5] == "H")								$data[16]++;							else								$data[17]++;							$data[18]++;							$wced = $row[2];							$WTA = $WTIPO;						}					break;					case 3:						if($row[5] == "H")							$data[19]++;						else							$data[20]++;						$data[21]++;					break;					case 2:						if($row[5] == "H")							$data[22]++;						else							$data[23]++;						$data[24]++;					break;				}			}		}		$data[25] = $data[1] + $data[13];		$data[26] = $data[2] + $data[14];		$data[27] = $data[3] + $data[15];		$kc++;		if($kc % 2 == 0)			$wcolor="#99CCFF";		else			$wcolor="#FFFFFF";		echo "<tr>";		echo "<td bgcolor=".$wcolor.">".substr($data[0],strpos($data[0],"-")+1)."</td>";		for ($j=1;$j<=27;$j++)			echo "<td bgcolor=".$wcolor." align=right>".number_format((double)$data[$j],0,'.',',')."</td>";		echo "</tr>"; 		for ($j=1;$j<=27;$j++) $total[$j] += $data[$j];		$total[25] = $total[1] + $total[13];		$total[26] = $total[2] + $total[14];		$total[27] = $total[3] + $total[15];		echo "<tr>";		$wcolor="#999999";		echo "<td bgcolor=".$wcolor.">TOTAL GENERAL</td>";		for ($j=1;$j<=27;$j++)			echo "<td bgcolor=".$wcolor." align=right>".number_format((double)$total[$j],0,'.',',')."</td>";		echo "</tr>";		echo "</table>"; 	}}?></body></html>