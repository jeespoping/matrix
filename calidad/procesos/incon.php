<html><head><title>MATRIX</title></head><body BGCOLOR=""><BODY TEXT="#000066"><center><table border=0 align=center><tr><td align=center bgcolor="#cccccc"><A NAME="Arriba"><font size=5>INFORME DE INCONSISTENCIAS EN LA FACTURACIÓN</font></a></tr></td><tr><td align=center bgcolor="#cccccc"><font size=2> <b>incon.php</b></font></tr></td></table></center><?php
include_once("conex.php");session_start();if(!isset($_SESSION['user']))echo "error";else{	$key = substr($user,2,strlen($user));	
	
	echo "<form action='' method=post>";	if(!isset($fecha1))	{		if (!isset($fecha1))		$fecha1="";		if (!isset($fecha2))		$fecha2="";		echo  "<center><table border=0>";		echo "<tr><td align=center colspan=2><b>PROMOTORA MEDICA LAS AMERICAS S.A.<b></td></tr>";		//echo "<tr><td colspan=2 align=center><b>INFORME INCONSISTENCIAS EN LA FACTURACIÓN</b></td></tr>";		echo  "<tr><td bgcolor=#cccccc align=center>Fecha inicial</td>";		echo  "<td bgcolor=#cccccc align=center><input type='TEXT' name='fecha1' size=10 maxlength=10 value='".$fecha1."'></td></tr>";		echo  "<tr><td bgcolor=#cccccc align=center>Fecha final</td>";		echo  "<td bgcolor=#cccccc align=center><input type='TEXT' name='fecha2' size=10 maxlength=10 value='".$fecha2."'></td></tr>";		echo "<tr><td bgcolor=#cccccc align=center>Por Responsable<input type='radio' name='tipRep' value='Responsable_inc'></td>";		echo "<td bgcolor=#cccccc align=center>Por Causa<input type='radio' name='tipRep' value='Causa'></td>";				echo "<tr><td bgcolor=#cccccc  colspan=2 align=center><input type='submit' value='ENTER'></td></tr></table>";	}	else	{		echo "<center><table border=1 width='700'>";		echo "<tr><td colspan=3 align=center><b>PROMOTORA MEDICA LAS AMERICAS S.A.</b></td></tr>";		if ($tipRep == 'Causa')			$tit="Causa";		else 			$tit="Persona Responsable";		echo "<tr><td colspan=3 align=center><b>REPORTE POR ".strtoupper($tit)." DE LA INCONSISTENCIA</b></td></tr>";			echo "<tr><td colspan=3 align=center><b>Desde $fecha1 Hasta $fecha2</b></td></tr>";		echo "</table><br/><br/><center><table border=1 width='700'>";		echo "<tr><td colspan=3 align=center bgcolor=#cccccc><b>EN LA PREFACTURA</b></td></tr>";		/*INCONSISTENCIA POR PERSONA RESPONSABLE EN LA PREFACTURA*/		$query = "select COUNT(calidad_000005.$tipRep),calidad_000005.$tipRep,SUM(calidad_000005.Valor_nota) from calidad_000005,calidad_000004 where calidad_000004.fecha_data between '".$fecha1."' and  '".$fecha2."' and calidad_000005.Historia=calidad_000004.Historia and calidad_000005.Ingreso=calidad_000004.Ingreso group by calidad_000005.$tipRep ORDER BY 1 DESC,3 DESC";		$err = mysql_query($query,$conex);		$num = mysql_num_rows($err);		echo "<tr>";		echo "<td bgcolor=#cccccc><b>Cant. Inc.</b></td>";		echo "<td bgcolor=#cccccc><b>$tit</b></td>";		echo "<td bgcolor=#cccccc><b>Valor total Inc.</b></td>";		echo "</tr>";		$sum_inc=0;		$prom=0;		for ($i=0;$i<$num;$i++)		{			$row = mysql_fetch_array($err);			echo "<tr>";			echo "<td align='center'><b>".$row[0]."</b></td>";			echo "<td><b>".ucwords(strtolower($row[1]))."</b></td>";			echo "<td><b>".number_format($row[2],0,'',',')."</b></td>";			$query = "select COUNT(calidad_000005.Tipo_nota), calidad_000005.Tipo_nota,Sum(calidad_000005.Valor_nota) from calidad_000005, calidad_000004 where  calidad_000004.fecha_data between '".$fecha1."' and  '".$fecha2."'and calidad_000005.Historia=calidad_000004.Historia and calidad_000005.Ingreso=calidad_000004.Ingreso and calidad_000005.$tipRep='$row[1]' group by calidad_000005.Tipo_nota ";			$err1 = mysql_query($query,$conex);			$num1 = mysql_num_rows($err1);			for ($j=0;$j<$num1;$j++)			{				$row1 = mysql_fetch_array($err1);				echo "<tr>";				echo "<td align='center'><i>".$row1[0]."</i></td>";				echo "<td><i>".ucwords(strtolower(substr($row1[1],3)))."</i></td>";				echo "<td><i>".number_format($row1[2],0,'',',')."</i></td>";				echo "</tr>";			}			$prom=$prom+$num1;			$sum_inc=$sum_inc+$row[2];			echo "</tr>";		}		/*echo "<tr><td colspan='3'>VALOR PROMEDIO DE LAS INCONSISTENCIAS:".number_format($sum_inc/$prom,2,'.',',')."</TD></tr>";		echo "<tr><td colspan='3'>VALOR TOTAL INCONSISTENCIAS:".number_format($sum_inc,2,'.',',')."</TD></tr>";*/		//echo "</table><BR>";		/*FIN DE PREFACTURA*/		/*INCONSISTENCIA POR PERSONA RESPONSABLE EN LA FACTURA*/		echo "</table><br/><br/><center><table border=1 width='700'>";		$query = "select COUNT(calidad_000003.$tipRep),calidad_000003.$tipRep,SUM(calidad_000003.Valor_nota) from calidad_000003,calidad_000001 where calidad_000001.fecha between '".$fecha1."' and  '".$fecha2."' and calidad_000003.factura=calidad_000001.factura group by calidad_000003.$tipRep ORDER BY 1 DESC,3 DESC ";		$err = mysql_query($query,$conex);		$num = mysql_num_rows($err);		echo "<tr><td colspan=3 align=center bgcolor=#cccccc><b>EN LA FACTURA</b></td></tr>";		echo "<tr>";		echo "<td bgcolor=#cccccc><b>Cant. Inc.</b></td>";		echo "<td bgcolor=#cccccc><b>$tit</b></td>";		echo "<td bgcolor=#cccccc><b>Valor total Inc.</b></td>";		echo "</tr>";		$sum_inc=0;		$prom=0;		for ($i=0;$i<$num;$i++)		{			$row = mysql_fetch_array($err);			echo "<tr>";			echo "<td align='center'><b>".$row[0]."</b></td>";			echo "<td><b>".ucwords(strtolower($row[1]))."</b></td>";			echo "<td><b>".number_format($row[2],0,'',',')."</b></td>";			$query = "select COUNT(calidad_000003.Tipo_nota), calidad_000003.Tipo_nota,Sum(calidad_000003.Valor_nota) from calidad_000003, calidad_000001 where  calidad_000001.fecha between '".$fecha1."' and  '".$fecha2."'and calidad_000003.factura=calidad_000001.factura and calidad_000003.$tipRep='$row[1]' group by calidad_000003.Tipo_nota ";			$err1 = mysql_query($query,$conex);			$num1 = mysql_num_rows($err1);			for ($j=0;$j<$num1;$j++)			{				$row1 = mysql_fetch_array($err1);				echo "<tr>";				echo "<td align='center'><i>".$row1[0]."</i></td>";				echo "<td><i>".ucwords(strtolower(substr($row1[1],3)))."</i></td>";				echo "<td><i>".number_format($row1[2],0,'',',')."</i></td>";				echo "</tr>";			}			$prom=$prom+$num1;			$sum_inc=$sum_inc+$row[2];			echo "</tr>";		}		/*echo "<tr><td colspan='3'>VALOR PROMEDIO DE LAS INCONSISTENCIAS:".number_format($sum_inc/$prom,2,'.',',')."</TD></tr>";		echo "<tr><td colspan='3'>VALOR TOTAL INCONSISTENCIAS:".number_format($sum_inc,2,'.',',')."</TD></tr>";*/		echo "</table><BR>";																echo "<center><table border=1 width='700'>";		echo "<tr><td colspan=3 align=center><b>PROMOTORA MEDICA LAS AMERICAS S.A.</b></td></tr>";		if ($tipRep == 'Causa')			$tit="Causa";		else 			$tit="Persona Responsable";		echo "<tr><td colspan=3 align=center><b>REPORTE POR ".strtoupper($tit)." DE LA INCONSISTENCIA</b></td></tr>";			echo "<tr><td colspan=3 align=center><b>Desde $fecha1 Hasta $fecha2</b></td></tr>";		echo "</table><br/><br/><center><table border=1 width='700'>";		echo "<tr><td colspan=3 align=center bgcolor=#cccccc><b>EN LA PREFACTURA</b></td></tr>";		/*INCONSISTENCIA POR PERSONA RESPONSABLE EN LA PREFACTURA*/		$query = "select COUNT(calidad_000005.Auditor_a),calidad_000005.Unidad_audito,calidad_000005.Auditor_a,SUM(calidad_000005.Valor_nota) from calidad_000005,calidad_000004 where calidad_000004.fecha_data between '".$fecha1."' and  '".$fecha2."' and calidad_000005.Historia=calidad_000004.Historia and calidad_000005.Ingreso=calidad_000004.Ingreso group by calidad_000005.Auditor_a ORDER BY 2,1 DESC,3 DESC";		$err = mysql_query($query,$conex);		$num = mysql_num_rows($err);				$sum_inc=0;		$prom=0;		$unidad="";		for ($i=0;$i<$num;$i++)		{			$row = mysql_fetch_array($err);			if ($unidad != ucwords(strtolower(substr($row[1],3))))			{				echo "<tr><td colspan=3 align=center bgcolor=#cccccc><b>".ucwords(strtolower(substr($row[1],3)))."</b></td></tr>";				echo "<tr>";				echo "<td bgcolor=#cccccc><b>Cant. Inc.</b></td>";				echo "<td bgcolor=#cccccc><b>Auditor a</b></td>";				echo "<td bgcolor=#cccccc><b>Valor total Inc.</b></td>";				echo "</tr>";				$unidad=ucwords(strtolower(substr($row[1],3)));			}				echo "<tr>";			echo "<td align='center'><b>".$row[0]."</b></td>";			echo "<td><b>".ucwords(strtolower($row[2]))."</b></td>";			echo "<td><b>".number_format($row[3],0,'',',')."</b></td>";			$query = "select COUNT(calidad_000005.Tipo_nota), calidad_000005.Tipo_nota,Sum(calidad_000005.Valor_nota) from calidad_000005, calidad_000004 where  calidad_000004.fecha_data between '".$fecha1."' and  '".$fecha2."'and calidad_000005.Historia=calidad_000004.Historia and calidad_000005.Ingreso=calidad_000004.Ingreso and calidad_000005.Auditor_a='$row[2]' and calidad_000005.Unidad_audito='$row[1]' group by calidad_000005.Tipo_nota ";			$err1 = mysql_query($query,$conex);			$num1 = mysql_num_rows($err1);			for ($j=0;$j<$num1;$j++)			{				$row1 = mysql_fetch_array($err1);				echo "<tr>";				echo "<td align='center'><i>".$row1[0]."</i></td>";				echo "<td><i>".ucwords(strtolower(substr($row1[1],3)))."</i></td>";				echo "<td><i>".number_format($row1[2],0,'',',')."</i></td>";				echo "</tr>";			}			$prom=$prom+$num1;			$sum_inc=$sum_inc+$row[2];			echo "</tr>";		}		/*echo "<tr><td colspan='3'>VALOR PROMEDIO DE LAS INCONSISTENCIAS:".number_format($sum_inc/$prom,2,'.',',')."</TD></tr>";		echo "<tr><td colspan='3'>VALOR TOTAL INCONSISTENCIAS:".number_format($sum_inc,2,'.',',')."</TD></tr>";*/		//echo "</table><BR>";		/*FIN DE PREFACTURA*/		/*INCONSISTENCIA POR PERSONA RESPONSABLE EN LA FACTURA*/		echo "</table><br/><br/><center><table border=1 width='700'>";		$query = "select COUNT(calidad_000003.Auditor_a),calidad_000003.Unidad_audito,calidad_000003.Auditor_a,SUM(calidad_000003.Valor_nota) from calidad_000003,calidad_000001 where calidad_000001.fecha between '".$fecha1."' and  '".$fecha2."' and calidad_000003.factura=calidad_000001.factura group by calidad_000003.Auditor_a ORDER BY 2,1 DESC,3 DESC ";		$err = mysql_query($query,$conex);		$num = mysql_num_rows($err);		echo "<tr><td colspan=3 align=center bgcolor=#cccccc><b>EN LA FACTURA</b></td></tr>";		echo "<tr>";		echo "<td bgcolor=#cccccc><b>Cant. Inc.</b></td>";		echo "<td bgcolor=#cccccc><b>Unidad</b></td>";		echo "<td bgcolor=#cccccc><b>Auditor a</b></td>";		echo "<td bgcolor=#cccccc><b>Valor total Inc.</b></td>";		echo "</tr>";		$sum_inc=0;		$prom=0;		for ($i=0;$i<$num;$i++)		{			$row = mysql_fetch_array($err);			if ($unidad != ucwords(strtolower(substr($row[1],3))))			{				echo "<tr><td colspan=3 align=center bgcolor=#cccccc><b>".ucwords(strtolower(substr($row[1],3)))."</b></td></tr>";				echo "<tr>";				echo "<td bgcolor=#cccccc><b>Cant. Inc.</b></td>";				echo "<td bgcolor=#cccccc><b>Auditor a</b></td>";				echo "<td bgcolor=#cccccc><b>Valor total Inc.</b></td>";				echo "</tr>";				$unidad=ucwords(strtolower(substr($row[1],3)));			}				echo "<tr>";			echo "<td align='center'><b>".$row[0]."</b></td>";			echo "<td><b>".ucwords(strtolower($row[2]))."</b></td>";			echo "<td><b>".number_format($row[3],0,'',',')."</b></td>";			$query = "select COUNT(calidad_000003.Tipo_nota), calidad_000003.Tipo_nota,Sum(calidad_000003.Valor_nota) from calidad_000003, calidad_000001 where  calidad_000001.fecha between '".$fecha1."' and  '".$fecha2."'and calidad_000003.factura=calidad_000001.factura and calidad_000003.Unidad_audito='$row[1]' and calidad_000003.Auditor_a='$row[2]'  group by calidad_000003.Tipo_nota ";			$err1 = mysql_query($query,$conex);			$num1 = mysql_num_rows($err1);			for ($j=0;$j<$num1;$j++)			{				$row1 = mysql_fetch_array($err1);				echo "<tr>";				echo "<td align='center'><i>".$row1[0]."</i></td>";				echo "<td><i>".ucwords(strtolower(substr($row1[1],3)))."</i></td>";				echo "<td><i>".number_format($row1[2],0,'',',')."</i></td>";				echo "</tr>";			}			$prom=$prom+$num1;			$sum_inc=$sum_inc+$row[2];			echo "</tr>";		}		echo "</table><BR>";																				}}?></body></html>