<html><head><title>Rep. Causa Resp</title></head><body BGCOLOR=""><BODY TEXT="#000066"><?php
include_once("conex.php");session_start();if(!isset($_SESSION['user']))echo "error";else{	$key = substr($user,2,strlen($user));	
	
	echo "<form action='' method=post>";	if(!isset($fecha1))	{		if (!isset($fecha1))		$fecha1="";		if (!isset($fecha2))		$fecha2="";		echo  "<center><table border=0>";		echo "<tr><td align=center colspan=2><b>PROMOTORA MEDICA LAS AMERICAS S.A.<b></td></tr>";		echo  "<tr><td bgcolor=#cccccc align=center>Fecha inicial</td>";		echo  "<td bgcolor=#cccccc align=center><font color='#0055A8'><input type='TEXT' name='fecha1' size=10 maxlength=10 value='".$fecha1."'></td></tr>";		echo  "<tr><td bgcolor=#cccccc align=center>Fecha final</td>";		echo  "<td bgcolor=#cccccc align=center><font color='#0055A8'><input type='TEXT' name='fecha2' size=10 maxlength=10 value='".$fecha2."'></td></tr>";		echo "<tr><td bgcolor=#cccccc align=center>Por Responsable<input type='radio' name='tipRep' value='Responsable_inc'></td>";		echo "<td bgcolor=#cccccc align=center>Por Causa<input type='radio' name='tipRep' value='Causa'></td>";		echo "<tr><td bgcolor=#cccccc  colspan=2 align=center><font color='#0055A8'><input type='submit' value='ENTER'></td></tr></table>";	}	else	{		echo "<center><table border=1 width='700'>";		echo "<tr><td colspan=3 align=center><b>PROMOTORA MEDICA LAS AMERICAS S.A.</b></td></tr>";		if ($tipRep == 'Causa')				$tit="Causa";	//Titulo del tipo de Reporte		else			$tit="Persona Responsable";	//Titulo del tipo de Reporte		echo "<tr><td colspan=3 align=center><b>REPORTE POR ".strtoupper($tit)." DE LA INCONSISTENCIA</b></td></tr>";		echo "<tr><td colspan=3 align=center><b>Desde $fecha1 Hasta $fecha2</b></td></tr>";		echo "</table>";		for($a=1;$a<3;$a++)		{			/*El proceso se hace dos veces, la primera para la prefactura y el sefunda para la factura*/			if($a==1)			{				/*EMPIEZA POR LA PREFACTURA*/				$nomRep="PREFACTURA";	//nombre del reporte				$query = "select COUNT(calidad_000005.$tipRep),calidad_000005.$tipRep,SUM(calidad_000005.Valor_nota) from calidad_000005,calidad_000004 where calidad_000004.fecha_data between '".$fecha1."' and  '".$fecha2."' and calidad_000005.Historia=calidad_000004.Historia and calidad_000005.Ingreso=calidad_000004.Ingreso group by calidad_000005.$tipRep ORDER BY 1 DESC,3 DESC";			}			else			{				/*EL SEGUNDO REPORTE ES EL DE LA FACTURA*/				$nomRep="FACTURA";	//nombre del reporte				$query = "select COUNT(calidad_000003.$tipRep),calidad_000003.$tipRep,SUM(calidad_000003.Valor_nota) from calidad_000003,calidad_000001 where calidad_000001.fecha between '".$fecha1."' and  '".$fecha2."' and calidad_000003.factura=calidad_000001.factura group by calidad_000003.$tipRep ORDER BY 1 DESC,3 DESC ";			}			echo "<br/><br/><center><table border=1 width='700'>";			echo "<tr><td colspan=4 align=center bgcolor=#225486><font color='#ffffff'><b>EN LA $nomRep</b></td></tr>";			$err = mysql_query($query,$conex);			$numRCTot = mysql_num_rows($err);	//numero de responsables o causas que hay entre las dos fechas para el reporte			$numTot=0;	//numero de veces que la RC se presento para el reporte			$valTot=0;	//valor total de las inconsistencias para ese RC			for ($i=0;$i<$numRCTot;$i++)			{				$row = mysql_fetch_array($err);				$numRC[$i]=$row[0];				$string=ucwords(strtolower($row[1]));//Guardo en string la palabra en tipo titulo				include_once("tipo_titulo_guion.php");//pone en mayuscula toda letra que siga a un guion				$RC[$i]=$string;//nombre del RC				$valRC[$i]=$row[2];				$numTot += $row[0];				$valTot += $row[2];				if($a==1)				{					/*Prefactura*/					$query1 = "select COUNT(calidad_000005.Tipo_nota), calidad_000005.Tipo_nota,Sum(calidad_000005.Valor_nota) from calidad_000005, calidad_000004 where  calidad_000004.fecha_data between '".$fecha1."' and  '".$fecha2."'and calidad_000005.Historia=calidad_000004.Historia and calidad_000005.Ingreso=calidad_000004.Ingreso and calidad_000005.$tipRep='$row[1]' group by calidad_000005.Tipo_nota ";				}				else 				{					/*Factura*/					$query1 = "select COUNT(calidad_000003.Tipo_nota), calidad_000003.Tipo_nota,Sum(calidad_000003.Valor_nota) from calidad_000003, calidad_000001 where  calidad_000001.fecha between '".$fecha1."' and  '".$fecha2."'and calidad_000003.factura=calidad_000001.factura and calidad_000003.$tipRep='$row[1]' group by calidad_000003.Tipo_nota ";				}								$err1 = mysql_query($query1,$conex);				$numNotTot[$i] = mysql_num_rows($err1);//Numero de notas para ese RC				for ($j=0;$j<$numNotTot[$i];$j++)				{					$row1 = mysql_fetch_array($err1);					$numNot[$i][$j]=$row1[0];//numero de veces que se repite ese tipo de nota para el RC					$tipNot[$i][$j]=ucwords(strtolower(substr($row1[1],3)));//nombre del tipo de nota					$valNot[$i][$j]=$row1[2];//valor total del tipo_nota para ese RC				}			}			include_once("/calidad/impr_RC.php");//imprimir los datos en pantalla			echo "</table>";		}	}	include_once("free.php");}?></body></html>