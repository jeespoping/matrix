<?php
include_once("conex.php"); if(!isset($consultaAjax)){header("Content-Type: text/html;charset=ISO-8859-1"); ?><html><head><title>MATRIX - [CANCELACION ALTAS]</title>	<link type='text/css' href='../../../include/root/ui.core.css' rel='stylesheet' />	<link type='text/css' href='../../../include/root/jquery.tooltip.css' rel='stylesheet' />	<script type='text/javascript' src='../../../include/root/jquery-1.3.2.js'></script>	<script type='text/javascript' src='../../../include/root/jquery.tooltip.js'></script>	<script type='text/javascript' src='../../../include/root/jquery.blockUI.min.js'></script><script type='text/javascript'>function cargaToolTip(){	var cont1 = 1;	while(document.getElementById('wide'+cont1))	{		 $('#wide'+cont1).tooltip({track: true, delay: 0, showURL: false, showBody: ' - ', opacity: 0.95, left: -50 });		 cont1++;	}}// Llamado ajax para activar de nuevo un paciente dado de altafunction cancelarAltaJS(i) {	var historia = document.getElementById('wpaciente'+i).value;	if(confirm("Realmente desea cancelar el alta del paciente con historia "+historia)) 	{		var parametros = "consultaAjax=cancelar&basedatos="+document.forms.forma.wbasedato.value+"&basedatoshce="+document.forms.forma.wbasedatohce.value+"&paciente=" +historia+"&seguridad=" +document.getElementById('wseguridad').value; 				try		{			var ajax = nuevoAjax();			ajax.open("POST", "cancelacion_altas.php",false);			ajax.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");			ajax.send(parametros);			if (ajax.readyState==4 && ajax.status==200)			{ 				if(ajax.responseText=="activo")					alert('No se puede cancelar el alta porque el paciente ya se encuentra activo');				if(ajax.responseText=="inactivoEnUnix")					alert('No se puede cancelar el alta porque el paciente no está activo en Unix');				if(ajax.responseText=="habitacionOcupada")					alert('No se puede cancelar el alta porque ya se ocupo la habitación asignada al paciente');				if(ajax.responseText=="altaMayor")					alert('No se puede cancelar el alta porque ésta es superior a 24 horas');				// if(ajax.responseText=="ok")					// alert('El alta ha sido cancelada');							} 					}catch(e){	}	}	else	{		if(i!=0 && i!='0')			document.getElementById('activar'+i).checked = false;		return false;	}	document.getElementById('wpaciente'+i).value = '';	listadoAltasJS();}// Llamado ajax que permite mostrar la lista de pacientes en urgenciasfunction listadoAltasJS(){			var parametros = ""; 	parametros = "consultaAjax=lista&basedatos="+document.forms.forma.wbasedato.value+"&basedatoshce="+document.forms.forma.wbasedatohce.value+"&wemp_pmla="+document.forms.forma.wemp_pmla.value+"&seguridad=" +document.getElementById('wseguridad').value;		try	{		try {			$.blockUI({ message: $('#msjEspere') });		} catch(e){ }		var ajax = nuevoAjax();				ajax.open("POST", "cancelacion_altas.php",true);		ajax.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");		ajax.send(parametros);				ajax.onreadystatechange=function() 		{ 			var contenedor = document.getElementById('agendUrg');			if (ajax.readyState==4 && ajax.status==200)			{				contenedor.innerHTML=ajax.responseText;				cargaToolTip();			}			try {				$.unblockUI();			} catch(e){ }		}				if ( !estaEnProceso(ajax) ) 		{			ajax.send(null);		}	}catch(e){	}}// Llama a la función de ingreso de paciente a urgencias cuando se teclea enter en el textboxdocument.onkeypress=function(e){	var esIE=(document.all);	var esNS=(document.layers);	tecla=(esIE) ? event.keyCode : e.which;	if(tecla==13)	{		validaCancelarAlta();	}}// Valida la historia clínica digitada para el ingreso del pacientefunction validaCancelarAlta(){	var historia = document.forms.forma.wpaciente0.value;	var valido = true;	var mensaje = "";		//validaciones	if(historia == '')	{		mensaje += "Debe especificar una historia clínica \n\r";		document.forms.forma.wpaciente0.value = '';		valido = false;		} 	else 	{				//Prueba el patron regular... empezar por 1-9, seguido de digitos		var reg = new RegExp("^[1-9]+[0-9]*");     	if(!reg.test(historia))		{			mensaje += 'Debe especificar un numero de historia compuesta por digitos.  Sin cero adelante. \n\r';			document.forms.forma.wpaciente0.value = '';			valido = false;    	}    		//Historia cero no se permite		if(historia == '0')		{			mensaje += 'Debe especificar una historia clínica diferente de cero \n\r';			document.forms.forma.wpaciente0.value = '';			valido = false;		}		}		if(!valido)	{		alert( mensaje );		return false;	} 	else 	{		cancelarAltaJS(0);	}}window.onload = function() { listadoAltasJS(); }</script></head><body><?php
include_once("conex.php");/* **************************** AGENDA URGENCIAS *************************************************** ****************************** DESCRIPCIÓN *************************************************** * Permite cancelar el alta de los pacientes en la clinica ************************************************************************************************* * Autor: John M. Cadavid. G. * Fecha creacion: 2012-12-20 ************************************************************************************************* * MODIFICACIONES **************************************************************************************************/include_once("root/comun.php");/************************************************************************************************************************** INICIO APLICACIÓN ****************************************************************************************************************************************/$wactualiz = " Diciembre 20 de 2012";// Validación de usuarioif (!isset($user)){	if (!isset($_SESSION['user'])) 	{		session_register("user");	}	$user="";}//Codigo de usuario que ingreso al sistemaif (strpos($user, "-") > 0)	$wuser = substr($user, (strpos($user, "-") + 1), strlen($user));else	$wuser="";$usuario = new Usuario();$usuario->codigo = $wuser;//Variable para determinar la empresaif(!isset($wemp_pmla)){	terminarEjecucion($MSJ_ERROR_FALTA_PARAMETRO."wemp_pmla");}//Valida codigo de usuario en sesion si no esta registrado el sistema termina la ejecucionif (!isset($_SESSION['user'])){	terminarEjecucion("<div align='center'>Usuario no autenticado.  Por favor cierre esta ventana y vuelva a ingresar a Matrix.</div>");} else {	//Conexion base de datos Matrix	$conex = obtenerConexionBD("matrix");	$institucion = consultarInstitucionPorCodigo($conex, $wemp_pmla);	$winstitucion = $institucion->nombre;		$wbasedatohce = consultarAliasPorAplicacion($conex, $wemp_pmla, "hce");	$wbasedato = consultarAliasPorAplicacion($conex, $wemp_pmla, "movhos");	//Formulario (forma)	echo "<form name='forma' action='' method='post'>";	echo "<input type='hidden' name='wemp_pmla' value='".$wemp_pmla."'>";	echo "<input type='hidden' name='wbasedato' value='".$wbasedato."'>";		echo "<input type='hidden' name='wbasedatohce' value='".$wbasedatohce."'>";		echo "<input type='hidden' name='wseguridad' id='wseguridad' value='".$wuser."'>";	echo "<input type='hidden' name='conex' id='conex' value='".$conex."'>";	echo "<input type='hidden' name='waccion'>";	//Mensaje de espera	echo "<div id='msjEspere' name='msjEspere' style='display:none;'>";	echo "<br /><img src='../../images/medical/ajax-loader5.gif'/><br /><br /> Por favor espere un momento ... <br /><br />";	echo "</div>";		// Definición del encabezado del aplicativo	encabezado("CANCELACION DE ALTAS", $wactualiz, "clinica");		echo "<table border=0 cellspacing=2 cellpadding=0 align=center width=510>"; 	echo "<tr class='fila1'>";	echo "<td colspan=8 align='center'><strong> &nbsp; PROCESO DE CANCELACION DE ALTAS &nbsp; </strong></td>";	echo "</tr>";	echo "<tr>";	echo "<td colspan=8>&nbsp;</td>";	echo "</tr>";	echo "</table>";	//Historia clínica	echo "<div align='center'>";	echo "<strong> &nbsp; Historia clínica &nbsp; </strong>";	echo " &nbsp; <input type='text' name='wpaciente0' id='wpaciente0' class='textoNormal'> &nbsp; ";	echo " &nbsp; <input type=button value='Cancelar alta' onclick='javascript:validaCancelarAlta();'> &nbsp; ";	echo "</div>";	//Botones "Actualizar" y "Cerrar ventana"	echo "<br /><br /><p align='center'><input type='button' value='Actualizar' onclick='javascript:listadoAltasJS();'> &nbsp; | &nbsp; <input type='button' value='Cerrar ventana' onclick='javascript:cerrarVentana();'></p>";          	// Aca la función anterior pinta la lista de pacientes en Urgencias con sus opciones	echo "<div name='agendUrg' id='agendUrg'>";	echo "</div>";			// Establece que la página se refresca automáticamente cada 5 minutos	echo "<script> timer = setInterval('listadoAltasJS()', 300000); </script>";	echo "</form>";	//Botones "Actualizar" y "Cerrar ventana"	echo "<br /><p align='center'><input type='button' value='Actualizar' onclick='javascript:listadoAltasJS();'> &nbsp; | &nbsp; <input type='button' value='Cerrar ventana' onclick='javascript:cerrarVentana();'></p>";          		echo "</div><br />"; //Cierre div id=page}} if(isset($consultaAjax)){header("Content-Type: text/html;charset=ISO-8859-1"); include_once("root/comun.php");include_once("root/magenta.php");$conex = obtenerConexionBD("matrix");conexionOdbc($conex, $basedatos, &$conexUnix, 'facturacion');/********************************************************************************************* **************************	FUNCIONES DE LLAMADO AJAX ************************************* ********************************************************************************************/// Vuelve y activa un paciente dado de altafunction cancelarAlta($basedatos,$basedatoshce,$paciente,$ingreso,$seguridad){	global $conex; 	global $conexUnix;				$fecha = date("Y-m-d");	$hora = date("H:i:s");	// Consulto fecha de ayer	$ayer = date("Y-m-d",time()-86400);	$hora_actual = date("H:i:s");		// Se consulta si el pacientes ha sido dado de alta en las últimas 24 horas	$qalt = "SELECT DISTINCT				Ubihis 			FROM 				".$basedatos."_000018			WHERE 				(	Ubifad > '".$ayer."' 				OR (Ubifad = '".$ayer."'  AND Ubihad > '".$hora_actual."') 				)				AND Ubifad != '0000-00-00' 				AND Ubiald = 'on' 				AND Ubihis = '".$paciente."'  				AND Ubiing = '".$ingreso."'			ORDER BY Ubifad DESC, Ubihad DESC";	$resalt = mysql_query($qalt, $conex) or die ("Error: " . mysql_errno() . " - en el query: " . $qalt . " - " . mysql_error());	$numalt = mysql_num_rows($resalt);	// Si ha sido dado de alta en las últimas 24 horas	if($numalt>0) 	{		// Se consulta si el paciente sigue activo en Unix		$qact = "SELECT COUNT(*)				   FROM inpac				  WHERE pachis = '".$paciente."'";		$rs_act = odbc_do($conexUnix,$qact);		odbc_fetch_row($rs_act);		$campos = odbc_result($rs_act,1);					// Si está activo en Unix según inpac		if(isset($campos) & $campos>0)		{			// Consulto ingreso actual en Unix			$qing = "SELECT pacnum					   FROM inpac					  WHERE pachis = '".$paciente."'";			$rs_ing = odbc_do($conexUnix,$qing);			odbc_fetch_row($rs_ing);			$ingreso = odbc_result($rs_ing,1);			// Cosulto si el paciente está activo en Matrix			$qagn = "	SELECT Ubihis 						FROM ".$basedatos."_000018						WHERE Ubihis = '".$paciente."' 						AND Ubiing = '".$ingreso."' 						AND Ubimue != 'on' 						AND Ubiald != 'on' ";			$resagn = mysql_query($qagn, $conex) or die ("Error: " . mysql_errno() . " - en el query: " . $qagn . " - " . mysql_error());			$numagn = mysql_num_rows($resagn);			// Si no está activo en Matrix, comience el proceso de cancelación de alta			if($numagn==0) 			{				// Cosulto si el paciente tenia habitacion asignada				$qhab = "	SELECT Ubisac, Ubihac 							FROM ".$basedatos."_000018							WHERE Ubihis = '".$paciente."' 							AND Ubiing = '".$ingreso."' ";				$reshab = mysql_query($qhab, $conex) or die ("Error: " . mysql_errno() . " - en el query: " . $qhab . " - " . mysql_error());				$rowhab = mysql_fetch_array($reshab);				$teniaHabitacion = false;				if($rowhab['Ubihac'] && $rowhab['Ubihac']!="" && $rowhab['Ubihac']!=" " && $rowhab['Ubihac']!="NO APLICA")					$teniaHabitacion = true;				// Cosulto si la habitación está ocupada por otra historia				$qocu = "	SELECT Habhis 							FROM ".$basedatos."_000020							WHERE Habcod = '".$rowhab['Ubihac']."' 							AND Habcco = '".$rowhab['Ubisac']."' ";				$resocu = mysql_query($qocu, $conex) or die ("Error: " . mysql_errno() . " - en el query: " . $qocu . " - " . mysql_error());				$rowocu = mysql_fetch_array($resocu);				$habitacionOcupada = false;				if($rowocu['Habhis'] && $rowocu['Habhis']!="" && $rowocu['Habhis']!=" " && $rowocu['Habhis']!="NO APLICA")					$habitacionOcupada = true;								if(!$habitacionOcupada)				{					//Actualizo tabla 18 de Movhos de modo que quite los registros de alta					$q = "	UPDATE ".$basedatos."_000018 							SET Ubimue='off', Ubiald='off', Ubialp='off', Ubifap='0000-00-00', Ubihap='00:00:00', Ubifad='0000-00-00', Ubihad='00:00:00', Ubiuad='' 							WHERE Ubihis = '".$paciente."'							AND	Ubiing = '".$ingreso."'";					$res1 = mysql_query($q, $conex) or die ("Error: " . mysql_errno() . " - en el query: " . $q . " - " . mysql_error());					$num_affect = mysql_affected_rows();					if($num_affect>0)					{						//Guardo LOG de actualizacion en tabla movhos 18 - Activacion paciente						$q = "	INSERT INTO log_agenda 												  (Fecha, Hora, Historia, Ingreso, Accion, Seguridad, Bandera) 										   VALUES												  ('".$fecha."', '".$hora."', '".$paciente."', '".$ingreso."', 'Actualizacion tabla movhos_000018', '".$seguridad."', 'Cancelacion alta')";						$resl2 = mysql_query($q, $conex) or die ("Error: " . mysql_errno() . " - en el query: " . $q . " - " . mysql_error());					}					// Cosulto si el paciente ya está registrado en la tabla 22 de Hce					$q = "	SELECT Mtrhis 							FROM ".$basedatoshce."_000022 							WHERE Mtrhis = '".$paciente."' 							AND Mtring = '".$ingreso."'";					$res = mysql_query($q, $conex) or die ("Error: " . mysql_errno() . " - en el query: " . $q . " - " . mysql_error());					$num = mysql_num_rows($res);					// Si está registrado active de nuevo los regisros del paciente					if($num>0) 					{						$q = "	UPDATE ".$basedatoshce."_000022 								SET Mtrest='on', Mtrcur='off', Mtrcon=''								WHERE Mtrhis = '".$paciente."'								AND	Mtring = '".$ingreso."'";						$res = mysql_query($q, $conex) or die ("Error: " . mysql_errno() . " - en el query: " . $q . " - " . mysql_error());						$num_affect = mysql_affected_rows();						if($num_affect>0)						{							//Guardo LOG de actualizacion en tabla hce 22 - Activacion paciente							$q = "	INSERT INTO log_agenda 													  (Fecha, Hora, Historia, Ingreso, Accion, Seguridad, Bandera) 											   VALUES													  ('".$fecha."', '".$hora."', '".$paciente."', '".$ingreso."', 'Actualizacion tabla hce_000022', '".$seguridad."', 'Cancelacion alta')";							$resl2 = mysql_query($q, $conex) or die ("Error: " . mysql_errno() . " - en el query: " . $q . " - " . mysql_error());						}					}					if($teniaHabitacion && !$habitacionOcupada)					{						$q = "	UPDATE ".$basedatos."_000020 								SET Habhis='".$paciente."', Habing='".$ingreso."', Habali='off', Habdis='off', Habfal='', Habhal=''  								WHERE Habcod = '".$rowhab['Ubihac']."'								AND	Habcco = '".$rowhab['Ubisac']."'";						$res = mysql_query($q, $conex) or die ("Error: " . mysql_errno() . " - en el query: " . $q . " - " . mysql_error());												$num_affect = mysql_affected_rows();						if($num_affect>0)						{							//Guardo LOG de actualización alta en tabla hce_000022							$q = "	INSERT INTO log_agenda 													  (Fecha, Hora, Historia, Ingreso, Accion, Seguridad, Bandera) 											   VALUES													  ('".$fecha."', '".$hora."', '".$paciente."', '".$ingreso."', 'Actualizacion tabla movhos_000020', '".$seguridad."', 'Cancelacion alta')";							$resl1 = mysql_query($q, $conex) or die ("Error: " . mysql_errno() . " - en el query: " . $q . " - " . mysql_error());						}					}										//Borro el registro de egreso en la tabla 33 de Movhos					$q = "	DELETE FROM ".$basedatos."_000033 							WHERE Historia_clinica = '".$paciente."' AND Num_ingreso = '".$ingreso."'";					$res2 = mysql_query($q, $conex) or die ("Error: " . mysql_errno() . " - en el query: " . $q . " - " . mysql_error());					$num_affect = mysql_affected_rows();					if($num_affect>0)					{						//Guardo LOG de borrado en tabla movhos 33 - Activacion paciente						$q = "	INSERT INTO log_agenda 												  (Fecha, Hora, Historia, Ingreso, Accion, Seguridad, Bandera) 										   VALUES												  ('".$fecha."', '".$hora."', '".$paciente."', '".$ingreso."', 'Borrado tabla movhos_000033', '".$seguridad."', 'Cancelacion alta')";						$resl2 = mysql_query($q, $conex) or die ("Error: " . mysql_errno() . " - en el query: " . $q . " - " . mysql_error());					}					if($res1)						return "ok";					else						return "Ocurrió un error en el proceso. \n Error: ".$res1;				}				else				{					return "habitacionOcupada";				}			}			else			{				return "activo";			}		} 		else				{			return "inactivoEnUnix";		}	}	else			{		return "altaMayor";	}}// Borra los registros anteriores a $ndias en la tabla de $tblogfunction borrarLogsAntiguos($tblog,$ndias){	global $conex; 	$nseg = 86400*$ndias;	$antiguos = date("Y-m-d",time()-$nseg);		// Borra registros antiguos de la tabla de log	$q = "	DELETE FROM ".$tblog."			WHERE Fecha < '".$antiguos."'";	$res1 = mysql_query($q, $conex) or die ("Error: " . mysql_errno() . " - en el query: " . $q . " - " . mysql_error());}/*********************************************************************************** LISTADO DE PACIENTES INGRESADOS  *******************************************************************************************/				function listadoAltas($basedatos,$basedatoshce,$wemp_pmla,$seguridad){	// Validación de usuario	if (!isset($user))	{		if (!isset($_SESSION['user'])) 		{			session_register("user");		}		$user="";	}	//Codigo de usuario que ingreso al sistema	if (strpos($user, "-") > 0)		$wuser = substr($user, (strpos($user, "-") + 1), strlen($user));	else		$wuser = "";	$usuario = new Usuario();	$usuario->codigo = $wuser;	//Variable para determinar la empresa	if(!isset($wemp_pmla))	{		terminarEjecucion($MSJ_ERROR_FALTA_PARAMETRO."wemp_pmla");	}	//Valida codigo de usuario en sesion si no esta registrado el sistema termina la ejecucion	if (!isset($_SESSION['user']) || !isset($seguridad) || $seguridad=="")	{		terminarEjecucion("<div align='center'>Usuario no autenticado.  Por favor cierre esta ventana y vuelva a ingresar a Matrix.</div>");	} 	else 	{		global $conex; 				// Borra los registros antiguos en la tabla de log		//borrarLogsAntiguos("log_agenda",15);				//echo "<p>&nbsp;</p>";					/***********************************************************************************		 ******* INICIA SECCIÓN DE PACIENTES DADOS DE ALTA EN LAS ÚLTIMAS 24 HORAS *********		 ***********************************************************************************/		$ayer = date("Y-m-d",time()-86400);		$hora_actual = date("H:i:s");				// Consulta de pacientes dados de alta en las últimas 24 horas		$q = "SELECT DISTINCT			a.Fecha_data fing, a.Hora_data hing, Ubihis, Pactid, Pacced, Pacno1, Pacno2, Pacap1, Pacap2, Ingres, Ingnre, Ubiing, Ubimue, Ubifad, Ubihad, Ubiuad, Ubisac 		FROM 			".$basedatos."_000018 a, ".$basedatos."_000016, root_000036, root_000037, ".$basedatos."_000011 		WHERE 			(	Ubifad > '".$ayer."' 			OR (Ubifad = '".$ayer."'  AND Ubihad > '".$hora_actual."') 			)			AND Ubifad != '0000-00-00' 			AND Ubiald = 'on' 			AND Ubisac = Ccocod			AND Ccohos = 'on'			AND Ccourg != 'on'			AND Ccocir != 'on'			AND Ccoadm != 'on'			AND Ubihis = Inghis  			AND Ubiing = Inging			AND Ubihis = Orihis			AND Oriori = '".$wemp_pmla."'			AND Oriced = Pacced			AND Oritid = Pactid		ORDER BY Ubifad DESC, Ubihad DESC";				// UNIX_TIMESTAMP( CONCAT( 'Ubifad', ' ', 'Ubihad'  ) ) >= UNIX_TIMESTAMP( '".date( "Y-m-d H:i:s", (time()-86400) )."' )		// echo $q;				$res = mysql_query($q, $conex) or die ("Error: " . mysql_errno() . " - en el query: " . $q . " - " . mysql_error());		$num = mysql_num_rows($res);		echo "<table border=0 cellspacing=2 cellpadding=0 align=center>"; 		//Titulo lista de pacientes		echo "<tr class='fila1'>";		echo "<td colspan=8 align='center'><strong> &nbsp; PACIENTES DADOS DE ALTA EN LAS ULTIMAS 24 HORAS &nbsp; </strong></td>";		echo "</tr>";		echo "<tr>";		echo "<td colspan=8>&nbsp;</td>";		echo "</tr>";		$i = 1; 				if ($num > 0)		{			echo "<tr>";			echo "<td colspan='8' class='textoMedio'>Número de pacientes: ".$num." &nbsp; </td>";			echo "</tr>";			$row = mysql_fetch_array($res);			$i=1;						//Encabezado lista de pacientes			echo "<tr class='encabezadoTabla'>";			echo "<td align=center>&nbsp;Fecha alta&nbsp;</td>";			echo "<td align=center>&nbsp;Hora alta&nbsp;</td>";			echo "<td align=center>&nbsp;Historia&nbsp;</td>";			echo "<td align=center>&nbsp;Paciente&nbsp;</td>";			echo "<td align=center>&nbsp;Cancelar Alta&nbsp;</td>";			echo "</tr>";				 			//Ciclo para recorrer todos los registros de la consulta			while ($i<=$num)			{				if (is_int ($i/2))				   $wcf="fila1";  // color de fondo de la fila				else				   $wcf="fila2"; // color de fondo de la fila				// Consulto el usuario que dió de alta al paciente				$quad =	 " SELECT Codigo, Descripcion " 						." FROM usuarios "						." WHERE Codigo = '".$row['Ubiuad']."'";				$resuad = mysql_query($quad, $conex) or die ("Error: " . mysql_errno() . " - en el query: " . $quad . " - " . mysql_error());				$rowuad = mysql_fetch_array($resuad);				$auxres = explode('-',$row['Ingres']);				//Se imprime los valores de cada fila				echo "<tr class=".$wcf.">";				echo "<td align=left>&nbsp;".$row['Ubifad']."&nbsp;</td>";				echo "<td align=left>&nbsp;".$row['Ubihad']."&nbsp;</td>";				echo "<td align=left>";				echo "<span id='wide".$i."' title='Identificaci&oacute;n: <br>".$row['Pactid']." ".$row['Pacced']."<br><br>Fecha Ing. Unix: ".$row['fing']." <br>Hora Ing. Unix: ".$row['hing']."<br>Di&oacute; de alta: ".$rowuad['Descripcion']."'>";				echo "&nbsp;".$row['Ubihis']." - ".$row['Ubiing']."&nbsp;";				echo "</span></td>";				echo "<td align=left>&nbsp;".$row['Pacno1']." ".$row['Pacno2']." ".$row['Pacap1']." ".$row['Pacap2']."&nbsp;</td>";				echo "<input type='hidden' name='wpaciente".$i."' id='wpaciente".$i."' value='".$row['Ubihis']."'>";				//echo "<input type='hidden' name='wingreso".$i."' id='wingreso".$i."' value='".$row['Ubiing']."'>";				// Columna de cancelación de alta				echo "<td align=center>&nbsp;<input type='checkbox' onclick='javascript:cancelarAltaJS(".$i.");' name='activar".$i."' id='activar".$i."' value='".$row['Ubihis']."'>&nbsp;</td>";				echo "</tr>";								//Obtengo la siguiente fila				$row = mysql_fetch_array($res);				$i++; 			}		} 		else 		{			echo "<tr>";			echo "<td colspan=8><p align='center'>No se encontraron pacientes dados de alta en las ultimas 24 horas</p></td>";			echo "</tr>";		}		echo "</table>";			}}	// Llamado a las funciones según el parámetro pasado por medio de ajax	switch($consultaAjax)	{		case 'lista':			echo listadoAltas($basedatos,$basedatoshce,$wemp_pmla,$seguridad);		break;		case 'cancelar':			echo cancelarAlta($basedatos,$basedatoshce,$paciente,$seguridad);		break;		default :			break;	}//Liberacion de conexion MatrixliberarConexionBD($conex);//Liberacion de conexion UnixliberarConexionOdbc($conexUnix);}if(!isset($consultaAjax)) { ?></body></html><?php
include_once("conex.php"); } ?>